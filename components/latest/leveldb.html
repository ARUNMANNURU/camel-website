<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>LevelDB - Apache Camel</title> <link rel="canonical" href="https://camel.apache.org/components/latest/leveldb.html"> <meta name="generator" content="Antora 2.1.0"> <link rel="stylesheet" href="../../_/css/site-1c739ae396.css"> <meta name="application-name" content="Apache Camel"> <link rel="manifest" href="../../site.webmanifest"> <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../apple-touch-icon-57x57.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../apple-touch-icon-114x114.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../apple-touch-icon-72x72.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../apple-touch-icon-144x144.png"> <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../../apple-touch-icon-60x60.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../apple-touch-icon-120x120.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../apple-touch-icon-76x76.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../apple-touch-icon-152x152.png"> <link rel="icon" type="image/png" href="../../favicon-196x196.png" sizes="196x196"> <link rel="icon" type="image/png" href="../../favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="../../favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="../../favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="../../favicon-128.png" sizes="128x128"> </head> <body class="article"> <header class="header"> <nav class="navbar"> <div class="navbar-brand"> <a class="nav-logo" href="../.."><span>Apache Camel</span></a> <div id="topbar-nav" class="navbar-menu"> <div class="navbar-end"> <a class="navbar-item" href="../../blog/">Blog</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Projects</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../projects/camel-k/">Camel K</a> <a class="navbar-item" href="../../projects/camel-quarkus/">Camel Quarkus</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Documentation</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../docs/getting-started/">Getting started</a> <a class="navbar-item" href="../../manual/latest/">User manual</a> <a class="navbar-item" href="../../components/latest/">Component reference</a> <a class="navbar-item" href="../../camel-k/latest/">Camel K</a> <a class="navbar-item" href="../../camel-quarkus/latest/">Camel Quarkus</a> <a class="navbar-item" href="../../manual/latest/enterprise-integration-patterns.html">Enterprise Integration Patterns</a> <a class="navbar-item" href="../../manual/latest/camel-3-migration-guide.html">Camel 3 Migration Guide</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Community</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../community/support/">Support</a> <a class="navbar-item" href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a> <a class="navbar-item" href="../../community/user-stories/">User stories</a> <a class="navbar-item" href="../../community/articles/">Articles</a> <a class="navbar-item" href="../../community/books/">Books</a> <a class="navbar-item" href="../../community/team/">Team</a> </div> </div> <a class="navbar-item" href="../../download/">Download</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">About</a> <div class="navbar-dropdown"> <a class="navbar-item" href="https://www.apache.org/events/current-event.html">Apache events</a> <a class="navbar-item" href="https://www.apache.org/licenses/">License</a> <a class="navbar-item" href="../../security/">Security</a> <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a> <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a> </div> </div> </div> </div> <div class="navbar-tools"> <a href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#github"/></svg></a> <a href="https://gitter.im/apache/apache-camel" title="Chat on Gitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#gitter"/></svg></a> <a href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#twitter"/></svg></a> </div> <button class="navbar-burger" data-target="topbar-nav" type="button"> <span></span> <span></span> <span></span> </button> </div> </nav> </header> <div class="body"> <div class="nav-container" data-component="components" data-version="latest"> <aside class="nav"> <div class="panels"> <div class="nav-panel-explore is-active" data-panel="explore"> <div class="context"> <span class="title">Component reference</span> <span class="version">latest</span> </div> <ul class="components"> <li class="component"> <span class="title">Apache Camel extensions for Quarkus</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-quarkus/latest/index.html">latest</a> </li> </ul> </li> <li class="component"> <span class="title">Apache Camel K</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-k/latest/index.html">latest</a> </li> </ul> </li> <li class="component is-current"> <span class="title">Component reference</span> <ul class="versions"> <li class="version is-current is-latest"> <a href="index.html">latest</a> </li> <li class="version"> <a href="../2.x/index.html">2.x</a> </li> </ul> </li> <li class="component"> <span class="title">User manual</span> <ul class="versions"> <li class="version is-latest"> <a href="../../manual/latest/index.html">latest</a> </li> </ul> </li> </ul> </div> </div> </aside> </div> <main role="main"> <div class="toolbar" role="navigation"> <button class="nav-toggle"></button> <a href="../../manual/latest/index.html" class="home-link"></a> <nav class="breadcrumbs" aria-label="breadcrumbs"> <ul> <li><a href="index.html">Component reference</a></li> <li><a href="leveldb.html">LevelDB</a></li> </ul> </nav> <div class="page-versions"> <button class="version-menu-toggle" title="Show other versions of page" type="button">latest</button> <div class="version-menu"> <a class="version is-current" href="leveldb.html">latest</a> <a class="version" href="../2.x/leveldb.html">2.x</a> </div> </div> <div class="edit-this-page"><a href="https://github.com/apache/camel/edit/master/components/camel-leveldb/src/main/docs/leveldb.adoc">Edit this Page</a></div> </div> <article class="doc"> <h1 class="page">LevelDB</h1> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel 2.10</strong></p> </div> <div class="paragraph"> <p><a href="https://code.google.com/p/leveldb/">Leveldb</a> is a very lightweight and embedable key value database. It allows together with Camel to provide persistent support for various Camel features such as Aggregator.</p> </div> <div class="paragraph"> <p>Current features it provides:</p> </div> <div class="ulist"> <ul> <li> <p>LevelDBAggregationRepository</p> </li> </ul> </div> </div> </div> <div class="sect1"> <h2 id="LevelDB-UsingLevelDBAggregationRepository"><a class="anchor" href="#LevelDB-UsingLevelDBAggregationRepository"></a>Using LevelDBAggregationRepository</h2> <div class="sectionbody"> <div class="paragraph"> <p><code>LevelDBAggregationRepository</code> is an <code>AggregationRepository</code> which on the fly persists the aggregated messages. This ensures that you will not loose messages, as the default aggregator will use an in memory only <code>AggregationRepository</code>.</p> </div> <div class="paragraph"> <p>It has the following options:</p> </div> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Option</th> <th class="tableblock halign-left valign-top">Type</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>repositoryName</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">A mandatory repository name. Allows you to use a shared <code>LevelDBFile</code> for multiple repositories.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>persistentFileName</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Filename for the persistent storage. If no file exists on startup a new file is created.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>levelDBFile</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">LevelDBFile</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Use an existing configured <code>org.apache.camel.component.leveldb.LevelDBFile</code> instance.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>sync</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not the LevelDBFile should sync on write or not. Default is false. By sync on write ensures that its always waiting for all writes to be spooled to disk and thus will not loose updates. See <a href="http://leveldb.googlecode.com/svn/trunk/doc/index.html">LevelDB docs</a> for more details about async vs sync writes.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>returnOldExchange</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether the get operation should return the old existing Exchange if any existed. By default this option is <code>false</code> to optimize as we do not need the old exchange when aggregating.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>useRecovery</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not recovery is enabled. This option is by default <code>true</code>. When enabled the Camel Aggregator automatic recover failed aggregated exchange and have them resubmitted.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>recoveryInterval</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If recovery is enabled then a background task is run every x&#8217;th time to scan for failed exchanges to recover and resubmit. By default this interval is 5000 millis.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>maximumRedeliveries</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to limit the maximum number of redelivery attempts for a recovered exchange. If enabled then the Exchange will be moved to the dead letter channel if all redelivery attempts failed. By default this option is disabled. If this option is used then the <code>deadLetterUri</code> option must also be provided.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>deadLetterUri</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">An endpoint uri for a Dead Letter Channel where exhausted recovered Exchanges will be moved. If this option is used then the <code>maximumRedeliveries</code> option must also be provided.</p></td> </tr> </tbody> </table></div> <div class="paragraph"> <p>The <code>repositoryName</code> option must be provided. Then either the <code>persistentFileName</code> or the <code>levelDBFile</code> must be provided.</p> </div> <div class="sect2"> <h3 id="LevelDB-Whatispreservedwhenpersisting"><a class="anchor" href="#LevelDB-Whatispreservedwhenpersisting"></a>What is preserved when persisting</h3> <div class="paragraph"> <p><code>LevelDBAggregationRepository</code> will only preserve any <code>Serializable</code> compatible message body data types. Message headers must be primitive / string / numbers / etc. If a data type is not such a type its dropped and a <code>WARN</code> is logged. And it only persists the <code>Message</code> body and the <code>Message</code> headers. The <code>Exchange</code> properties are <strong>not</strong> persisted.</p> </div> </div> <div class="sect2"> <h3 id="LevelDB-Recovery"><a class="anchor" href="#LevelDB-Recovery"></a>Recovery</h3> <div class="paragraph"> <p>The <code>LevelDBAggregationRepository</code> will by default recover any failed Exchange. It does this by having a background tasks that scans for failed Exchanges in the persistent store. You can use the <code>checkInterval</code> option to set how often this task runs. The recovery works as transactional which ensures that Camel will try to recover and redeliver the failed Exchange. Any Exchange which was found to be recovered will be restored from the persistent store and resubmitted and send out again.</p> </div> <div class="paragraph"> <p>The following headers is set when an Exchange is being recovered/redelivered:</p> </div> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Header</th> <th class="tableblock halign-left valign-top">Type</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Exchange.REDELIVERED</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Is set to true to indicate the Exchange is being redelivered.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Exchange.REDELIVERY_COUNTER</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The redelivery attempt, starting from 1.</p></td> </tr> </tbody> </table></div> <div class="paragraph"> <p>Only when an Exchange has been successfully processed it will be marked as complete which happens when the <code>confirm</code> method is invoked on the <code>AggregationRepository</code>. This means if the same Exchange fails again it will be kept retried until it success.</p> </div> <div class="paragraph"> <p>You can use option <code>maximumRedeliveries</code> to limit the maximum number of redelivery attempts for a given recovered Exchange. You must also set the <code>deadLetterUri</code> option so Camel knows where to send the Exchange when the <code>maximumRedeliveries</code> was hit.</p> </div> <div class="paragraph"> <p>You can see some examples in the unit tests of camel-leveldb, for example <a href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-leveldb/src/test/java/org/apache/camel/component/leveldb/LevelDBAggregateRecoverTest.java">this test</a>.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="LevelDB-UsingLevelDBAggregationRepositoryinJavaDSL"><a class="anchor" href="#LevelDB-UsingLevelDBAggregationRepositoryinJavaDSL"></a>Using LevelDBAggregationRepository in Java DSL</h2> <div class="sectionbody"> <div class="paragraph"> <p>In this example we want to persist aggregated messages in the <code>target/data/leveldb.dat</code> file.</p> </div> </div> </div> <div class="sect1"> <h2 id="LevelDB-UsingLevelDBAggregationRepositoryinSpringXML"><a class="anchor" href="#LevelDB-UsingLevelDBAggregationRepositoryinSpringXML"></a>Using LevelDBAggregationRepository in Spring XML</h2> <div class="sectionbody"> <div class="paragraph"> <p>The same example but using Spring XML instead:</p> </div> </div> </div> <div class="sect1"> <h2 id="LevelDB-Dependencies"><a class="anchor" href="#LevelDB-Dependencies"></a>Dependencies</h2> <div class="sectionbody"> <div class="paragraph"> <p>To use LevelDB in your camel routes you need to add the a dependency on <strong>camel-leveldb</strong>.</p> </div> <div class="paragraph"> <p>If you use maven you could just add the following to your pom.xml, substituting the version number for the latest &amp; greatest release (see the download page for the latest versions).</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-leveldb&lt;/artifactId&gt;
  &lt;version&gt;x.y.z&lt;/version&gt;
&lt;/dependency&gt;</code></pre> </div> </div> </div> </div> </article> </main> </div> <footer> <div class="footer"> <figure class="logo"> <img src="../../_/img/logo-d.svg" class="logo-small mt-60" alt="Apache Camel Logo" aria-label="white silhouette of a camel in front of a sand dune"> </figure> <dl> <dt>Overview</dt> <dd><a href="../../blog/">Blog</a></dd> <dd><a href="../../components/latest/">Components</a></dd> <dd><a href="../../download/">Download</a></dd> <dd><a href="../../docs/getting-started/">Getting started</a></dd> <dd><a href="../../manual/latest/faq.html">FAQ</a></dd> </dl> <dl> <dt>Community</dt> <dd><a href="../../community/support/">Support</a></dd> <dd><a href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a></dd> <dd><a href="../../community/user-stories/">User stories</a></dd> <dd><a href="../../community/articles/">Articles</a></dd> <dd><a href="../../community/books/">Books</a></dd> <dd><a href="../../community/team/">Team</a></dd> </dl> <dl> <dt>About</dt> <dd><a href="../../acknowledgments/">Acknowledgments</a> </dd><dd><a target="_blank" href="https://www.apache.org/events/current-event.html" title="Apache Events">Apache Events</a></dd> <dd><a target="_blank" href="https://www.apache.org/licenses/" title="License">License</a></dd> <dd><a target="_blank" href="https://www.apache.org/security/" title="Security">Security</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/sponsorship.html" title="Sponsorship">Sponsorship</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/thanks.html" title="Thanks">Thanks</a></dd> </dl> <p> &copy; 2004-2019 The <a href="https://apache.org">Apache Software Foundation</a>.<br> Apache Camel, Camel, Apache, the Apache feather logo, and the Apache Camel project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners. </p> </div> </footer> <script src="../../_/js/site-f4f4dbc142.js"></script> <script async src="../../_/js/vendor/highlight-54157f17f1.js"></script> <script async src="../../_/js/vendor/svg4everybody-195d47ce7d.js"></script> <script type="application/ld+json"> {
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "Apache Camel",
  "url": "https://camel.apache.org",
  "sameAs": [
     "https://twitter.com/ApacheCamel"
  ],
  "logo": "../../_/img/logo-d.svg",
  "description": "Apache Camel ™ is a versatile open-source integration framework based on known Enterprise Integration Patterns. Camel empowers you to define routing and mediation rules in a variety of domain-specific languages, including a Java-based Fluent API, Spring or Blueprint XML Configuration files, and a Scala DSL."
} </script> <script type="application/ld+json"> { 
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Apache Camel",
        "item": "https://camel.apache.org"
        },
        {
        "@type": "ListItem",
        "position": 2,
        "name": "Component reference",
        "item": "https://camel.apache.org/components/latest/index.html"
        },
        {
        "@type": "ListItem",
        "position": 3,
        "name": "LevelDB","item": "https://camel.apache.org/components/latest/leveldb.html"}
        ]
    } </script> </body> </html> 