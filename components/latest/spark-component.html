<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Apache Spark Component - Apache Camel</title> <link rel="canonical" href="https://camel.apache.org/components/latest/spark-component.html"> <meta name="generator" content="Antora 2.1.0"> <link rel="stylesheet" href="../../_/css/site-1c739ae396.css"> <meta name="application-name" content="Apache Camel"> <link rel="manifest" href="../../site.webmanifest"> <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../apple-touch-icon-57x57.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../apple-touch-icon-114x114.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../apple-touch-icon-72x72.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../apple-touch-icon-144x144.png"> <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../../apple-touch-icon-60x60.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../apple-touch-icon-120x120.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../apple-touch-icon-76x76.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../apple-touch-icon-152x152.png"> <link rel="icon" type="image/png" href="../../favicon-196x196.png" sizes="196x196"> <link rel="icon" type="image/png" href="../../favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="../../favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="../../favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="../../favicon-128.png" sizes="128x128"> </head> <body class="article"> <header class="header"> <nav class="navbar"> <div class="navbar-brand"> <a class="nav-logo" href="../.."><span>Apache Camel</span></a> <div id="topbar-nav" class="navbar-menu"> <div class="navbar-end"> <a class="navbar-item" href="../../blog/">Blog</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Projects</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../projects/camel-k/">Camel K</a> <a class="navbar-item" href="../../projects/camel-quarkus/">Camel Quarkus</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Documentation</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../docs/getting-started/">Getting started</a> <a class="navbar-item" href="../../manual/latest/">User manual</a> <a class="navbar-item" href="../../components/latest/">Component reference</a> <a class="navbar-item" href="../../camel-k/latest/">Camel K</a> <a class="navbar-item" href="../../camel-quarkus/latest/">Camel Quarkus</a> <a class="navbar-item" href="../../manual/latest/enterprise-integration-patterns.html">Enterprise Integration Patterns</a> <a class="navbar-item" href="../../manual/latest/camel-3-migration-guide.html">Camel 3 Migration Guide</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Community</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../community/support/">Support</a> <a class="navbar-item" href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a> <a class="navbar-item" href="../../community/user-stories/">User stories</a> <a class="navbar-item" href="../../community/articles/">Articles</a> <a class="navbar-item" href="../../community/books/">Books</a> <a class="navbar-item" href="../../community/team/">Team</a> </div> </div> <a class="navbar-item" href="../../download/">Download</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">About</a> <div class="navbar-dropdown"> <a class="navbar-item" href="https://www.apache.org/events/current-event.html">Apache events</a> <a class="navbar-item" href="https://www.apache.org/licenses/">License</a> <a class="navbar-item" href="../../security/">Security</a> <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a> <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a> </div> </div> </div> </div> <div class="navbar-tools"> <a href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#github"/></svg></a> <a href="https://gitter.im/apache/apache-camel" title="Chat on Gitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#gitter"/></svg></a> <a href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#twitter"/></svg></a> </div> <button class="navbar-burger" data-target="topbar-nav" type="button"> <span></span> <span></span> <span></span> </button> </div> </nav> </header> <div class="body"> <div class="nav-container" data-component="components" data-version="latest"> <aside class="nav"> <div class="panels"> <div class="nav-panel-explore is-active" data-panel="explore"> <div class="context"> <span class="title">Component reference</span> <span class="version">latest</span> </div> <ul class="components"> <li class="component"> <span class="title">Apache Camel extensions for Quarkus</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-quarkus/latest/index.html">latest</a> </li> </ul> </li> <li class="component"> <span class="title">Apache Camel K</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-k/latest/index.html">latest</a> </li> </ul> </li> <li class="component is-current"> <span class="title">Component reference</span> <ul class="versions"> <li class="version is-current is-latest"> <a href="index.html">latest</a> </li> <li class="version"> <a href="../2.x/index.html">2.x</a> </li> </ul> </li> <li class="component"> <span class="title">User manual</span> <ul class="versions"> <li class="version is-latest"> <a href="../../manual/latest/index.html">latest</a> </li> </ul> </li> </ul> </div> </div> </aside> </div> <main role="main"> <div class="toolbar" role="navigation"> <button class="nav-toggle"></button> <a href="../../manual/latest/index.html" class="home-link"></a> <nav class="breadcrumbs" aria-label="breadcrumbs"> <ul> <li><a href="index.html">Component reference</a></li> <li><a href="spark-component.html">Apache Spark Component</a></li> </ul> </nav> <div class="page-versions"> <button class="version-menu-toggle" title="Show other versions of page" type="button">latest</button> <div class="version-menu"> <a class="version is-current" href="spark-component.html">latest</a> <a class="version" href="../2.x/spark-component.html">2.x</a> </div> </div> <div class="edit-this-page"><a href="https://github.com/apache/camel/edit/master/components/camel-spark/src/main/docs/spark-component.adoc">Edit this Page</a></div> </div> <article class="doc"> <h1 class="page">Apache Spark Component</h1> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel version 2.17</strong></p> </div> <div class="paragraph"> <p>This documentation page covers the <a href="http://spark.apache.org/">Apache Spark</a> component for the Apache Camel. The main purpose of the Spark integration with Camel is to provide a bridge between Camel connectors and Spark tasks. In particular Camel connector provides a way to route message from various transports, dynamically choose a task to execute, use incoming message as input data for that task and finally deliver the results of the execution back to the Camel pipeline.</p> </div> </div> </div> <div class="sect1"> <h2 id="_supported_architectural_styles"><a class="anchor" href="#_supported_architectural_styles"></a>Supported architectural styles</h2> <div class="sectionbody"> <div class="paragraph"> <p>Spark component can be used as a driver application deployed into an application server (or executed as a fat jar).</p> </div> <div class="imageblock"> <div class="content"> <img src="_images/camel_spark_driver.png" alt="image"> </div> </div> <div class="paragraph"> <p>Spark component can also be submitted as a job directly into the Spark cluster.</p> </div> <div class="imageblock"> <div class="content"> <img src="_images/camel_spark_cluster.png" alt="image"> </div> </div> <div class="paragraph"> <p>While Spark component is primary designed to work as a <em>long running job</em> serving as an bridge between Spark cluster and the other endpoints, you can also use it as a <em>fire-once</em> short job.</p> </div> </div> </div> <div class="sect1"> <h2 id="_running_spark_in_osgi_servers"><a class="anchor" href="#_running_spark_in_osgi_servers"></a>Running Spark in OSGi servers</h2> <div class="sectionbody"> <div class="paragraph"> <p>Currently the Spark component doesn&#8217;t support execution in the OSGi container. Spark has been designed to be executed as a fat jar, usually submitted as a job to a cluster. For those reasons running Spark in an OSGi server is at least challenging and is not support by Camel as well.</p> </div> </div> </div> <div class="sect1"> <h2 id="_uri_format"><a class="anchor" href="#_uri_format"></a>URI format</h2> <div class="sectionbody"> <div class="paragraph"> <p>Currently the Spark component supports only producers - it is intended to invoke a Spark job and return results. You can call RDD, data frame or Hive SQL job.</p> </div> <div class="paragraph"> <p><strong>Spark URI format</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">spark:{rdd|dataframe|hive}</code></pre> </div> </div> <div class="sect2"> <h3 id="_spark_options"><a class="anchor" href="#_spark_options"></a>Spark options</h3> <div class="paragraph"> <p>The Apache Spark component supports 3 options, which are listed below.</p> </div> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> <th class="tableblock halign-center valign-top">Default</th> <th class="tableblock halign-left valign-top">Type</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>rdd</strong> (producer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">RDD to compute against.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">JavaRDDLike</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>rddCallback</strong> (producer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Function performing action against an RDD.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">RddCallback</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>basicPropertyBinding</strong> (advanced)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether the component should use basic property binding (Camel 2.x) or the newer property binding with additional capabilities</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> </tbody> </table></div> <div class="paragraph"> <p>The Apache Spark endpoint is configured using URI syntax:</p> </div> <div class="listingblock"> <div class="content"> <pre>spark:endpointType</pre> </div> </div> <div class="paragraph"> <p>with the following path and query parameters:</p> </div> </div> <div class="sect2"> <h3 id="_path_parameters_1_parameters"><a class="anchor" href="#_path_parameters_1_parameters"></a>Path Parameters (1 parameters):</h3> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> <th class="tableblock halign-center valign-top">Default</th> <th class="tableblock halign-left valign-top">Type</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>endpointType</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Required</strong> Type of the endpoint (rdd, dataframe, hive).</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">EndpointType</p></td> </tr> </tbody> </table></div> </div> <div class="sect2"> <h3 id="_query_parameters_8_parameters"><a class="anchor" href="#_query_parameters_8_parameters"></a>Query Parameters (8 parameters):</h3> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> <th class="tableblock halign-center valign-top">Default</th> <th class="tableblock halign-left valign-top">Type</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>collect</strong> (producer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Indicates if results should be collected or counted.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dataFrame</strong> (producer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">DataFrame to compute against.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Dataset</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dataFrameCallback</strong> (producer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Function performing action against an DataFrame.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">DataFrameCallback</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>lazyStartProducer</strong> (producer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether the producer should be started lazy (on the first message). By starting lazy you can use this to allow CamelContext and routes to startup in situations where a producer may otherwise fail during starting and cause the route to fail being started. By deferring this startup to be lazy then the startup failure can be handled during routing messages via Camel&#8217;s routing error handlers. Beware that when the first message is processed then creating and starting the producer may take a little time and prolong the total processing time of the processing.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>rdd</strong> (producer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">RDD to compute against.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">JavaRDDLike</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>rddCallback</strong> (producer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Function performing action against an RDD.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">RddCallback</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>basicPropertyBinding</strong> (advanced)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether the endpoint should use basic property binding (Camel 2.x) or the newer property binding with additional capabilities</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>synchronous</strong> (advanced)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> </tbody> </table></div> </div> </div> </div> <div class="sect1"> <h2 id="_spring_boot_auto_configuration"><a class="anchor" href="#_spring_boot_auto_configuration"></a>Spring Boot Auto-Configuration</h2> <div class="sectionbody"> <div class="paragraph"> <p>When using Spring Boot make sure to use the following Maven dependency to have support for auto configuration:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-spark-starter&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
  &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>The component supports 4 options, which are listed below.</p> </div> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> <th class="tableblock halign-center valign-top">Default</th> <th class="tableblock halign-left valign-top">Type</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.component.spark.basic-property-binding</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether the component should use basic property binding (Camel 2.x) or the newer property binding with additional capabilities</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.component.spark.enabled</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Enable spark component</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.component.spark.rdd</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">RDD to compute against. The option is a org.apache.spark.api.java.JavaRDDLike type.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.component.spark.rdd-callback</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Function performing action against an RDD. The option is a org.apache.camel.component.spark.RddCallback type.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> </tbody> </table></div> </div> </div> <div class="sect1"> <h2 id="_rdd_jobs"><a class="anchor" href="#_rdd_jobs"></a>RDD jobs</h2> <div class="sectionbody"> <div class="paragraph"> <p>To invoke an RDD job, use the following URI:</p> </div> <div class="paragraph"> <p><strong>Spark RDD producer</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">spark:rdd?rdd=#testFileRdd&amp;rddCallback=#transformation</code></pre> </div> </div> <div class="literalblock"> <div class="content"> <pre> Where `rdd` option refers to the name of an RDD instance (subclass of
`org.apache.spark.api.java.JavaRDDLike`) from a Camel registry, while
`rddCallback` refers to the implementation
of `org.apache.camel.component.spark.RddCallback` interface (also from a
registry). RDD callback provides a single method used to apply incoming
messages against the given RDD. Results of callback computations are
saved as a body to an exchange.</pre> </div> </div> <div class="paragraph"> <p><strong>Spark RDD callback</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface RddCallback&lt;T&gt; {
    T onRdd(JavaRDDLike rdd, Object... payloads);
}</code></pre> </div> </div> <div class="paragraph"> <p>The following snippet demonstrates how to send message as an input to the job and return results:</p> </div> <div class="paragraph"> <p><strong>Calling spark job</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String pattern = "job input";
long linesCount = producerTemplate.requestBody("spark:rdd?rdd=#myRdd&amp;rddCallback=#countLinesContaining", pattern, long.class);</code></pre> </div> </div> <div class="paragraph"> <p>The RDD callback for the snippet above registered as Spring bean could look as follows:</p> </div> <div class="paragraph"> <p><strong>Spark RDD callback</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
RddCallback&lt;Long&gt; countLinesContaining() {
    return new RddCallback&lt;Long&gt;() {
        Long onRdd(JavaRDDLike rdd, Object... payloads) {
            String pattern = (String) payloads[0];
            return rdd.filter({line -&gt; line.contains(pattern)}).count();
        }
    }
}</code></pre> </div> </div> <div class="paragraph"> <p>The RDD definition in Spring could looks as follows:</p> </div> <div class="paragraph"> <p><strong>Spark RDD definition</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
JavaRDDLike myRdd(JavaSparkContext sparkContext) {
  return sparkContext.textFile("testrdd.txt");
}</code></pre> </div> </div> <div class="sect2"> <h3 id="_void_rdd_callbacks"><a class="anchor" href="#_void_rdd_callbacks"></a>Void RDD callbacks</h3> <div class="paragraph"> <p>If your RDD callback doesn&#8217;t return any value back to a Camel pipeline, you can either return <code>null</code> value or use <code>VoidRddCallback</code> base class:</p> </div> <div class="paragraph"> <p><strong>Spark RDD definition</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
RddCallback&lt;Void&gt; rddCallback() {
  return new VoidRddCallback() {
        @Override
        public void doOnRdd(JavaRDDLike rdd, Object... payloads) {
            rdd.saveAsTextFile(output.getAbsolutePath());
        }
    };
}</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_converting_rdd_callbacks"><a class="anchor" href="#_converting_rdd_callbacks"></a>Converting RDD callbacks</h3> <div class="paragraph"> <p>If you know what type of the input data will be sent to the RDD callback, you can use <code>ConvertingRddCallback</code> and let Camel to automatically convert incoming messages before inserting those into the callback:</p> </div> <div class="paragraph"> <p><strong>Spark RDD definition</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
RddCallback&lt;Long&gt; rddCallback(CamelContext context) {
  return new ConvertingRddCallback&lt;Long&gt;(context, int.class, int.class) {
            @Override
            public Long doOnRdd(JavaRDDLike rdd, Object... payloads) {
                return rdd.count() * (int) payloads[0] * (int) payloads[1];
            }
        };
    };
}</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_annotated_rdd_callbacks"><a class="anchor" href="#_annotated_rdd_callbacks"></a>Annotated RDD callbacks</h3> <div class="paragraph"> <p>Probably the easiest way to work with the RDD callbacks is to provide class with method marked with <code>@RddCallback</code> annotation:</p> </div> <div class="paragraph"> <p><strong>Annotated RDD callback definition</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import static org.apache.camel.component.spark.annotations.AnnotatedRddCallback.annotatedRddCallback;

@Bean
RddCallback&lt;Long&gt; rddCallback() {
    return annotatedRddCallback(new MyTransformation());
}

...

import org.apache.camel.component.spark.annotation.RddCallback;

public class MyTransformation {

    @RddCallback
    long countLines(JavaRDD&lt;String&gt; textFile, int first, int second) {
        return textFile.count() * first * second;
    }

}</code></pre> </div> </div> <div class="paragraph"> <p>If you will pass CamelContext to the annotated RDD callback factory method, the created callback will be able to convert incoming payloads to match the parameters of the annotated method:</p> </div> <div class="paragraph"> <p><strong>Body conversions for annotated RDD callbacks</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import static org.apache.camel.component.spark.annotations.AnnotatedRddCallback.annotatedRddCallback;

@Bean
RddCallback&lt;Long&gt; rddCallback(CamelContext camelContext) {
    return annotatedRddCallback(new MyTransformation(), camelContext);
}

...


import org.apache.camel.component.spark.annotation.RddCallback;

public class MyTransformation {

    @RddCallback
    long countLines(JavaRDD&lt;String&gt; textFile, int first, int second) {
        return textFile.count() * first * second;
    }

}

...

// Convert String "10" to integer
long result = producerTemplate.requestBody("spark:rdd?rdd=#rdd&amp;rddCallback=#rddCallback" Arrays.asList(10, "10"), long.class);</code></pre> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="_dataframe_jobs"><a class="anchor" href="#_dataframe_jobs"></a>DataFrame jobs</h2> <div class="sectionbody"> <div class="paragraph"> <p>Instead of working with RDDs Spark component can work with DataFrames as well.</p> </div> <div class="paragraph"> <p>To invoke an DataFrame job, use the following URI:</p> </div> <div class="paragraph"> <p><strong>Spark RDD producer</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">spark:dataframe?dataFrame=#testDataFrame&amp;dataFrameCallback=#transformation</code></pre> </div> </div> <div class="literalblock"> <div class="content"> <pre> Where `dataFrame` option refers to the name of an DataFrame instance
(`instances of org.apache.spark.sql.Dataset and org.apache.spark.sql.Row`) from a Camel registry,
while `dataFrameCallback` refers to the implementation
of `org.apache.camel.component.spark.DataFrameCallback` interface (also
from a registry). DataFrame callback provides a single method used to
apply incoming messages against the given DataFrame. Results of callback
computations are saved as a body to an exchange.</pre> </div> </div> <div class="paragraph"> <p><strong>Spark RDD callback</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface DataFrameCallback&lt;T&gt; {
    T onDataFrame(Dataset&lt;Row&gt; dataFrame, Object... payloads);
}</code></pre> </div> </div> <div class="paragraph"> <p>The following snippet demonstrates how to send message as an input to a job and return results:</p> </div> <div class="paragraph"> <p><strong>Calling spark job</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String model = "Micra";
long linesCount = producerTemplate.requestBody("spark:dataFrame?dataFrame=#cars&amp;dataFrameCallback=#findCarWithModel", model, long.class);</code></pre> </div> </div> <div class="paragraph"> <p>The DataFrame callback for the snippet above registered as Spring bean could look as follows:</p> </div> <div class="paragraph"> <p><strong>Spark RDD callback</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
RddCallback&lt;Long&gt; findCarWithModel() {
    return new DataFrameCallback&lt;Long&gt;() {
        @Override
        public Long onDataFrame(Dataset&lt;Row&gt; dataFrame, Object... payloads) {
            String model = (String) payloads[0];
            return dataFrame.where(dataFrame.col("model").eqNullSafe(model)).count();
        }
    };
}</code></pre> </div> </div> <div class="paragraph"> <p>The DataFrame definition in Spring could looks as follows:</p> </div> <div class="paragraph"> <p><strong>Spark RDD definition</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
Dataset&lt;Row&gt; cars(HiveContext hiveContext) {
    Dataset&lt;Row&gt; jsonCars = hiveContext.read().json("/var/data/cars.json");
    jsonCars.registerTempTable("cars");
    return jsonCars;
}</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_hive_jobs"><a class="anchor" href="#_hive_jobs"></a>Hive jobs</h2> <div class="sectionbody"> <div class="literalblock"> <div class="content"> <pre> Instead of working with RDDs or DataFrame Spark component can also
receive Hive SQL queries as payloads. To send Hive query to Spark
component, use the following URI:</pre> </div> </div> <div class="paragraph"> <p><strong>Spark RDD producer</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">spark:hive</code></pre> </div> </div> <div class="paragraph"> <p>The following snippet demonstrates how to send message as an input to a job and return results:</p> </div> <div class="paragraph"> <p><strong>Calling spark job</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">long carsCount = template.requestBody("spark:hive?collect=false", "SELECT * FROM cars", Long.class);
List&lt;Row&gt; cars = template.requestBody("spark:hive", "SELECT * FROM cars", List.class);</code></pre> </div> </div> <div class="paragraph"> <p>The table we want to execute query against should be registered in a HiveContext before we query it. For example in Spring such registration could look as follows:</p> </div> <div class="paragraph"> <p><strong>Spark RDD definition</strong></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
Dataset&lt;Row&gt; cars(HiveContext hiveContext) {
     jsonCars = hiveContext.read().json("/var/data/cars.json");
    jsonCars.registerTempTable("cars");
    return jsonCars;
}</code></pre> </div> </div> </div> </div> </article> </main> </div> <footer> <div class="footer"> <figure class="logo"> <img src="../../_/img/logo-d.svg" class="logo-small mt-60" alt="Apache Camel Logo" aria-label="white silhouette of a camel in front of a sand dune"> </figure> <dl> <dt>Overview</dt> <dd><a href="../../blog/">Blog</a></dd> <dd><a href="../../components/latest/">Components</a></dd> <dd><a href="../../download/">Download</a></dd> <dd><a href="../../docs/getting-started/">Getting started</a></dd> <dd><a href="../../manual/latest/faq.html">FAQ</a></dd> </dl> <dl> <dt>Community</dt> <dd><a href="../../community/support/">Support</a></dd> <dd><a href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a></dd> <dd><a href="../../community/user-stories/">User stories</a></dd> <dd><a href="../../community/articles/">Articles</a></dd> <dd><a href="../../community/books/">Books</a></dd> <dd><a href="../../community/team/">Team</a></dd> </dl> <dl> <dt>About</dt> <dd><a href="../../acknowledgments/">Acknowledgments</a> </dd><dd><a target="_blank" href="https://www.apache.org/events/current-event.html" title="Apache Events">Apache Events</a></dd> <dd><a target="_blank" href="https://www.apache.org/licenses/" title="License">License</a></dd> <dd><a target="_blank" href="https://www.apache.org/security/" title="Security">Security</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/sponsorship.html" title="Sponsorship">Sponsorship</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/thanks.html" title="Thanks">Thanks</a></dd> </dl> <p> &copy; 2004-2019 The <a href="https://apache.org">Apache Software Foundation</a>.<br> Apache Camel, Camel, Apache, the Apache feather logo, and the Apache Camel project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners. </p> </div> </footer> <script src="../../_/js/site-f4f4dbc142.js"></script> <script async src="../../_/js/vendor/highlight-54157f17f1.js"></script> <script async src="../../_/js/vendor/svg4everybody-195d47ce7d.js"></script> <script type="application/ld+json"> {
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "Apache Camel",
  "url": "https://camel.apache.org",
  "sameAs": [
     "https://twitter.com/ApacheCamel"
  ],
  "logo": "../../_/img/logo-d.svg",
  "description": "Apache Camel ™ is a versatile open-source integration framework based on known Enterprise Integration Patterns. Camel empowers you to define routing and mediation rules in a variety of domain-specific languages, including a Java-based Fluent API, Spring or Blueprint XML Configuration files, and a Scala DSL."
} </script> <script type="application/ld+json"> { 
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Apache Camel",
        "item": "https://camel.apache.org"
        },
        {
        "@type": "ListItem",
        "position": 2,
        "name": "Component reference",
        "item": "https://camel.apache.org/components/latest/index.html"
        },
        {
        "@type": "ListItem",
        "position": 3,
        "name": "Apache Spark Component","item": "https://camel.apache.org/components/latest/spark-component.html"}
        ]
    } </script> </body> </html> 