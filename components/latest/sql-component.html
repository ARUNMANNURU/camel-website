<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>SQL Component - Apache Camel</title> <link rel="canonical" href="https://camel.apache.org/components/latest/sql-component.html"> <meta name="generator" content="Antora 2.1.0"> <link rel="stylesheet" href="../../_/css/site-1c739ae396.css"> <meta name="application-name" content="Apache Camel"> <link rel="manifest" href="../../site.webmanifest"> <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../apple-touch-icon-57x57.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../apple-touch-icon-114x114.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../apple-touch-icon-72x72.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../apple-touch-icon-144x144.png"> <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../../apple-touch-icon-60x60.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../apple-touch-icon-120x120.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../apple-touch-icon-76x76.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../apple-touch-icon-152x152.png"> <link rel="icon" type="image/png" href="../../favicon-196x196.png" sizes="196x196"> <link rel="icon" type="image/png" href="../../favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="../../favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="../../favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="../../favicon-128.png" sizes="128x128"> </head> <body class="article"> <header class="header"> <nav class="navbar"> <div class="navbar-brand"> <a class="nav-logo" href="../.."><span>Apache Camel</span></a> <div id="topbar-nav" class="navbar-menu"> <div class="navbar-end"> <a class="navbar-item" href="../../blog/">Blog</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Projects</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../projects/camel-k/">Camel K</a> <a class="navbar-item" href="../../projects/camel-quarkus/">Camel Quarkus</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Documentation</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../docs/getting-started/">Getting started</a> <a class="navbar-item" href="../../manual/latest/">User manual</a> <a class="navbar-item" href="../../components/latest/">Component reference</a> <a class="navbar-item" href="../../camel-k/latest/">Camel K</a> <a class="navbar-item" href="../../camel-quarkus/latest/">Camel Quarkus</a> <a class="navbar-item" href="../../manual/latest/enterprise-integration-patterns.html">Enterprise Integration Patterns</a> <a class="navbar-item" href="../../manual/latest/camel-3-migration-guide.html">Camel 3 Migration Guide</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Community</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../community/support/">Support</a> <a class="navbar-item" href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a> <a class="navbar-item" href="../../community/user-stories/">User stories</a> <a class="navbar-item" href="../../community/articles/">Articles</a> <a class="navbar-item" href="../../community/books/">Books</a> <a class="navbar-item" href="../../community/team/">Team</a> </div> </div> <a class="navbar-item" href="../../download/">Download</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">About</a> <div class="navbar-dropdown"> <a class="navbar-item" href="https://www.apache.org/events/current-event.html">Apache events</a> <a class="navbar-item" href="https://www.apache.org/licenses/">License</a> <a class="navbar-item" href="../../security/">Security</a> <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a> <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a> </div> </div> </div> </div> <div class="navbar-tools"> <a href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#github"/></svg></a> <a href="https://gitter.im/apache/apache-camel" title="Chat on Gitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#gitter"/></svg></a> <a href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#twitter"/></svg></a> </div> <button class="navbar-burger" data-target="topbar-nav" type="button"> <span></span> <span></span> <span></span> </button> </div> </nav> </header> <div class="body"> <div class="nav-container" data-component="components" data-version="latest"> <aside class="nav"> <div class="panels"> <div class="nav-panel-explore is-active" data-panel="explore"> <div class="context"> <span class="title">Component reference</span> <span class="version">latest</span> </div> <ul class="components"> <li class="component"> <span class="title">Apache Camel extensions for Quarkus</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-quarkus/latest/index.html">latest</a> </li> </ul> </li> <li class="component"> <span class="title">Apache Camel K</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-k/latest/index.html">latest</a> </li> </ul> </li> <li class="component is-current"> <span class="title">Component reference</span> <ul class="versions"> <li class="version is-current is-latest"> <a href="index.html">latest</a> </li> <li class="version"> <a href="../2.x/index.html">2.x</a> </li> </ul> </li> <li class="component"> <span class="title">User manual</span> <ul class="versions"> <li class="version is-latest"> <a href="../../manual/latest/index.html">latest</a> </li> </ul> </li> </ul> </div> </div> </aside> </div> <main role="main"> <div class="toolbar" role="navigation"> <button class="nav-toggle"></button> <a href="../../manual/latest/index.html" class="home-link"></a> <nav class="breadcrumbs" aria-label="breadcrumbs"> <ul> <li><a href="index.html">Component reference</a></li> <li><a href="sql-component.html">SQL Component</a></li> </ul> </nav> <div class="page-versions"> <button class="version-menu-toggle" title="Show other versions of page" type="button">latest</button> <div class="version-menu"> <a class="version is-current" href="sql-component.html">latest</a> <a class="version" href="../2.x/sql-component.html">2.x</a> </div> </div> <div class="edit-this-page"><a href="https://github.com/apache/camel/edit/master/components/camel-sql/src/main/docs/sql-component.adoc">Edit this Page</a></div> </div> <article class="doc"> <h1 class="page">SQL Component</h1> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel version 1.4</strong></p> </div> <div class="paragraph"> <p>The SQL component allows you to work with databases using JDBC queries. The difference between this component and <a href="jdbc-component.html" class="page">JDBC</a> component is that in case of SQL the query is a property of the endpoint and it uses message payload as parameters passed to the query.</p> </div> <div class="paragraph"> <p>This component uses <code>spring-jdbc</code> behind the scenes for the actual SQL handling.</p> </div> <div class="paragraph"> <p>Maven users will need to add the following dependency to their <code>pom.xml</code> for this component:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;artifactId&gt;camel-sql&lt;/artifactId&gt;
    &lt;version&gt;x.x.x&lt;/version&gt;
    &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>The SQL component also supports:</p> </div> <div class="ulist"> <ul> <li> <p>a JDBC based repository for the Idempotent Consumer EIP pattern. See further below.</p> </li> <li> <p>a JDBC based repository for the Aggregator EIP pattern. See further below.</p> </li> </ul> </div> </div> </div> <div class="sect1"> <h2 id="_uri_format"><a class="anchor" href="#_uri_format"></a>URI format</h2> <div class="sectionbody"> <div class="admonitionblock tip"> <div class="table-wrapper"><table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> This component can be used as a <a href="http://camel.apache.org/transactional-client.html">Transactional Client</a>. </td> </tr> </table></div> </div> <div class="paragraph"> <p>The SQL component uses the following endpoint URI notation:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">sql:select * from table where id=# order by name[?options]</code></pre> </div> </div> <div class="paragraph"> <p>You can use named parameters by using :`#name_of_the_parameter` style as shown:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">sql:select * from table where id=:#myId order by name[?options]</code></pre> </div> </div> <div class="paragraph"> <p>When using named parameters, Camel will lookup the names from, in the given precedence:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>from message body if its a <code>java.util.Map</code></p> </li> <li> <p>from message headers</p> </li> </ol> </div> <div class="paragraph"> <p>If a named parameter cannot be resolved, then an exception is thrown.</p> </div> <div class="paragraph"> <p>You can use Simple expressions as parameters as shown:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">sql:select * from table where id=:#${property.myId} order by name[?options]</code></pre> </div> </div> <div class="paragraph"> <p>Notice that the standard <code>?</code> symbol that denotes the parameters to an SQL query is substituted with the <code>#</code> symbol, because the <code>?</code> symbol is used to specify options for the endpoint. The <code>?</code> symbol replacement can be configured on endpoint basis.</p> </div> <div class="paragraph"> <p>You can externalize your SQL queries to files in the classpath or file system as shown:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">sql:classpath:sql/myquery.sql[?options]</code></pre> </div> </div> <div class="paragraph"> <p>And the myquery.sql file is in the classpath and is just a plain text</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">-- this is a comment
select *
from table
where
  id = :#${property.myId}
order by
  name</code></pre> </div> </div> <div class="paragraph"> <p>In the file you can use multilines and format the SQL as you wish. And also use comments such as the – dash line.</p> </div> <div class="paragraph"> <p>You can append query options to the URI in the following format, <code>?option=value&amp;option=value&amp;&#8230;&#8203;</code></p> </div> </div> </div> <div class="sect1"> <h2 id="_options"><a class="anchor" href="#_options"></a>Options</h2> <div class="sectionbody"> <div class="paragraph"> <p>The SQL component supports 3 options, which are listed below.</p> </div> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> <th class="tableblock halign-center valign-top">Default</th> <th class="tableblock halign-left valign-top">Type</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dataSource</strong> (common)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets the DataSource to use to communicate with the database.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">DataSource</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>usePlaceholder</strong> (advanced)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether to use placeholder and replace all placeholder characters with sign in the SQL queries. This option is default true</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>basicPropertyBinding</strong> (advanced)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether the component should use basic property binding (Camel 2.x) or the newer property binding with additional capabilities</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> </tbody> </table></div> <div class="paragraph"> <p>The SQL endpoint is configured using URI syntax:</p> </div> <div class="listingblock"> <div class="content"> <pre>sql:query</pre> </div> </div> <div class="paragraph"> <p>with the following path and query parameters:</p> </div> <div class="sect2"> <h3 id="_path_parameters_1_parameters"><a class="anchor" href="#_path_parameters_1_parameters"></a>Path Parameters (1 parameters):</h3> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> <th class="tableblock halign-center valign-top">Default</th> <th class="tableblock halign-left valign-top">Type</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>query</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Required</strong> Sets the SQL query to perform. You can externalize the query by using file: or classpath: as prefix and specify the location of the file.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> </tbody> </table></div> </div> <div class="sect2"> <h3 id="_query_parameters_48_parameters"><a class="anchor" href="#_query_parameters_48_parameters"></a>Query Parameters (48 parameters):</h3> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> <th class="tableblock halign-center valign-top">Default</th> <th class="tableblock halign-left valign-top">Type</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>allowNamedParameters</strong> (common)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether to allow using named parameters in the queries.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dataSource</strong> (common)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets the DataSource to use to communicate with the database.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">DataSource</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dataSourceRef</strong> (common)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Deprecated</strong> Sets the reference to a DataSource to lookup from the registry, to use for communicating with the database.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>outputClass</strong> (common)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specify the full package and class name to use as conversion when outputType=SelectOne.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>outputHeader</strong> (common)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Store the query result in a header instead of the message body. By default, outputHeader == null and the query result is stored in the message body, any existing content in the message body is discarded. If outputHeader is set, the value is used as the name of the header to store the query result and the original message body is preserved.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>outputType</strong> (common)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Make the output of consumer or producer to SelectList as List of Map, or SelectOne as single Java object in the following way: a) If the query has only single column, then that JDBC Column object is returned. (such as SELECT COUNT( ) FROM PROJECT will return a Long object. b) If the query has more than one column, then it will return a Map of that result. c) If the outputClass is set, then it will convert the query result into an Java bean object by calling all the setters that match the column names. It will assume your class has a default constructor to create instance with. d) If the query resulted in more than one rows, it throws an non-unique result exception.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">SelectList</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">SqlOutputType</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>separator</strong> (common)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The separator to use when parameter values is taken from message body (if the body is a String type), to be inserted at # placeholders. Notice if you use named parameters, then a Map type is used instead. The default value is comma.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">,</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>breakBatchOnConsumeFail</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether to break batch if onConsume failed.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>bridgeErrorHandler</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>expectedUpdateCount</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets an expected update count to validate when using onConsume.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">-1</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>maxMessagesPerPoll</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum number of messages to poll</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>onConsume</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">After processing each row then this query can be executed, if the Exchange was processed successfully, for example to mark the row as processed. The query can have parameter.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>onConsumeBatchComplete</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">After processing the entire batch, this query can be executed to bulk update rows etc. The query cannot have parameters.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>onConsumeFailed</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">After processing each row then this query can be executed, if the Exchange failed, for example to mark the row as failed. The query can have parameter.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>routeEmptyResultSet</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether empty resultset should be allowed to be sent to the next hop. Defaults to false. So the empty resultset will be filtered out.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>sendEmptyMessageWhenIdle</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If the polling consumer did not poll any files, you can enable this option to send an empty message (no body) instead.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>transacted</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables transaction. If enabled then if processing an exchange failed then the consumer break out processing any further exchanges to cause a rollback eager</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>useIterator</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets how resultset should be delivered to route. Indicates delivery as either a list or individual object. defaults to true.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>exceptionHandler</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this option is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">ExceptionHandler</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>exchangePattern</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets the exchange pattern when the consumer creates an exchange.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">ExchangePattern</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>pollStrategy</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">A pluggable org.apache.camel.PollingConsumerPollingStrategy allowing you to provide your custom implementation to control error handling usually occurred during the poll operation before an Exchange have been created and being routed in Camel.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">PollingConsumerPollStrategy</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>processingStrategy</strong> (consumer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Allows to plugin to use a custom org.apache.camel.component.sql.SqlProcessingStrategy to execute queries when the consumer has processed the rows/batch.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">SqlProcessingStrategy</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>batch</strong> (producer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables batch mode</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>lazyStartProducer</strong> (producer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether the producer should be started lazy (on the first message). By starting lazy you can use this to allow CamelContext and routes to startup in situations where a producer may otherwise fail during starting and cause the route to fail being started. By deferring this startup to be lazy then the startup failure can be handled during routing messages via Camel&#8217;s routing error handlers. Beware that when the first message is processed then creating and starting the producer may take a little time and prolong the total processing time of the processing.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>noop</strong> (producer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If set, will ignore the results of the SQL query and use the existing IN message as the OUT message for the continuation of processing</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>useMessageBodyForSql</strong> (producer)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use the message body as the SQL and then headers for parameters. If this option is enabled then the SQL in the uri is not used.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>alwaysPopulateStatement</strong> (advanced)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If enabled then the populateStatement method from org.apache.camel.component.sql.SqlPrepareStatementStrategy is always invoked, also if there is no expected parameters to be prepared. When this is false then the populateStatement is only invoked if there is 1 or more expected parameters to be set; for example this avoids reading the message body/headers for SQL queries with no parameters.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>basicPropertyBinding</strong> (advanced)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether the endpoint should use basic property binding (Camel 2.x) or the newer property binding with additional capabilities</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>parametersCount</strong> (advanced)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If set greater than zero, then Camel will use this count value of parameters to replace instead of querying via JDBC metadata API. This is useful if the JDBC vendor could not return correct parameters count, then user may override instead.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>placeholder</strong> (advanced)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a character that will be replaced to in SQL query. Notice, that it is simple String.replaceAll() operation and no SQL parsing is involved (quoted strings will also change).</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">#</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>prepareStatementStrategy</strong> (advanced)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Allows to plugin to use a custom org.apache.camel.component.sql.SqlPrepareStatementStrategy to control preparation of the query and prepared statement.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">SqlPrepareStatementStrategy</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>synchronous</strong> (advanced)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>templateOptions</strong> (advanced)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Configures the Spring JdbcTemplate with the key/values from the Map</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>usePlaceholder</strong> (advanced)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether to use placeholder and replace all placeholder characters with sign in the SQL queries. This option is default true</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>backoffErrorThreshold</strong> (scheduler)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The number of subsequent error polls (failed due some error) that should happen before the backoffMultipler should kick-in.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>backoffIdleThreshold</strong> (scheduler)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The number of subsequent idle polls that should happen before the backoffMultipler should kick-in.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>backoffMultiplier</strong> (scheduler)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">To let the scheduled polling consumer backoff if there has been a number of subsequent idles/errors in a row. The multiplier is then the number of polls that will be skipped before the next actual attempt is happening again. When this option is in use then backoffIdleThreshold and/or backoffErrorThreshold must also be configured.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>delay</strong> (scheduler)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Milliseconds before the next poll. You can also specify time values using units, such as 60s (60 seconds), 5m30s (5 minutes and 30 seconds), and 1h (1 hour).</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">500</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>greedy</strong> (scheduler)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If greedy is enabled, then the ScheduledPollConsumer will run immediately again, if the previous run polled 1 or more messages.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>initialDelay</strong> (scheduler)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Milliseconds before the first poll starts. You can also specify time values using units, such as 60s (60 seconds), 5m30s (5 minutes and 30 seconds), and 1h (1 hour).</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1000</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>repeatCount</strong> (scheduler)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a maximum limit of number of fires. So if you set it to 1, the scheduler will only fire once. If you set it to 5, it will only fire five times. A value of zero or negative means fire forever.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>runLoggingLevel</strong> (scheduler)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The consumer logs a start/complete log line when it polls. This option allows you to configure the logging level for that.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">TRACE</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">LoggingLevel</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>scheduledExecutorService</strong> (scheduler)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Allows for configuring a custom/shared thread pool to use for the consumer. By default each consumer has its own single threaded thread pool.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">ScheduledExecutorService</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>scheduler</strong> (scheduler)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">To use a cron scheduler from either camel-spring or camel-quartz component</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">none</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>schedulerProperties</strong> (scheduler)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">To configure additional properties when using a custom scheduler or any of the Quartz, Spring based scheduler.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>startScheduler</strong> (scheduler)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether the scheduler should be auto started.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>timeUnit</strong> (scheduler)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Time unit for initialDelay and delay options.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">MILLISECONDS</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">TimeUnit</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>useFixedDelay</strong> (scheduler)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Controls if fixed delay or fixed rate is used. See ScheduledExecutorService in JDK for details.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> </tr> </tbody> </table></div> </div> </div> </div> <div class="sect1"> <h2 id="_spring_boot_auto_configuration"><a class="anchor" href="#_spring_boot_auto_configuration"></a>Spring Boot Auto-Configuration</h2> <div class="sectionbody"> <div class="paragraph"> <p>When using Spring Boot make sure to use the following Maven dependency to have support for auto configuration:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-sql-starter&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
  &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>The component supports 4 options, which are listed below.</p> </div> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> <th class="tableblock halign-center valign-top">Default</th> <th class="tableblock halign-left valign-top">Type</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.component.sql.basic-property-binding</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether the component should use basic property binding (Camel 2.x) or the newer property binding with additional capabilities</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.component.sql.data-source</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets the DataSource to use to communicate with the database. The option is a javax.sql.DataSource type.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.component.sql.enabled</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Enable sql component</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.component.sql.use-placeholder</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether to use placeholder and replace all placeholder characters with sign in the SQL queries. This option is default true</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> </tbody> </table></div> </div> </div> <div class="sect1"> <h2 id="_treatment_of_the_message_body"><a class="anchor" href="#_treatment_of_the_message_body"></a>Treatment of the message body</h2> <div class="sectionbody"> <div class="paragraph"> <p>The SQL component tries to convert the message body to an object of <code>java.util.Iterator</code> type and then uses this iterator to fill the query parameters (where each query parameter is represented by a <code>#</code> symbol (or configured placeholder) in the endpoint URI). If the message body is not an array or collection, the conversion results in an iterator that iterates over only one object, which is the body itself.</p> </div> <div class="paragraph"> <p>For example, if the message body is an instance of <code>java.util.List</code>, the first item in the list is substituted into the first occurrence of <code>#</code> in the SQL query, the second item in the list is substituted into the second occurrence of <code>#</code>, and so on.</p> </div> <div class="paragraph"> <p>If <code>batch</code> is set to <code>true</code>, then the interpretation of the inbound message body changes slightly – instead of an iterator of parameters, the component expects an iterator that contains the parameter iterators; the size of the outer iterator determines the batch size.</p> </div> <div class="paragraph"> <p>You can use the option useMessageBodyForSql that allows to use the message body as the SQL statement, and then the SQL parameters must be provided in a header with the key SqlConstants.SQL_PARAMETERS. This allows the SQL component to work more dynamic as the SQL query is from the message body.</p> </div> </div> </div> <div class="sect1"> <h2 id="_result_of_the_query"><a class="anchor" href="#_result_of_the_query"></a>Result of the query</h2> <div class="sectionbody"> <div class="paragraph"> <p>For <code>select</code> operations, the result is an instance of <code>List&lt;Map&lt;String, Object&gt;&gt;</code> type, as returned by the <a href="http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/jdbc/core/JdbcTemplate.html#queryForList(java.lang.String,%20java.lang.Object%91%93)">JdbcTemplate.queryForList()</a> method. For <code>update</code> operations, a <code>NULL</code> body is returned as the <code>update</code> operation is only set as a header and never as a body.</p> </div> <div class="admonitionblock note"> <div class="table-wrapper"><table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> See <a href="#sql-component-header-values">Header values</a> for more information on the <code>update</code> operation. </td> </tr> </table></div> </div> <div class="paragraph"> <p>By default, the result is placed in the message body. If the outputHeader parameter is set, the result is placed in the header. This is an alternative to using a full message enrichment pattern to add headers, it provides a concise syntax for querying a sequence or some other small value into a header. It is convenient to use outputHeader and outputType together:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("jms:order.inbox")
    .to("sql:select order_seq.nextval from dual?outputHeader=OrderId&amp;outputType=SelectOne")
    .to("jms:order.booking");</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_using_streamlist"><a class="anchor" href="#_using_streamlist"></a>Using StreamList</h2> <div class="sectionbody"> <div class="paragraph"> <p>The producer supports outputType=StreamList that uses an iterator to stream the output of the query. This allows to process the data in a streaming fashion which for example can be used by the Splitter EIP to process each row one at a time, and load data from the database as needed.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:withSplitModel")
        .to("sql:select * from projects order by id?outputType=StreamList&amp;outputClass=org.apache.camel.component.sql.ProjectModel")
        .to("log:stream")
        .split(body()).streaming()
            .to("log:row")
            .to("mock:result")
        .end();</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="sql-component-header-values"><a class="anchor" href="#sql-component-header-values"></a>Header values</h2> <div class="sectionbody"> <div class="paragraph"> <p>When performing <code>update</code> operations, the SQL Component stores the update count in the following message headers:</p> </div> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Header</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>CamelSqlUpdateCount</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The number of rows updated for <code>update</code> operations, returned as an <code>Integer</code> object. This header is not provided when using outputType=StreamList.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>CamelSqlRowCount</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The number of rows returned for <code>select</code> operations, returned as an <code>Integer</code> object. This header is not provided when using outputType=StreamList.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>CamelSqlQuery</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Query to execute. This query takes precedence over the query specified in the endpoint URI. Note that query parameters in the header <em>are</em> represented by a <code>?</code> instead of a <code>#</code> symbol</p></td> </tr> </tbody> </table></div> <div class="paragraph"> <p>When performing <code>insert</code> operations, the SQL Component stores the rows with the generated keys and number of these rown in the following message headers:</p> </div> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Header</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">CamelSqlGeneratedKeysRowCount</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The number of rows in the header that contains generated keys.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">CamelSqlGeneratedKeyRows</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Rows that contains the generated keys (a list of maps of keys).</p></td> </tr> </tbody> </table></div> </div> </div> <div class="sect1"> <h2 id="_generated_keys"><a class="anchor" href="#_generated_keys"></a>Generated keys</h2> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel 2.12.4, 2.13.1 and 2.14</strong></p> </div> <div class="paragraph"> <p>If you insert data using SQL INSERT, then the RDBMS may support auto generated keys. You can instruct the SQL producer to return the generated keys in headers.<br> To do that set the header <code>CamelSqlRetrieveGeneratedKeys=true</code>. Then the generated keys will be provided as headers with the keys listed in the table above.</p> </div> <div class="paragraph"> <p>You can see more details in this <a href="https://gitbox.apache.org/repos/asf?p=camel.git;a=blob;f=components/camel-sql/src/test/java/org/apache/camel/component/sql/SqlGeneratedKeysTest.java;h=54c19b7332bb0aa81ee24ff3d3a66885a6b9e9aa;hb=HEAD">unit test</a>.</p> </div> </div> </div> <div class="sect1"> <h2 id="_datasource"><a class="anchor" href="#_datasource"></a>DataSource</h2> <div class="sectionbody"> <div class="paragraph"> <p>You can now set a reference to a <code>DataSource</code> in the URI directly:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">sql:select * from table where id=# order by name?dataSource=myDS</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_using_named_parameters"><a class="anchor" href="#_using_named_parameters"></a>Using named parameters</h2> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel 2.11</strong></p> </div> <div class="paragraph"> <p>In the given route below, we want to get all the projects from the projects table. Notice the SQL query has 2 named parameters, :#lic and :#min.<br> Camel will then lookup for these parameters from the message body or message headers. Notice in the example above we set two headers with constant value<br> for the named parameters:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">   from("direct:projects")
     .setHeader("lic", constant("ASF"))
     .setHeader("min", constant(123))
     .to("sql:select * from projects where license = :#lic and id &gt; :#min order by id")</code></pre> </div> </div> <div class="paragraph"> <p>Though if the message body is a <code>java.util.Map</code> then the named parameters will be taken from the body.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">   from("direct:projects")
     .to("sql:select * from projects where license = :#lic and id &gt; :#min order by id")</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_using_expression_parameters_in_producers"><a class="anchor" href="#_using_expression_parameters_in_producers"></a>Using expression parameters in producers</h2> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel 2.14</strong></p> </div> <div class="paragraph"> <p>In the given route below, we want to get all the project from the database. It uses the body of the exchange for defining the license and uses the value of a property as the second parameter.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:projects")
  .setBody(constant("ASF"))
  .setProperty("min", constant(123))
  .to("sql:select * from projects where license = :#${body} and id &gt; :#${property.min} order by id")</code></pre> </div> </div> <div class="sect2"> <h3 id="_using_expression_parameters_in_consumers"><a class="anchor" href="#_using_expression_parameters_in_consumers"></a>Using expression parameters in consumers</h3> <div class="paragraph"> <p><strong>Available as of Camel 2.23</strong></p> </div> <div class="paragraph"> <p>When using the SQL component as consumer, you can now also use expression parameters (simple language) to build dynamic query parameters, such as calling a method on a bean to retrieve an id, date or something.</p> </div> <div class="paragraph"> <p>For example in the sample below we call the nextId method on the bean myIdGenerator:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("sql:select * from projects where id = :#${bean:myIdGenerator.nextId}")
    .to("mock:result");</code></pre> </div> </div> <div class="paragraph"> <p>And the bean has the following method:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static class MyIdGenerator {

    private int id = 1;

    public int nextId() {
        return id++;
    }</code></pre> </div> </div> <div class="paragraph"> <p>Notice that there is no existing <code>Exchange</code> with message body and headers, so the simple expression you can use in the consumer are most useable for calling bean methods as in this example.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_using_in_queries_with_dynamic_values"><a class="anchor" href="#_using_in_queries_with_dynamic_values"></a>Using IN queries with dynamic values</h2> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel 2.17</strong></p> </div> <div class="paragraph"> <p>The SQL producer allows to use SQL queries with IN statements where the IN values is dynamic computed. For example from the message body or a header etc.</p> </div> <div class="paragraph"> <p>To use IN you need to:</p> </div> <div class="ulist"> <ul> <li> <p>prefix the parameter name with <code>in:</code></p> </li> <li> <p>add <code>( )</code> around the parameter</p> </li> </ul> </div> <div class="paragraph"> <p>An example explains this better. The following query is used:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">-- this is a comment
select *
from projects
where project in (:#in:names)
order by id</code></pre> </div> </div> <div class="paragraph"> <p>In the following route:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:query")
    .to("sql:classpath:sql/selectProjectsIn.sql")
    .to("log:query")
    .to("mock:query");</code></pre> </div> </div> <div class="paragraph"> <p>Then the IN query can use a header with the key names with the dynamic values such as:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// use an array
template.requestBodyAndHeader("direct:query", "Hi there!", "names", new String[]{"Camel", "AMQ"});

// use a list
List&lt;String&gt; names = new ArrayList&lt;String&gt;();
names.add("Camel");
names.add("AMQ");

template.requestBodyAndHeader("direct:query", "Hi there!", "names", names);

// use a string separated values with comma
template.requestBodyAndHeader("direct:query", "Hi there!", "names", "Camel,AMQ");</code></pre> </div> </div> <div class="paragraph"> <p>The query can also be specified in the endpoint instead of being externalized (notice that externalizing makes maintaining the SQL queries easier)</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:query")
    .to("sql:select * from projects where project in (:#in:names) order by id")
    .to("log:query")
    .to("mock:query");</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_using_the_jdbc_based_idempotent_repository"><a class="anchor" href="#_using_the_jdbc_based_idempotent_repository"></a>Using the JDBC based idempotent repository</h2> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel 2.7</strong></p> </div> <div class="paragraph"> <p>In this section we will use the JDBC based idempotent repository.</p> </div> <div class="admonitionblock tip"> <div class="table-wrapper"><table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="paragraph"> <p><strong>Abstract class</strong></p> </div> <div class="paragraph"> <p>There is an abstract class <code>org.apache.camel.processor.idempotent.jdbc.AbstractJdbcMessageIdRepository</code> you can extend to build custom JDBC idempotent repository.</p> </div> </td> </tr> </table></div> </div> <div class="paragraph"> <p>First we have to create the database table which will be used by the idempotent repository. We use the following schema:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE CAMEL_MESSAGEPROCESSED ( processorName VARCHAR(255),
messageId VARCHAR(100) )</code></pre> </div> </div> <div class="paragraph"> <p>We added the createdAt column:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE CAMEL_MESSAGEPROCESSED ( processorName VARCHAR(255),
messageId VARCHAR(100), createdAt TIMESTAMP )</code></pre> </div> </div> <div class="admonitionblock warning"> <div class="table-wrapper"><table> <tr> <td class="icon"> <i class="fa icon-warning" title="Warning"></i> </td> <td class="content"> The SQL Server <strong>TIMESTAMP</strong> type is a fixed-length binary-string type. It does not map to any of the JDBC time types: <strong>DATE</strong>, <strong>TIME</strong>, or <strong>TIMESTAMP</strong>. </td> </tr> </table></div> </div> <div class="paragraph"> <p>When working with concurrent consumers it is crucial to create a unique constraint on the columns processorName and messageId. Because the syntax for this constraint differs from database to database, we do not show it here.</p> </div> <div class="sect2"> <h3 id="_customize_the_jdbc_idempotency_repository"><a class="anchor" href="#_customize_the_jdbc_idempotency_repository"></a>Customize the JDBC idempotency repository</h3> <div class="paragraph"> <p>You have a few options to tune the <code>org.apache.camel.processor.idempotent.jdbc.JdbcMessageIdRepository</code> for your needs:</p> </div> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Parameter</th> <th class="tableblock halign-left valign-top">Default Value</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">createTableIfNotExists</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Defines whether or not Camel should try to create the table if it doesn&#8217;t exist.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">tableExistsString</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">SELECT 1 FROM CAMEL_MESSAGEPROCESSED WHERE 1 = 0</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">This query is used to figure out whether the table already exists or not. It must throw an exception to indicate the table doesn&#8217;t exist.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">createString</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">CREATE TABLE CAMEL_MESSAGEPROCESSED (processorName VARCHAR(255), messageId VARCHAR(100), createdAt TIMESTAMP)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The statement which is used to create the table.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">queryString</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">SELECT COUNT(*) FROM CAMEL_MESSAGEPROCESSED WHERE processorName = ? AND messageId = ?</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The query which is used to figure out whether the message already exists in the repository (the result is not equals to '0'). It takes two parameters. This first one is the processor name (<code>String</code>) and the second one is the message id (<code>String</code>).</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">insertString</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">INSERT INTO CAMEL_MESSAGEPROCESSED (processorName, messageId, createdAt) VALUES (?, ?, ?)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The statement which is used to add the entry into the table. It takes three parameter. The first one is the processor name (<code>String</code>), the second one is the message id (<code>String</code>) and the third one is the timestamp (<code>java.sql.Timestamp</code>) when this entry was added to the repository.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">deleteString</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">DELETE FROM CAMEL_MESSAGEPROCESSED WHERE processorName = ? AND messageId = ?</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The statement which is used to delete the entry from the database. It takes two parameter. This first one is the processor name (<code>String</code>) and the second one is the message id (<code>String</code>).</p></td> </tr> </tbody> </table></div> </div> </div> </div> <div class="sect1"> <h2 id="_using_the_jdbc_based_aggregation_repository"><a class="anchor" href="#_using_the_jdbc_based_aggregation_repository"></a>Using the JDBC based aggregation repository</h2> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel 2.6</strong></p> </div> <div class="paragraph"> <p><code>JdbcAggregationRepository</code> is an <code>AggregationRepository</code> which on the fly persists the aggregated messages. This ensures that you will not loose messages, as the default aggregator will use an in memory only <code>AggregationRepository</code>. The <code>JdbcAggregationRepository</code> allows together with Camel to provide persistent support for the Aggregator.</p> </div> <div class="paragraph"> <p>Only when an Exchange has been successfully processed it will be marked as complete which happens when the <code>confirm</code> method is invoked on the <code>AggregationRepository</code>. This means if the same Exchange fails again it will be kept retried until it success.</p> </div> <div class="paragraph"> <p>You can use option <code>maximumRedeliveries</code> to limit the maximum number of redelivery attempts for a given recovered Exchange. You must also set the <code>deadLetterUri</code> option so Camel knows where to send the Exchange when the <code>maximumRedeliveries</code> was hit.</p> </div> <div class="paragraph"> <p>You can see some examples in the unit tests of camel-sql, for example <a href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-sql/src/test/java/org/apache/camel/processor/aggregate/jdbc/JdbcAggregateRecoverDeadLetterChannelTest.java">this test</a>.</p> </div> <div class="sect2"> <h3 id="_database"><a class="anchor" href="#_database"></a>Database</h3> <div class="paragraph"> <p>To be operational, each aggregator uses two table: the aggregation and completed one. By convention the completed has the same name as the aggregation one suffixed with <code>"_COMPLETED"</code>. The name must be configured in the Spring bean with the <code>RepositoryName</code> property. In the following example aggregation will be used.</p> </div> <div class="paragraph"> <p>The table structure definition of both table are identical: in both case a String value is used as key (<strong>id</strong>) whereas a Blob contains the exchange serialized in byte array.<br> However one difference should be remembered: the <strong>id</strong> field does not have the same content depending on the table.<br> In the aggregation table <strong>id</strong> holds the correlation Id used by the component to aggregate the messages. In the completed table, <strong>id</strong> holds the id of the exchange stored in corresponding the blob field.</p> </div> <div class="paragraph"> <p>Here is the SQL query used to create the tables, just replace <code>"aggregation"</code> with your aggregator repository name.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE aggregation (
 id varchar(255) NOT NULL,
 exchange blob NOT NULL,
 constraint aggregation_pk PRIMARY KEY (id)
);
CREATE TABLE aggregation_completed (
 id varchar(255) NOT NULL,
 exchange blob NOT NULL,
 constraint aggregation_completed_pk PRIMARY KEY (id)
);</code></pre> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="_storing_body_and_headers_as_text"><a class="anchor" href="#_storing_body_and_headers_as_text"></a>Storing body and headers as text</h2> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel 2.11</strong></p> </div> <div class="paragraph"> <p>You can configure the <code>JdbcAggregationRepository</code> to store message body and select(ed) headers as String in separate columns. For example to store the body, and the following two headers <code>companyName</code> and <code>accountName</code> use the following SQL:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE aggregationRepo3 (
 id varchar(255) NOT NULL,
 exchange blob NOT NULL,
 body varchar(1000),
 companyName varchar(1000),
 accountName varchar(1000),
 constraint aggregationRepo3_pk PRIMARY KEY (id)
);
CREATE TABLE aggregationRepo3_completed (
 id varchar(255) NOT NULL,
 exchange blob NOT NULL,
 body varchar(1000),
 companyName varchar(1000),
 accountName varchar(1000),
 constraint aggregationRepo3_completed_pk PRIMARY KEY (id)
);</code></pre> </div> </div> <div class="paragraph"> <p>And then configure the repository to enable this behavior as shown below:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="repo3"
  class="org.apache.camel.processor.aggregate.jdbc.JdbcAggregationRepository"&gt;
  &lt;property name="repositoryName" value="aggregationRepo3"/&gt;
  &lt;property name="transactionManager" ref="txManager3"/&gt;
  &lt;property name="dataSource" ref="dataSource3"/&gt;
  &lt;!-- configure to store the message body and following headers as text in the repo --&gt;
  &lt;property name="storeBodyAsText" value="true"/&gt;
  &lt;property name="headersToStoreAsText"&gt;
    &lt;list&gt;
      &lt;value&gt;companyName&lt;/value&gt;
      &lt;value&gt;accountName&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre> </div> </div> <div class="sect2"> <h3 id="_codec_serialization"><a class="anchor" href="#_codec_serialization"></a>Codec (Serialization)</h3> <div class="paragraph"> <p>Since they can contain any type of payload, Exchanges are not serializable by design. It is converted into a byte array to be stored in a database BLOB field. All those conversions are handled by the <code>JdbcCodec</code> class. One detail of the code requires your attention: the <code>ClassLoadingAwareObjectInputStream</code>.</p> </div> <div class="paragraph"> <p>The <code>ClassLoadingAwareObjectInputStream</code> has been reused from the <a href="http://activemq.apache.org/">Apache ActiveMQ</a> project. It wraps an <code>ObjectInputStream</code> and use it with the <code>ContextClassLoader</code> rather than the <code>currentThread</code> one. The benefit is to be able to load classes exposed by other bundles. This allows the exchange body and headers to have custom types object references.</p> </div> </div> <div class="sect2"> <h3 id="_transaction"><a class="anchor" href="#_transaction"></a>Transaction</h3> <div class="paragraph"> <p>A Spring <code>PlatformTransactionManager</code> is required to orchestrate transaction.</p> </div> <div class="sect3"> <h4 id="_service_startstop"><a class="anchor" href="#_service_startstop"></a>Service (Start/Stop)</h4> <div class="paragraph"> <p>The <code>start</code> method verify the connection of the database and the presence of the required tables. If anything is wrong it will fail during starting.</p> </div> </div> </div> <div class="sect2"> <h3 id="_aggregator_configuration"><a class="anchor" href="#_aggregator_configuration"></a>Aggregator configuration</h3> <div class="paragraph"> <p>Depending on the targeted environment, the aggregator might need some configuration. As you already know, each aggregator should have its own repository (with the corresponding pair of table created in the database) and a data source. If the default lobHandler is not adapted to your database system, it can be injected with the <code>lobHandler</code> property.</p> </div> <div class="paragraph"> <p>Here is the declaration for Oracle:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="lobHandler" class="org.springframework.jdbc.support.lob.OracleLobHandler"&gt;
  &lt;property name="nativeJdbcExtractor" ref="nativeJdbcExtractor"/&gt;
&lt;/bean&gt;
&lt;bean id="nativeJdbcExtractor"
  class="org.springframework.jdbc.support.nativejdbc.CommonsDbcpNativeJdbcExtractor"/&gt;
&lt;bean id="repo"
  class="org.apache.camel.processor.aggregate.jdbc.JdbcAggregationRepository"&gt;
  &lt;property name="transactionManager" ref="transactionManager"/&gt;
  &lt;property name="repositoryName" value="aggregation"/&gt;
  &lt;property name="dataSource" ref="dataSource"/&gt;
  &lt;!-- Only with Oracle, else use default --&gt;
  &lt;property name="lobHandler" ref="lobHandler"/&gt;
&lt;/bean&gt;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_optimistic_locking"><a class="anchor" href="#_optimistic_locking"></a>Optimistic locking</h3> <div class="paragraph"> <p>You can turn on <code>optimisticLocking</code> and use this JDBC based aggregation repository in a clustered environment where multiple Camel applications shared the same database for the aggregation repository. If there is a race condition there JDBC driver will throw a vendor specific exception which the <code>JdbcAggregationRepository</code> can react upon. To know which caused exceptions from the JDBC driver is regarded as an optimistick locking error we need a mapper to do this. Therefore there is a <code>org.apache.camel.processor.aggregate.jdbc.JdbcOptimisticLockingExceptionMapper</code> allows you to implement your custom logic if needed. There is a default implementation <code>org.apache.camel.processor.aggregate.jdbc.DefaultJdbcOptimisticLockingExceptionMapper</code> which works as follows:</p> </div> <div class="paragraph"> <p>The following check is done:</p> </div> <div class="ulist"> <ul> <li> <p>If the caused exception is an <code>SQLException</code> then the SQLState is checked if starts with 23.</p> </li> <li> <p>If the caused exception is a <code>DataIntegrityViolationException</code></p> </li> <li> <p>If the caused exception class name has "ConstraintViolation" in its name.</p> </li> <li> <p>Optional checking for FQN class name matches if any class names has been configured.</p> </li> </ul> </div> <div class="paragraph"> <p>You can in addition add FQN classnames, and if any of the caused exception (or any nested) equals any of the FQN class names, then its an optimistick locking error.</p> </div> <div class="paragraph"> <p>Here is an example, where we define 2 extra FQN class names from the JDBC vendor.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="repo"
class="org.apache.camel.processor.aggregate.jdbc.JdbcAggregationRepository"&gt;
  &lt;property name="transactionManager" ref="transactionManager"/&gt;
  &lt;property name="repositoryName" value="aggregation"/&gt;
  &lt;property name="dataSource" ref="dataSource"/&gt;
  &lt;property name="jdbcOptimisticLockingExceptionMapper" ref="myExceptionMapper"/&gt;
&lt;/bean&gt;
&lt;!-- use the default mapper with extraFQN class names from our JDBC driver --&gt;
&lt;bean id="myExceptionMapper" class="org.apache.camel.processor.aggregate.jdbc.DefaultJdbcOptimisticLockingExceptionMapper"&gt;
  &lt;property name="classNames"&gt;
    &lt;util:set&gt;
      &lt;value&gt;com.foo.sql.MyViolationExceptoion&lt;/value&gt;
      &lt;value&gt;com.foo.sql.MyOtherViolationExceptoion&lt;/value&gt;
    &lt;/util:set&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_propagation_behavior"><a class="anchor" href="#_propagation_behavior"></a>Propagation behavior</h3> <div class="paragraph"> <p><code>JdbcAggregationRepository</code> uses two distinct <em>transaction templates</em> from Spring-TX. One is read-only and one is used for read-write operations.</p> </div> <div class="paragraph"> <p>However, when using <code>JdbcAggregationRepository</code> within a route that itself uses <code>&lt;transacted /&gt;</code> and there&#8217;s common <code>PlatformTransactionManager</code> used, there may be a need to configure <em>propagation behavior</em> used by transaction templates inside <code>JdbcAggregationRepository</code>.</p> </div> <div class="paragraph"> <p>Here&#8217;s a way to do it:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="repo"
class="org.apache.camel.processor.aggregate.jdbc.JdbcAggregationRepository"&gt;
  &lt;property name="propagationBehaviorName" value="PROPAGATION_NESTED" /&gt;
&lt;/bean&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Propagation is specified by constants of <code>org.springframework.transaction.TransactionDefinition</code> interface, so <code>propagationBehaviorName</code> is convenient setter that allows to use names of the constants.</p> </div> </div> <div class="sect2"> <h3 id="_postgresql_case"><a class="anchor" href="#_postgresql_case"></a>PostgreSQL case</h3> <div class="paragraph"> <p>There&#8217;s special database that may cause problems with optimistic locking used by <code>JdbcAggregationRepository</code>. PostgreSQL marks connection as invalid in case of data integrity violation exception (the one with SQLState 23505). This makes the connection effectively unusable within nested transaction. Details can be found <a href="https://www.postgresql.org/message-id/200609241203.59292.ralf.wiebicke%40exedio.com">in this document</a>.</p> </div> <div class="paragraph"> <p><code>org.apache.camel.processor.aggregate.jdbc.PostgresAggregationRepository</code> extends <code>JdbcAggregationRepository</code> and uses special <code>INSERT .. ON CONFLICT ..</code> statement to provide optimistic locking behavior.</p> </div> <div class="paragraph"> <p>This statement is (with default aggregation table definition):</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">INSERT INTO aggregation (id, exchange) values (?, ?) ON CONFLICT DO NOTHING</code></pre> </div> </div> <div class="paragraph"> <p>Details can be found <a href="https://www.postgresql.org/docs/9.5/sql-insert.html">in PostgreSQL documentation</a>.</p> </div> <div class="paragraph"> <p>When this clause is used, <code>java.sql.PreparedStatement.executeUpdate()</code> call returns <code>0</code> instead of throwing SQLException with SQLState=23505. Further handling is exactly the same as with generic <code>JdbcAggregationRepository</code>, but without marking PostgreSQL connection as invalid.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_camel_sql_starter"><a class="anchor" href="#_camel_sql_starter"></a>Camel Sql Starter</h2> <div class="sectionbody"> <div class="paragraph"> <p>A starter module is available to spring-boot users. When using the starter, the <code>DataSource</code> can be directly configured using spring-boot properties.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"># Example for a mysql datasource
spring.datasource.url=jdbc:mysql://localhost/test
spring.datasource.username=dbuser
spring.datasource.password=dbpass
spring.datasource.driver-class-name=com.mysql.jdbc.Driver</code></pre> </div> </div> <div class="paragraph"> <p>To use this feature, add the following dependencies to your spring boot pom.xml file:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;artifactId&gt;camel-sql-starter&lt;/artifactId&gt;
    &lt;version&gt;${camel.version}&lt;/version&gt; &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
    &lt;version&gt;${spring-boot-version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>You should also include the specific database driver, if needed.</p> </div> </div> </div> </article> </main> </div> <footer> <div class="footer"> <figure class="logo"> <img src="../../_/img/logo-d.svg" class="logo-small mt-60" alt="Apache Camel Logo" aria-label="white silhouette of a camel in front of a sand dune"> </figure> <dl> <dt>Overview</dt> <dd><a href="../../blog/">Blog</a></dd> <dd><a href="../../components/latest/">Components</a></dd> <dd><a href="../../download/">Download</a></dd> <dd><a href="../../docs/getting-started/">Getting started</a></dd> <dd><a href="../../manual/latest/faq.html">FAQ</a></dd> </dl> <dl> <dt>Community</dt> <dd><a href="../../community/support/">Support</a></dd> <dd><a href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a></dd> <dd><a href="../../community/user-stories/">User stories</a></dd> <dd><a href="../../community/articles/">Articles</a></dd> <dd><a href="../../community/books/">Books</a></dd> <dd><a href="../../community/team/">Team</a></dd> </dl> <dl> <dt>About</dt> <dd><a href="../../acknowledgments/">Acknowledgments</a> </dd><dd><a target="_blank" href="https://www.apache.org/events/current-event.html" title="Apache Events">Apache Events</a></dd> <dd><a target="_blank" href="https://www.apache.org/licenses/" title="License">License</a></dd> <dd><a target="_blank" href="https://www.apache.org/security/" title="Security">Security</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/sponsorship.html" title="Sponsorship">Sponsorship</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/thanks.html" title="Thanks">Thanks</a></dd> </dl> <p> &copy; 2004-2019 The <a href="https://apache.org">Apache Software Foundation</a>.<br> Apache Camel, Camel, Apache, the Apache feather logo, and the Apache Camel project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners. </p> </div> </footer> <script src="../../_/js/site-f4f4dbc142.js"></script> <script async src="../../_/js/vendor/highlight-54157f17f1.js"></script> <script async src="../../_/js/vendor/svg4everybody-195d47ce7d.js"></script> <script type="application/ld+json"> {
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "Apache Camel",
  "url": "https://camel.apache.org",
  "sameAs": [
     "https://twitter.com/ApacheCamel"
  ],
  "logo": "../../_/img/logo-d.svg",
  "description": "Apache Camel ™ is a versatile open-source integration framework based on known Enterprise Integration Patterns. Camel empowers you to define routing and mediation rules in a variety of domain-specific languages, including a Java-based Fluent API, Spring or Blueprint XML Configuration files, and a Scala DSL."
} </script> <script type="application/ld+json"> { 
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Apache Camel",
        "item": "https://camel.apache.org"
        },
        {
        "@type": "ListItem",
        "position": 2,
        "name": "Component reference",
        "item": "https://camel.apache.org/components/latest/index.html"
        },
        {
        "@type": "ListItem",
        "position": 3,
        "name": "SQL Component","item": "https://camel.apache.org/components/latest/sql-component.html"}
        ]
    } </script> </body> </html> 