<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Untitled :: Apache Camel</title><link rel="canonical" href="https://camel.apache.org/staging/manual/latest/backlog-tracer.html"><meta name="generator" content="Antora 2.0.0"><link rel="stylesheet" href="../../_/css/site.css"></head><body class="article"><header class="header"><nav class="navbar shadow border-bottom"><div class="navbar-brand"><a class="navbar-item nav-logo" href="../.." title="Apache Camel"></a><button class="navbar-burger" data-target="topbar-nav"><span></span><span></span><span></span></button></div><div id="topbar-nav" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="../../">Home</a><a class="navbar-item" href="../../news/">News</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="../..#">Projects</a><div class="navbar-dropdown"><a class="navbar-item" href="../../projects/camel-k/">Camel K</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="../..#">Documentation</a><div class="navbar-dropdown"><a class="navbar-item" href="../../docs/getting-started/">Getting started</a><a class="navbar-item" href="../../manual/latest/">User manual</a><a class="navbar-item" href="../../components/latest/">Component reference</a><a class="navbar-item" href="../../camel-k/latest/">Camel K</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="../..#">Community</a><div class="navbar-dropdown"><a class="navbar-item" href="../../community/support/">Support</a><a class="navbar-item" href="../..https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a><a class="navbar-item" href="../../community/user-stories/">User stories</a><a class="navbar-item" href="../../community/articles/">Articles</a><a class="navbar-item" href="../../community/books/">Books</a><a class="navbar-item" href="../../community/team/">Team</a><a class="navbar-item" href="../../community/camel-extra/">Camel extra</a></div></div><a class="navbar-item" href="../../download/">Download</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="../..#">About</a><div class="navbar-dropdown"><a class="navbar-item" href="../..https://www.apache.org/events/current-event.html">Apache events</a><a class="navbar-item" href="../..https://www.apache.org/licenses/">License</a><a class="navbar-item" href="../..https://www.apache.org/security/">Security</a><a class="navbar-item" href="../..https://www.apache.org/foundation/sponsorship.html">Sponsorship</a><a class="navbar-item" href="../..https://www.apache.org/foundation/thanks.html">Thanks</a></div></div></div></div></nav></header><div class="main-wrapper"><div class="navigation-container" data-component="manual" data-version="latest"><aside class="navigation"><div class="panels"><div class="navigation-menu is-active" data-panel="menu"><nav class="nav-menu"><h3 class="title"><a href="index.html">User manual</a></h3><ul class="nav-list"><li class="nav-item" data-depth="0"><ul class="nav-list"><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="getting-started.html">Getting started</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="book-getting-started.html">Getting Started with Apache Camel</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="architecture.html">Architecture</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="async.html">Async</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="backlogdebugger.html">Backlog debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bam.html">Business Activity Monitoring</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="batch-consumer.html">Batch Consumer</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="browsable-endpoint.html">BrowsableEndpoint</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camel-core.html">Core</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camelcontext.html">Context</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="endpoint.html">Endpoints</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="cep.html">Complex Event Processing</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="component.html">Component</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="debugger.html">Debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="delay-interceptor.html">Delay interceptor</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dependency-injection.html">Dependency Injection</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dozer-type-conversion.html">Dozer Type Conversion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bean-integration.html">Bean Integration</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="error-handler.html">Error Handler</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange.html">Message Exchange</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange-pattern.html">Exchange Pattern</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="expression.html">Expressions</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="injector.html">Injector</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="intercept.html">Intercept</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="inversion-of-control-with-smart-defaults.html">Inversion Of Control With Smart Defaults</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="jmx.html">JMX</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="lifecycle.html">Camel Lifecycle</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="oncompletion.html">OnCompletion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="predicate.html">Predicates</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="registry.html">Registry</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="route-builder.html">RouteBuilder</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="routes.html">Routes</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><span class="nav-text">Domain Specific Languages</span><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="dsl.html">Camel Domain Specific Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="java-dsl.html">Java DSL</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="spring.html">Spring support</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="groovy-dsl.html">Groovy DSL</a></li></ul></li><li class="nav-item" data-depth="1"><a class="nav-link" href="using-osgi-blueprint-with-camel.html">Using OSGi blueprint with Camel</a></li></ul></li></ul></nav></div><div class="navigation-explore" data-panel="explore"><div class="context"><span class="title">User manual</span><span class="version">latest</span></div><ul class="components"><li class="component"><span class="title">Apache Camel K</span><ul class="versions"><li class="version is-latest"><a href="../../camel-k/latest/index.html">latest</a></li></ul></li><li class="component"><span class="title">Component reference</span><ul class="versions"><li class="version is-latest"><a href="../../components/latest/index.html">latest</a></li></ul></li><li class="component is-current"><span class="title">User manual</span><ul class="versions"><li class="version is-current is-latest"><a href="index.html">latest</a></li></ul></li></ul></div></div></aside></div><main class="main"><div class="toolbar" role="navigation"><button class="navigation-toggle"></button><a href="index.html" class="home-link"></a><nav class="crumbs" aria-label="breadcrumbs"></nav><div class="edit-this-page"><a href="https://github.com/apache/camel/edit/master/docs/user-manual/modules/ROOT/pages/backlog-tracer.adoc">Edit this Page</a></div></div><article class="doc"><div class="sect2"><h3 id="BacklogTracer-BacklogTracerInterceptor"><a class="anchor" href="#BacklogTracer-BacklogTracerInterceptor"></a>BacklogTracer Interceptor</h3><div class="paragraph"><p><strong>Available as of Camel 2.11</strong></p></div><div class="paragraph"><p>Camel supports a backlog tracer interceptor that is used for capturing a trace message of each message as they are routed in Camel.<br>The trace message is stored in a backlog queue, which contains the last N messages for each node in the routes (by default 10).</p></div><div class="paragraph"><p>The BacklogTracer is an InterceptStrategy which can be applied to a DefaultCamelContext or SpringCamelContext to ensure that there is a TracerInterceptor created for every node in the DSL.</p></div><div class="paragraph"><p>You can enable or disable the BacklogTracer&#8217;s logging dynamically, by calling the backlogTracer&#8217;s<code>setEnabled</code>method.</p></div><div class="sect3"><h4 id="BacklogTracer-BacklogTracerDifference"><a class="anchor" href="#BacklogTracer-BacklogTracerDifference"></a>What is the difference between BacklogTracer and Tracer</h4><div class="paragraph"><p>Camel also provides a<a href="tracer.html">Tracer</a>which has similar capabilities as this backlog tracer. The difference is that the backlog tracer is storing<br>a capture of the message in an internal backlog queue. Where as the<a href="tracer.html">Tracer</a>is event based and logs the messages as they happen (or route to another Camel destination). Also the<a href="tracer.html">Tracer</a>has more fine grained events where it dives into<a href="enterprise-integration-patterns.adoc">EIP</a>s such as the<a href="content-based-router.html">Content Based Router</a>and traces the when/otherwise(s). Though the<a href="tracer.html">Tracer</a>has much more complicated logic to handle this (there is some edge-cases where this may not work). The BacklogTracer allows you to pull the messages from the backlog queues on demand. The BacklogTracer works better with JMX capable tooling as it is simpler and allow to bulk dump all its traced messages in either a POJO or XML format. And there is a Karaf command for the BacklogTracer which allows you to control the tracing from a Karaf shell.</p></div></div><div class="sect3"><h4 id="BacklogTracer-Options"><a class="anchor" href="#BacklogTracer-Options"></a>Options</h4><table class="tableblock frame-all grid-all stretch"><colgroup><col style="width: 10%;"><col style="width: 90%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Option</th><th class="tableblock halign-left valign-top">Default</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Flag to enable or disable this tracer</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">backlogSize</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of total traced messages to keep in the backlog (FIFO queue).</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">tracePattern</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Allows to filter tracing using a pattern that matches against the node id and route id. For example use<code>"to1,to2"</code>to match only nodes with either the name "to1", or "to2". You can use * for wildcards. So you can do "to*" to match any to. Or use "route-foo*" to match any foo routes.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">traceFilter</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Allow to configure a filter as a<a href="predicate.html">Predicate</a>using any of the Camel<a href="languages.adoc">languages</a>. But default the<a href="#simple-language">Simple</a>language is used. For example to filter on messages with a given header, use<code>${header.foo} != null</code>. To use<a href="groovy.html">Groovy</a>then prefix the value with "groovy:". And similar for the other languages.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">removeOnDump</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Whether to remove the traced messages that was returned when invoking the dump methods.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">bodyMaxChars</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>128kb</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">To limit the message body to a maximum size in the traced message. Use 0 or negative value to use unlimited size.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">bodyIncludeStreams</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include the message body of stream based messages. If enabled then beware the stream may not be re-readable later. See more about<a href="stream-caching.adoc">Stream Caching</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">bodyIncludeFiles</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td></tr></tbody></table></div><div class="sect3"><h4 id="BacklogTracer-Operations"><a class="anchor" href="#BacklogTracer-Operations"></a>Operations</h4><table class="tableblock frame-all grid-all stretch"><colgroup><col style="width: 10%;"><col style="width: 90%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Option</th><th class="tableblock halign-left valign-top">Default</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">getTraceCounter</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>long</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Gets the total number of traced messages.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">resetTraceCounter</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>void</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">To reset the trace counter.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">dumpTracedMessages(nodeOrRouteId)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;BacklogTracerEventMessage&gt;</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">To dump the traced messages from the give node or route id.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">dumpTracedMessagesAsXml(nodeOrRouteId)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">To dump the traced messages from the give node or route id in XML format.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">dumpAllTracedMessages</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;BacklogTracerEventMessage&gt;</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">To dump all the traced messages</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">dumpAllTracedMessagesAsXml</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td></tr></tbody></table></div><div class="sect3"><h4 id="BacklogTracer-Enabling"><a class="anchor" href="#BacklogTracer-Enabling"></a>Enabling</h4><div class="paragraph"><p>You would need to enable this using the JMX API.</p></div></div><div class="sect3"><h4 id="BacklogTracer-SeeAlso"><a class="anchor" href="#BacklogTracer-SeeAlso"></a>See Also</h4><div class="ulist"><ul><li><p><a href="tracer.html">Tracer</a></p></li><li><p><a href="tracer-example.html">Tracer Example</a></p></li><li><p><a href="debugger.adoc">Debugger</a></p></li><li><p><a href="delay-interceptor.adoc">Delay Interceptor</a></p></li><li><p><a href="#log-component">Log</a></p></li></ul></div></div></div></article></main></div><footer class="footer"><p>This page was built using the Antora default UI.</p><p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p></footer><script src="../../_/js/site.js"></script><script src="../../_/js/vendor/highlight.js"></script><script>hljs.initHighlighting()</script></body></html>