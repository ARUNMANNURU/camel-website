<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled :: Apache Camel</title>
    <link rel="canonical" href="https://camel.apache.org/manual/latest/error-handling-in-camel.html">
    <meta name="generator" content="Antora 2.0.0-rc.1">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://camel.apache.org">Apache Camel</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="manual" data-version="latest">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">User manual</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="getting-started.html">Getting started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="book-getting-started.html">Getting Started with Apache Camel</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="architecture.html">Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="async.html">Async</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="backlogdebugger.html">Backlog debugger</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="bam.html">Business Activity Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="batch-consumer.html">Batch Consumer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="browsable-endpoint.html">BrowsableEndpoint</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="camel-core.html">Core</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="camelcontext.html">Context</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="endpoint.html">Endpoints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cep.html">Complex Event Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="component.html">Component</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="debugger.html">Debugger</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="delay-interceptor.html">Delay interceptor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="dependency-injection.html">Dependency Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="dozer-type-conversion.html">Dozer Type Conversion</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="bean-integration.html">Bean Integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="error-handler.html">Error Handler</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exchange.html">Message Exchange</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exchange-pattern.html">Exchange Pattern</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="expression.html">Expressions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="injector.html">Injector</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="intercept.html">Intercept</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="inversion-of-control-with-smart-defaults.html">Inversion Of Control With Smart Defaults</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lifecycle.html">Camel Lifecycle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="oncompletion.html">OnCompletion</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="predicate.html">Predicates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="registry.html">Registry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="route-builder.html">RouteBuilder</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="routes.html">Routes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Domain Specific Languages</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="dsl.html">Camel Domain Specific Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="java-dsl.html">Java DSL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spring.html">Spring support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="groovy-dsl.html">Groovy DSL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Scala DSL</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scala-dsl.html">About the Scala DSL</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scala-dsl-getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scala-dsl-eip.html">EIP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scala-dsl-supported-languages.html">Supported languages</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="using-osgi-blueprint-with-camel.html">Using OSGi blueprint with Camel</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">User manual</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Component reference</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../components/2.24.0-SNAPSHOT/index.html">2.24.0-SNAPSHOT</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">User manual</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
</nav>
</div>
<article class="doc">
<div class="sect2">
<h3 id="ErrorhandlinginCamel-ErrorhandlinginCamel"><a class="anchor" href="#ErrorhandlinginCamel-ErrorhandlinginCamel"></a>Error handling in Camel</h3>
<div class="paragraph">
<p>Error handling in Camel can roughly be separated into two distinct
types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>non transactional</p>
</li>
<li>
<p>transactional</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Where non transactional is the most common type that is enabled
out-of-the-box and handled by Camel itself. The transaction type is
handled by a backing system such as a J2EE application server.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Using try &#8230;&#8203; catch &#8230;&#8203; finally</strong></p>
</div>
<div class="paragraph">
<p>Related to error handling is the <a href="try-catch-finally.adoc">Try Catch
Finally</a> feature in Camel.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ErrorhandlinginCamel-Whendoesanerrorhappen"><a class="anchor" href="#ErrorhandlinginCamel-Whendoesanerrorhappen"></a>When does an error happen</h4>
<div class="paragraph">
<p>An error happens when</p>
</div>
<div class="ulist">
<ul>
<li>
<p>any uncaught exception is thrown during routing and processing of
messages within Camel</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
So think of this as a big exception interceptor that catches all
exceptions and handles what to do.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ErrorhandlinginCamel-Nontransactional"><a class="anchor" href="#ErrorhandlinginCamel-Nontransactional"></a>Non transactional</h4>
<div class="paragraph">
<p>By default Camel uses the non transaction type and orchestrates the
error handling during processing and routing.</p>
</div>
<div class="paragraph">
<p>As there isn&#8217;t a single error handling configuration that suites all
uses cases, you should consider altering the default configurations to
better suit you needs.</p>
</div>
</div>
<div class="sect3">
<h4 id="ErrorhandlinginCamel-Camel1.xdefaulterrorhandler"><a class="anchor" href="#ErrorhandlinginCamel-Camel1.xdefaulterrorhandler"></a>Camel 1.x default error handler</h4>
<div class="paragraph">
<p>In Camel 1.x a global <a href="#deadLetterChannel-eip">Dead Letter Channel</a>
is setup as the <a href="error-handler.adoc">Error Handler</a> by default. It&#8217;s
configured as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>redeliver up to 6 times</p>
</li>
<li>
<p>pause 1 second between each redelivery attempt</p>
</li>
<li>
<p>if all redelivery attempts failed then move exchange into the dead
letter queue</p>
</li>
<li>
<p>the default dead letter queue is a logger that logs the exchange at
ERROR level :star:</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Dead Letter Queue (*)</strong></p>
</div>
<div class="paragraph">
<p>A dead letter queue is like a black hole, it will consume the
<a href="exchange.adoc">Exchange</a> and the <a href="exchange.adoc">Exchange</a>
routing is ended with no indication that it failed.<br>
This works great in the <a href="#jms-component">JMS</a> Messaging world where we
don&#8217;t want a bad message to cause endless retries and causing the system
to exhaust. The message is said to be poison and thus we want to move it
to a dead letter queue so the system can continue to operate and work
with the next message.</p>
</div>
<div class="paragraph">
<p>This default does not go well with other transports using in a
request/reply messaging style. If the <a href="exchange.adoc">Exchange</a>
failed then the original caller will still want a response after the
failure.</p>
</div>
<div class="paragraph">
<p>So the bottom line is that you <strong>must</strong> configure and setup the error
handling strategies that suits your business needs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ErrorhandlinginCamel-Camel2.0onwardsdefaulterrorhandler"><a class="anchor" href="#ErrorhandlinginCamel-Camel2.0onwardsdefaulterrorhandler"></a>Camel 2.0 onwards default error handler</h4>
<div class="paragraph">
<p>In Camel 2.0 onwards a global
<a href="defaulterrorhandler.adoc">DefaultErrorHandler</a> is set up as the
<a href="error-handler.adoc">Error Handler</a> by default. It&#8217;s configured as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>no redeliveries</p>
</li>
<li>
<p>no dead letter queue</p>
</li>
<li>
<p>if the exchange failed an exception is thrown and propagated back to
the original caller wrapped in a <code>RuntimeCamelException</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ErrorhandlinginCamel-Scopes"><a class="anchor" href="#ErrorhandlinginCamel-Scopes"></a>Scopes</h4>
<div class="paragraph">
<p>Camel supports 2 scopes that is determined by the DSL in use:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">DSL</th>
<th class="tableblock halign-left valign-top">Scope 1</th>
<th class="tableblock halign-left valign-top">Scope 2</th>
<th class="tableblock halign-left valign-top">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML DSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CamelContext</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">route</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope 2 takes precedence over scope 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java/Scala DSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RouteBuilder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">route</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope 2 takes precedence over
scope 1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When using XML DSL then scope 1 applies for all routes. Where as when
using Java DSL then route 1 only applies for the given RouteBuilder
instance. So if you have multiple RouteBuilder&#8217;s then each route builder
has its own scope 1.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to share scope among RouteBuilder&#8217;s you can use class
inheritance and create a base class, and then extend this class for your
RouteBuilder&#8217;s and invoke the super.configure() method.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Mind that there was a bug in Camel that affected the scopes when using
multiple RouteBuilder classes. See more details at
<a href="https://issues.apache.org/jira/browse/CAMEL-5456">CAMEL-5456</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ErrorhandlinginCamel-Howdoestheerrorhandlerwork"><a class="anchor" href="#ErrorhandlinginCamel-Howdoestheerrorhandlerwork"></a>How does the <a href="#deadLetterChannel-eip">Dead Letter Channel</a> error handler work</h4>
<div class="paragraph">
<p>When Camel is started it will inspect the routes and weave in the error
handling into the routing. With up to 3 supported scopes, the error
handling can be quite complex. And on top of that you have inherited
error handling and you can even configure
<a href="exception-clause.adoc">Exception Clause</a>s to handle specific
exception types differently. So yes it&#8217;s advanced but very powerful when
you get the grip of it.</p>
</div>
<div class="paragraph">
<p>To keep things simple we first look at the basic concept how Camel
orchestrates the redelivery attempt. At any given node in the route
graph Camel intercepts the current Exchange being routed and wraps it
with the <a href="error-handler.adoc">Error Handler</a>. This ensures that the
<a href="error-handler.adoc">Error Handler</a> can kick in, just as the AOP
around concept. If the exchange can be routed without any problems then
it&#8217;s forwarded to the next node in the route graph, <strong>But</strong> if there was
an exception thrown, then the <a href="error-handler.adoc">Error Handler</a>
kicks in and decides what to do.</p>
</div>
<div class="paragraph">
<p>An example illustrating this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">errorHandler(deadLetterChannel("jms:queue:dead"));

from("seda:newOrder")
   .to("bean:validateOrder")
   .to("bean:storeOrder")
   .to("bean:confirmOrder");</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this route we have 3 nodes (the dots) where the
<a href="error-handler.adoc">Error Handler</a> is watching us (The AOP around
stuff). So when an order arrives on the seda queue we consume it and
send it to the validateOrder bean. In case the validation bean processed
ok, we move on to the next node. In case the storeOrder bean failed and
throws an exception it&#8217;s caught by the
<a href="#deadLetterChannel-eip">Dead Letter Channel</a> that decides what to
do next. Either it does a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>redeliver</p>
</li>
<li>
<p>or move it to dead letter queue</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It will continue to do redeliveries based on the policy configured. By
default <a href="#deadLetterChannel-eip">Dead Letter Channel</a> will attempt
at most 6 redeliveries with 1 second delay. So if the storeOrder bean
did succeed at the 3rd attempt the routing will continue to the next
node the confirmOrder bean. In case all redeliveries failed the Exchange
is regarded as failed and is moved to the dead letter queue and the
processing of this exchange stops. By default the dead letter queue is
just a ERROR logger.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This applies to all kind of <a href="component.adoc">Components</a> in Camel.
The sample above only uses <a href="#bean-component">Bean</a> but it&#8217;s the same for
<a href="#file-component">File</a>, <a href="#mail-component">Mail</a>,
<a href="#velocity-component">Velocity</a> or whatever component you use.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ErrorhandlinginCamel-Transactional"><a class="anchor" href="#ErrorhandlinginCamel-Transactional"></a>Transactional</h4>
<div class="paragraph">
<p>Camel leverages Spring transactions. Usually you can only use this with
a limited number of transport types such as JMS or JDBC based, that yet
again requires a transaction manager such as a Spring transaction, a
J2EE server or a Message Broker.</p>
</div>
</div>
<div class="sect3">
<h4 id="ErrorhandlinginCamel-Howdoesitwork"><a class="anchor" href="#ErrorhandlinginCamel-Howdoesitwork"></a>How does it work</h4>
<div class="paragraph">
<p><strong>Camel 1.x</strong></p>
</div>
<div class="paragraph">
<p>Camel does the same weaving as for the non-transactional type. The
difference is that for transactional exchanges the
<a href="error-handler.adoc">Error Handler</a> does <strong>not</strong> kick in. You can say
the AOP around does not apply. Camel relies solely on the backing system
to orchestrate the error handling. And as such the when the backing
system does redeliver it will start all over again. For instance if the
exchange was started by a JMS consumer then it&#8217;s started again as the
JMS message is rolled back on the JMS queue and Camel will re consume
the JMS message again.</p>
</div>
<div class="paragraph">
<p><strong>Camel 2.0</strong></p>
</div>
<div class="paragraph">
<p>In Camel 2.0 we have empowered the
<a href="transactionerrorhandler.adoc">TransactionErrorHandler</a> to build on
top of the same base that
<a href="defaulterrorhandler.adoc">DefaultErrorHandler</a> does. This allows you
to use Camel redelivery with transactional routes as well. The Spring
transaction manager is still in charge and have the last say. But you
can use Camel to do some local redelivery, for instance to upload a file
to a FTP server, in which Camel can do local redelivery. So this gives
you the power from both worlds. In case Camel cannot redeliver the
exchange will be failed and rolled back. By default the
<a href="transactionerrorhandler.adoc">TransactionErrorHandler</a> does <strong>not</strong>
attempt any local redeliveries. You have to configure it to do so, for
instance to set a maximum redelivers to a number &gt; 0.</p>
</div>
<div class="paragraph">
<p>See <a href="#transactionalClient-eip">Transactional Client</a>
for more.</p>
</div>
</div>
<div class="sect3">
<h4 id="ErrorhandlinginCamel-Seealso"><a class="anchor" href="#ErrorhandlinginCamel-Seealso"></a>See also</h4>
<div class="ulist">
<ul>
<li>
<p><a href="error-handler.adoc">Error Handler</a></p>
</li>
<li>
<p><a href="#deadLetterChannel-eip">Dead Letter Channel</a></p>
</li>
<li>
<p><a href="exception-clause.adoc">Exception Clause</a></p>
</li>
<li>
<p><a href="#transactionalClient-eip">Transactional Client</a></p>
</li>
<li>
<p><a href="transactionerrorhandler.adoc">TransactionErrorHandler</a></p>
</li>
<li>
<p><a href="defaulterrorhandler.adoc">DefaultErrorHandler</a></p>
</li>
<li>
<p><a href="try-catch-finally.adoc">Try Catch Finally</a></p>
</li>
<li>
<p><a href="#loadBalance-eip">Failover Load Balancer</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
