<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Untitled :: Apache Camel</title><link rel="canonical" href="https://camel.apache.org/manual/latest/guice.html"><meta name="generator" content="Antora 2.0.0"><link rel="stylesheet" href="../../_/css/site.css"></head><body class="article"><header class="header"><nav class="navbar shadow border-bottom"><div class="navbar-brand"><a class="navbar-item nav-logo" href="https://camel.apache.org" title="Apache Camel"></a><button class="navbar-burger" data-target="topbar-nav"><span></span><span></span><span></span></button></div><div id="topbar-nav" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/news/">News</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Projects</a><div class="navbar-dropdown"><a class="navbar-item" href="/projects/camel-k/">Camel K</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Documentation</a><div class="navbar-dropdown"><a class="navbar-item" href="/docs/getting-started/">Getting started</a><a class="navbar-item" href="/manual/latest/">User manual</a><a class="navbar-item" href="/components/latest/">Component reference</a><a class="navbar-item" href="/camel-k/latest/">Camel K</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Community</a><div class="navbar-dropdown"><a class="navbar-item" href="/community/support/">Support</a><a class="navbar-item" href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a><a class="navbar-item" href="/community/user-stories/">User stories</a><a class="navbar-item" href="/community/articles/">Articles</a><a class="navbar-item" href="/community/books/">Books</a><a class="navbar-item" href="/community/team/">Team</a><a class="navbar-item" href="/community/camel-extra/">Camel extra</a></div></div><a class="navbar-item" href="/download/">Download</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">About</a><div class="navbar-dropdown"><a class="navbar-item" href="https://www.apache.org/events/current-event.html">Apache events</a><a class="navbar-item" href="https://www.apache.org/licenses/">License</a><a class="navbar-item" href="https://www.apache.org/security/">Security</a><a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a><a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a></div></div></div></div></nav></header><div class="main-wrapper"><div class="navigation-container" data-component="manual" data-version="latest"><aside class="navigation"><div class="panels"><div class="navigation-menu is-active" data-panel="menu"><nav class="nav-menu"><h3 class="title"><a href="index.html">User manual</a></h3><ul class="nav-list"><li class="nav-item" data-depth="0"><ul class="nav-list"><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="getting-started.html">Getting started</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="book-getting-started.html">Getting Started with Apache Camel</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="architecture.html">Architecture</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="async.html">Async</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="backlogdebugger.html">Backlog debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bam.html">Business Activity Monitoring</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="batch-consumer.html">Batch Consumer</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="browsable-endpoint.html">BrowsableEndpoint</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camel-core.html">Core</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camelcontext.html">Context</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="endpoint.html">Endpoints</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="cep.html">Complex Event Processing</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="component.html">Component</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="debugger.html">Debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="delay-interceptor.html">Delay interceptor</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dependency-injection.html">Dependency Injection</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dozer-type-conversion.html">Dozer Type Conversion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bean-integration.html">Bean Integration</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="error-handler.html">Error Handler</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange.html">Message Exchange</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange-pattern.html">Exchange Pattern</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="expression.html">Expressions</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="injector.html">Injector</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="intercept.html">Intercept</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="inversion-of-control-with-smart-defaults.html">Inversion Of Control With Smart Defaults</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="lifecycle.html">Camel Lifecycle</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="oncompletion.html">OnCompletion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="predicate.html">Predicates</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="registry.html">Registry</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="route-builder.html">RouteBuilder</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="routes.html">Routes</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><span class="nav-text">Domain Specific Languages</span><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="dsl.html">Camel Domain Specific Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="java-dsl.html">Java DSL</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="spring.html">Spring support</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="groovy-dsl.html">Groovy DSL</a></li><li class="nav-item" data-depth="2"><button class="nav-toggle"></button><span class="nav-text">Scala DSL</span><ul class="nav-list"><li class="nav-item" data-depth="3"><a class="nav-link" href="scala-dsl.html">About the Scala DSL</a></li><li class="nav-item" data-depth="3"><a class="nav-link" href="scala-dsl-getting-started.html">Getting Started</a></li><li class="nav-item" data-depth="3"><a class="nav-link" href="scala-dsl-eip.html">EIP</a></li><li class="nav-item" data-depth="3"><a class="nav-link" href="scala-dsl-supported-languages.html">Supported languages</a></li></ul></li></ul></li><li class="nav-item" data-depth="1"><a class="nav-link" href="using-osgi-blueprint-with-camel.html">Using OSGi blueprint with Camel</a></li></ul></li></ul></nav></div><div class="navigation-explore" data-panel="explore"><div class="context"><span class="title">User manual</span><span class="version">latest</span></div><ul class="components"><li class="component"><span class="title">Apache Camel K</span><ul class="versions"><li class="version is-latest"><a href="../../camel-k/latest/index.html">latest</a></li></ul></li><li class="component"><span class="title">Component reference</span><ul class="versions"><li class="version is-latest"><a href="../../components/latest/index.html">latest</a></li></ul></li><li class="component is-current"><span class="title">User manual</span><ul class="versions"><li class="version is-current is-latest"><a href="index.html">latest</a></li></ul></li></ul></div></div></aside></div><main class="main"><div class="toolbar" role="navigation"><button class="navigation-toggle"></button><a href="index.html" class="home-link"></a><nav class="crumbs" aria-label="breadcrumbs"></nav><div class="edit-this-page"><a href="https://github.com/apache/camel/edit/master/docs/user-manual/modules/ROOT/pages/guice.adoc">Edit this Page</a></div></div><article class="doc"><div class="sect2"><h3 id="Guice-CamelGuice"><a class="anchor" href="#Guice-CamelGuice"></a>Camel Guice</h3><div class="paragraph"><p>We have support for<a href="https://github.com/google/guice">Google Guice</a>as a dependency injection framework.</p></div><div class="paragraph"><p>Maven users will need to add the following dependency to their<code>pom.xml</code>for this component:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;artifactId&gt;camel-guice&lt;/artifactId&gt;
    &lt;version&gt;x.x.x&lt;/version&gt;
    &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;</code></pre></div></div><div class="sect3"><h4 id="Guice-DependencyInjectingCamelwithGuice"><a class="anchor" href="#Guice-DependencyInjectingCamelwithGuice"></a>Dependency Injecting Camel with Guice</h4><div class="paragraph"><p>The<a href="http://camel.apache.org/maven/current/camel-guice/apidocs/org/apache/camel/guice/GuiceCamelContext.html">GuiceCamelContext</a>is designed to work nicely inside Guice. You then need to bind it using some Guice Module.</p></div><div class="paragraph"><p>The camel-guice library comes with a number of reusable Guice Modules you can use if you wish - or you can bind the GuiceCamelContext yourself in your own module.</p></div><div class="ulist"><ul><li><p><a href="http://camel.apache.org/maven/current/camel-guice/apidocs/org/apache/camel/guice/CamelModule.html">CamelModule</a>is the base module which binds the GuiceCamelContext but leaves it up you to bind the RouteBuilder instances</p></li><li><p><a href="http://camel.apache.org/maven/current/camel-guice/apidocs/org/apache/camel/guice/CamelModuleWithRouteTypes.html">CamelModuleWithRouteTypes</a>extends CamelModule so that in the constructor of the module you specify the RouteBuilder classes or instances to use</p></li><li><p><a href="http://camel.apache.org/maven/current/camel-guice/apidocs/org/apache/camel/guice/CamelModuleWithMatchingRoutes.html">CamelModuleWithMatchingRoutes</a>extends CamelModule so that all bound RouteBuilder instances will be injected into the CamelContext or you can supply an optional Matcher to find RouteBuilder instances matching some kind of predicate.</p></li></ul></div><div class="paragraph"><p>So you can specify the exact<a href="route-builder.adoc">RouteBuilder</a>instances you want:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Injector injector = Guice.createInjector(new CamelModuleWithRouteTypes(MyRouteBuilder.class, AnotherRouteBuilder.class));
// if required you can lookup the CamelContext
CamelContext camelContext = injector.getInstance(CamelContext.class);</code></pre></div></div><div class="paragraph"><p>Or inject them all:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Injector injector = Guice.createInjector(new CamelModuleWithRouteTypes());
// if required you can lookup the CamelContext
CamelContext camelContext = injector.getInstance(CamelContext.class);</code></pre></div></div><div class="paragraph"><p>You can then use Guice in the usual way to inject the route instances or any other dependent objects.</p></div></div><div class="sect3"><h4 id="Guice-BootstrappingwithJNDI"><a class="anchor" href="#Guice-BootstrappingwithJNDI"></a>Bootstrapping with JNDI</h4><div class="paragraph"><p>A common pattern used in J2EE is to bootstrap your application or root objects by looking them up in JNDI. This has long been the approach when working with JMS for example - looking up the JMS ConnectionFactory in JNDI for example.</p></div><div class="paragraph"><p>You can follow a similar pattern with Guice using the<a href="https://code.google.com/archive/p/guiceyfruit/wikis/JNDI.wiki">GuiceyFruit JNDI Provider</a>which lets you bootstrap Guice from a<code>jndi.properties</code>file which can include the Guice Modules to create along with environment specific properties you can inject into your modules and objects.</p></div><div class="paragraph"><p>If the<code>jndi.properties</code>is conflict with other component, you can specify the jndi properties file name in the Guice Main with option<code>-j</code>or<code>-jndiProperties</code>with the properties file location to let Guice Main to load right jndi properties file.</p></div></div><div class="sect3"><h4 id="Guice-ConfiguringComponent"><a class="anchor" href="#Guice-ConfiguringComponent"></a>Configuring Component, Endpoint or RouteBuilder instances</h4><div class="paragraph"><p>You can use Guice to dependency inject whatever objects you need to create, be it an<a href="endpoint.adoc">Endpoint</a>,<a href="component.adoc">Component</a>,<a href="route-builder.adoc">RouteBuilder</a>or arbitrary<a href="bean-integration.adoc">bean used within a route</a>.</p></div><div class="paragraph"><p>The easiest way to do this is to create your own Guice Module class which extends one of the above module classes and add a provider method for each object you wish to create. A provider method is annotated with<code>@Provides</code>as follows:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyModule extends CamelModuleWithMatchingRoutes {

    @Provides
    @JndiBind("jms")
    JmsComponent jms(@Named("activemq.brokerURL") String brokerUrl) {
        return JmsComponent.jmsComponent(new ActiveMQConnectionFactory(brokerUrl));
    }
}</code></pre></div></div><div class="paragraph"><p>You can optionally annotate the method with<code>@JndiBind</code>to bind the object to JNDI at some name if the object is a component, endpoint or bean you wish to refer to by name in your routes.</p></div><div class="paragraph"><p>You can inject any environment specific properties (such as URLs, machine names, usernames/passwords and so forth) from the<code>jndi.properties</code>file easily using the<code>@Named</code>annotation as shown above. This allows most of your configuration to be in Java code which is typesafe and easily refactorable - then leaving some properties to be environment specific (the<code>jndi.properties</code>file) which you can then change based on development, testing, production, etc.</p></div></div><div class="sect3"><h4 id="Guice-CreatingmultipleRouteBuilderinstancespertype"><a class="anchor" href="#Guice-CreatingmultipleRouteBuilderinstancespertype"></a>Creating multiple RouteBuilder instances per type</h4><div class="paragraph"><p>It is sometimes useful to create multiple instances of a particular<a href="route-builder.adoc">RouteBuilder</a>with different configurations.</p></div><div class="paragraph"><p>To do this just create multiple provider methods for each configuration; or create a single provider method that returns a collection of RouteBuilder instances.</p></div><div class="paragraph"><p>For example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.apache.camel.guice.CamelModuleWithMatchingRoutes;
import com.google.common.collect.Lists;

public class MyModule extends CamelModuleWithMatchingRoutes {

    @Provides
    @JndiBind("foo")
    Collection&lt;RouteBuilder&gt; foo(@Named("fooUrl") String fooUrl) {
        return Lists.newArrayList(new MyRouteBuilder(fooUrl), new MyRouteBuilder("activemq:CheeseQueue"));
    }
}</code></pre></div></div></div><div class="sect3"><h4 id="Guice-SeeAlso"><a class="anchor" href="#Guice-SeeAlso"></a>See Also</h4><div class="ulist"><ul><li><p>There are a number of<a href="examples.adoc">Examples</a>you can look at to see Guice and Camel being used such as<a href="guice-jms-example.adoc">Guice JMS Example</a></p></li><li><p><a href="guice-maven-plugin.adoc">Guice Maven Plugin</a>for running your Guice based routes via Maven</p></li></ul></div></div></div></article></main></div><footer class="footer"><p>This page was built using the Antora default UI.</p><p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p></footer><script src="../../_/js/site.js"></script><script src="../../_/js/vendor/highlight.js"></script><script>hljs.initHighlighting()</script></body></html>