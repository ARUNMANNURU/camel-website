<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Untitled :: Apache Camel</title><link rel="canonical" href="https://camel.apache.org/manual/latest/http-session-handling.html"><meta name="generator" content="Antora 2.0.0-rc.2"><link rel="stylesheet" href="../../_/css/site.css"></head><body class="article"><header class="header"><nav class="navbar"><div class="navbar-brand"><a class="navbar-item" href="https://camel.apache.org">Apache Camel</a><button class="navbar-burger" data-target="topbar-nav"><span></span><span></span><span></span></button></div><div id="topbar-nav" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="#">Home</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Products</a><div class="navbar-dropdown"><a class="navbar-item" href="#">Product A</a><a class="navbar-item" href="#">Product B</a><a class="navbar-item" href="#">Product C</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Services</a><div class="navbar-dropdown"><a class="navbar-item" href="#">Service A</a><a class="navbar-item" href="#">Service B</a><a class="navbar-item" href="#">Service C</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Resources</a><div class="navbar-dropdown"><a class="navbar-item" href="#">Resource A</a><a class="navbar-item" href="#">Resource B</a><a class="navbar-item" href="#">Resource C</a></div></div><div class="navbar-item"><span class="control"><a class="button is-primary" href="#">Download</a></span></div></div></div></nav></header><div class="main-wrapper"><div class="navigation-container" data-component="manual" data-version="latest"><aside class="navigation"><div class="panels"><div class="navigation-menu is-active" data-panel="menu"><nav class="nav-menu"><h3 class="title"><a href="index.html">User manual</a></h3><ul class="nav-list"><li class="nav-item" data-depth="0"><ul class="nav-list"><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="getting-started.html">Getting started</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="book-getting-started.html">Getting Started with Apache Camel</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="architecture.html">Architecture</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="async.html">Async</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="backlogdebugger.html">Backlog debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bam.html">Business Activity Monitoring</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="batch-consumer.html">Batch Consumer</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="browsable-endpoint.html">BrowsableEndpoint</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camel-core.html">Core</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camelcontext.html">Context</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="endpoint.html">Endpoints</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="cep.html">Complex Event Processing</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="component.html">Component</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="debugger.html">Debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="delay-interceptor.html">Delay interceptor</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dependency-injection.html">Dependency Injection</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dozer-type-conversion.html">Dozer Type Conversion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bean-integration.html">Bean Integration</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="error-handler.html">Error Handler</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange.html">Message Exchange</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange-pattern.html">Exchange Pattern</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="expression.html">Expressions</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="injector.html">Injector</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="intercept.html">Intercept</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="inversion-of-control-with-smart-defaults.html">Inversion Of Control With Smart Defaults</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="lifecycle.html">Camel Lifecycle</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="oncompletion.html">OnCompletion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="predicate.html">Predicates</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="registry.html">Registry</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="route-builder.html">RouteBuilder</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="routes.html">Routes</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><span class="nav-text">Domain Specific Languages</span><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="dsl.html">Camel Domain Specific Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="java-dsl.html">Java DSL</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="spring.html">Spring support</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="groovy-dsl.html">Groovy DSL</a></li><li class="nav-item" data-depth="2"><button class="nav-toggle"></button><span class="nav-text">Scala DSL</span><ul class="nav-list"><li class="nav-item" data-depth="3"><a class="nav-link" href="scala-dsl.html">About the Scala DSL</a></li><li class="nav-item" data-depth="3"><a class="nav-link" href="scala-dsl-getting-started.html">Getting Started</a></li><li class="nav-item" data-depth="3"><a class="nav-link" href="scala-dsl-eip.html">EIP</a></li><li class="nav-item" data-depth="3"><a class="nav-link" href="scala-dsl-supported-languages.html">Supported languages</a></li></ul></li></ul></li><li class="nav-item" data-depth="1"><a class="nav-link" href="using-osgi-blueprint-with-camel.html">Using OSGi blueprint with Camel</a></li></ul></li></ul></nav></div><div class="navigation-explore" data-panel="explore"><div class="context"><span class="title">User manual</span><span class="version">latest</span></div><ul class="components"><li class="component"><span class="title">Apache Camel K</span><ul class="versions"><li class="version is-latest"><a href="../../camel-k/latest/index.html">latest</a></li></ul></li><li class="component"><span class="title">Component reference</span><ul class="versions"><li class="version is-latest"><a href="../../components/latest/index.html">latest</a></li></ul></li><li class="component is-current"><span class="title">User manual</span><ul class="versions"><li class="version is-current is-latest"><a href="index.html">latest</a></li></ul></li></ul></div></div></aside></div><main class="main"><div class="toolbar" role="navigation"><button class="navigation-toggle"></button><a href="index.html" class="home-link"></a><nav class="crumbs" aria-label="breadcrumbs"></nav></div><article class="doc"><div class="sect2"><h3 id="HTTP-SessionHandling-SessionScope"><a class="anchor" href="#HTTP-SessionHandling-SessionScope"></a>HTTP Session Handling</h3><div class="paragraph"><p><strong>Available as of Camel 2.19</strong></p></div><div class="paragraph"><p>Several Camel components can use HTTP as the underlying transport protocol. In general HTTP calls are stateless in nature, however some servers allow to maintain state via cookies. Cookies are often used to maintain a server session (e.g. via a session cookie called "JSESSIONID" with servers implementing the JEE Servlet specification).</p></div><div class="sect3"><h4 id="HTTP-SessionHandling-SessionScope"><a class="anchor" href="#HTTP-SessionHandling-SessionScope"></a>Session Scope</h4><div class="paragraph"><p>If a Camel route intends to implement some kind of HTTP session handling the scope of this session should be considered.</p></div><div class="paragraph"><p>Independently from the session scope the implementation must honor the domain of the handled cookies.</p></div></div><div class="sect3"><h4 id="HTTP-SessionHandling-RouteContextScope"><a class="anchor" href="#HTTP-SessionHandling-RouteContextScope"></a>Route/Context Scope</h4><div class="paragraph"><p>It might be desirable to have a single session for a route or a<a href="camelcontext.html">CamelContext</a>. This essentially means that all calls to a server issued from a route or CamelContext share a single HTTP session.</p></div></div><div class="sect3"><h4 id="HTTP-SessionHandling-EndpointScope"><a class="anchor" href="#HTTP-SessionHandling-EndpointScope"></a>Endpoint Scope</h4><div class="paragraph"><p>It is also possible to have a session on an<a href="endpoint.html">Endpoint</a>entity. This would mean that all invocations of an HTTP call issued by a single Endpoint share a session, whereas different Endpoints never share sessions, even if the call is sent to the same server. Some components like camel-http, and camel-http4 support endpoint scoped sessions even prior to version 2.19.</p></div></div><div class="sect3"><h4 id="HTTP-SessionHandling-ExchangeScope"><a class="anchor" href="#HTTP-SessionHandling-ExchangeScope"></a>Exchange Scope</h4><div class="paragraph"><p>The third option to define a session scope is on<a href="exchange.html">Exchange</a>level. This is particularly useful for scenarios where the server session is really maintaining state.</p></div><div class="paragraph"><p>In this case the route could e.g. first do a login call, then some update calls and finally a logout call. If the session handling would be defined on route or CamelContext scopes this would seem to run, however under load parallel invocations of the route would share a<strong>single</strong>session, which could cause issues. If the session is defined on exchange scope, each invocation of the route will get a separate session and the server can maintain a separate state for the different parallel invocations.</p></div></div><div class="sect3"><h4 id="HTTP-SessionHandling-Usage"><a class="anchor" href="#HTTP-SessionHandling-Usage"></a>Usage</h4><div class="paragraph"><p>If you are a Camel user, you see that several Camel components support the cookieHandler parameter on endpoint level. All you need to do is to instantiate a cookie handler  appropriate for your use case and reference it in the cookieHandler parameter for all endpoints that are supposed to participate in the HTTP session.</p></div><div class="paragraph"><p>There are two pre-implemented cookie handlers:<code>org.apache.camel.http.common.cookie.InstanceCookieHandler</code>and<code>org.apache.camel.http.common.cookie.ExchangeCookieHandler.</code></p></div><div class="paragraph"><p>The<code>InstanceCookieHandler</code>stores  cookies in an instance of itself. You can compare that with a browser instance that is shared between all the endpoints that use it (and will be used for all invocations of these endpoints). If you want to maintain separate sessions for different endpoints or groups of endpoints you may have multiple instances of the<code>InstanceCookieHandler</code>.</p></div><div class="paragraph"><p>The<code>ExchangeCookieHandler</code>stores the session in the exchange. With the browser analogy this means that each Exchange will get its own browser instance (so sessions are separated). As the<code>ExchangeCookieHandler</code>does not store any state it is generally not useful to have multiple<code>ExchangeCookieHandler</code>instances (as they would access the same data, anyway).</p></div></div><div class="sect3"><h4 id="HTTP-SessionHandling-Example"><a class="anchor" href="#HTTP-SessionHandling-Example"></a>Example</h4><div class="paragraph"><p>The following three routes will each do two invocations of an echo REST service. In the first route (without a cookie handler) each invocation will get a new session. For the second route all invocations will share a session. For the third route the first and the second invocation within the route share a session, but different (even parallel) invocations of the route will not share a session.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> &lt;cxf:rsClient id="rsClientProxy" address="http://127.0.0.1:8080/CxfRsProducerSessionTest/"
    serviceClass="org.apache.camel.component.cxf.jaxrs.testbean.EchoService"
    loggingFeatureEnabled="true" /&gt;

  &lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;
    &lt;route&gt;
       &lt;from uri="direct://proxy"/&gt;
       &lt;to uri="cxfrs://bean://rsClientProxy"/&gt;
       &lt;convertBodyTo type="java.lang.String"/&gt;
       &lt;to uri="cxfrs://bean://rsClientProxy"/&gt;
    &lt;/route&gt;
    &lt;route&gt;
       &lt;from uri="direct://proxyinstance"/&gt;
       &lt;to uri="cxfrs://bean://rsClientProxy?cookieHandler=#instanceCookieHandler"/&gt;
       &lt;convertBodyTo type="java.lang.String"/&gt;
       &lt;to uri="cxfrs://bean://rsClientProxy?cookieHandler=#instanceCookieHandler"/&gt;
    &lt;/route&gt;
    &lt;route&gt;
       &lt;from uri="direct://proxyexchange"/&gt;
       &lt;to uri="cxfrs://bean://rsClientProxy?cookieHandler=#exchangeCookieHandler"/&gt;
       &lt;convertBodyTo type="java.lang.String"/&gt;
       &lt;to uri="cxfrs://bean://rsClientProxy?cookieHandler=#exchangeCookieHandler"/&gt;
    &lt;/route&gt;
  &lt;/camelContext&gt;

  &lt;bean id="instanceCookieHandler" class="org.apache.camel.http.common.cookie.InstanceCookieHandler"/&gt;
  &lt;bean id="exchangeCookieHandler" class="org.apache.camel.http.common.cookie.ExchangeCookieHandler"/&gt;</code></pre></div></div></div><div class="sect3"><h4 id="HTTP-SessionHandling-ComponentDevelopers"><a class="anchor" href="#HTTP-SessionHandling-ComponentDevelopers"></a>Component Developers</h4><div class="paragraph"><p>If you want to develop a HTTP based component that is supposed to participate in a session you have to add the following parts to your code:</p></div><div class="olist arabic"><ol class="arabic"><li><p>Include a build reference to camel-http-common (if it is not already there)</p></li><li><p>Add a cookieHandler parameter to the endpoint class (together with getter and setter)</p></li><li><p>Before your code does the HTTP call, if a cookie handler is set on the endpoint perform a <code>cookieHandler.loadCookies(exchange, uri)</code>call. It will return a<code>Map&lt;String, List&lt;String&gt;&gt;</code>containing the headers that need to be sent to the server. The details how you need to send these headers to the server depend on the underlying HTTP API you are using.</p></li><li><p>After your code does receive the HTTP response if a cookie handler is set on the endpoint perform a<code>cookieHandler.storeCookies(exchange, uri, m)</code>call.<code>m</code>is a<code>Map&lt;String, List&lt;String&gt;&gt;</code>containing the HTTP headers returned from the server.</p></li></ol></div></div><div class="sect3"><h4 id="HTTP-SessionHandling-MoreInfo"><a class="anchor" href="#HTTP-SessionHandling-MoreInfo"></a>More Info</h4><div class="paragraph"><p>Some APIs provide more direct support for cookie handling. In this case it might be easier to get the underlying<code>java.net.CookieStore</code>with a<code>cookeManager.getCookieStore(exchange)</code>call and handle the cookies using the cookie interface provided by the underlying library.</p></div></div></div></article></main></div><footer class="footer"><p>This page was built using the Antora default UI.</p><p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p></footer><script src="../../_/js/site.js"></script><script src="../../_/js/vendor/highlight.js"></script><script>hljs.initHighlighting()</script></body></html>