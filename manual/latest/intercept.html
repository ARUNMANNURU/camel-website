<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Untitled :: Apache Camel</title><link rel="canonical" href="https://camel.apache.org/manual/latest/intercept.html"><meta name="generator" content="Antora 2.0.0"><link rel="stylesheet" href="../../_/css/site.css"></head><body class="article"><header class="header"><nav class="navbar shadow border-bottom"><div class="navbar-brand"><a class="navbar-item nav-logo" href="https://camel.apache.org" title="Apache Camel"></a><button class="navbar-burger" data-target="topbar-nav"><span></span><span></span><span></span></button></div><div id="topbar-nav" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/news/">News</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Projects</a><div class="navbar-dropdown"><a class="navbar-item" href="/projects/camel-k/">Camel K</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Documentation</a><div class="navbar-dropdown"><a class="navbar-item" href="/docs/getting-started/">Getting started</a><a class="navbar-item" href="/manual/latest/">User manual</a><a class="navbar-item" href="/components/latest/">Component reference</a><a class="navbar-item" href="/camel-k/latest/">Camel K</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Community</a><div class="navbar-dropdown"><a class="navbar-item" href="/community/support/">Support</a><a class="navbar-item" href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a><a class="navbar-item" href="/community/user-stories/">User stories</a><a class="navbar-item" href="/community/articles/">Articles</a><a class="navbar-item" href="/community/books/">Books</a><a class="navbar-item" href="/community/team/">Team</a><a class="navbar-item" href="/community/camel-extra/">Camel extra</a></div></div><a class="navbar-item" href="/download/">Download</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">About</a><div class="navbar-dropdown"><a class="navbar-item" href="https://www.apache.org/events/current-event.html">Apache events</a><a class="navbar-item" href="https://www.apache.org/licenses/">License</a><a class="navbar-item" href="https://www.apache.org/security/">Security</a><a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a><a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a></div></div></div></div></nav></header><div class="main-wrapper"><div class="navigation-container" data-component="manual" data-version="latest"><aside class="navigation"><div class="panels"><div class="navigation-menu is-active" data-panel="menu"><nav class="nav-menu"><h3 class="title"><a href="index.html">User manual</a></h3><ul class="nav-list"><li class="nav-item" data-depth="0"><ul class="nav-list"><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="getting-started.html">Getting started</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="book-getting-started.html">Getting Started with Apache Camel</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="architecture.html">Architecture</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="async.html">Async</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="backlogdebugger.html">Backlog debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bam.html">Business Activity Monitoring</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="batch-consumer.html">Batch Consumer</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="browsable-endpoint.html">BrowsableEndpoint</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camel-core.html">Core</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camelcontext.html">Context</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="endpoint.html">Endpoints</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="cep.html">Complex Event Processing</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="component.html">Component</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="debugger.html">Debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="delay-interceptor.html">Delay interceptor</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dependency-injection.html">Dependency Injection</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dozer-type-conversion.html">Dozer Type Conversion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bean-integration.html">Bean Integration</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="error-handler.html">Error Handler</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange.html">Message Exchange</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange-pattern.html">Exchange Pattern</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="expression.html">Expressions</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="injector.html">Injector</a></li><li class="nav-item is-current-page" data-depth="2"><a class="nav-link" href="intercept.html">Intercept</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="inversion-of-control-with-smart-defaults.html">Inversion Of Control With Smart Defaults</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="jmx.html">JMX</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="lifecycle.html">Camel Lifecycle</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="oncompletion.html">OnCompletion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="predicate.html">Predicates</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="registry.html">Registry</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="route-builder.html">RouteBuilder</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="routes.html">Routes</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><span class="nav-text">Domain Specific Languages</span><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="dsl.html">Camel Domain Specific Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="java-dsl.html">Java DSL</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="spring.html">Spring support</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="groovy-dsl.html">Groovy DSL</a></li></ul></li><li class="nav-item" data-depth="1"><a class="nav-link" href="using-osgi-blueprint-with-camel.html">Using OSGi blueprint with Camel</a></li></ul></li></ul></nav></div><div class="navigation-explore" data-panel="explore"><div class="context"><span class="title">User manual</span><span class="version">latest</span></div><ul class="components"><li class="component"><span class="title">Apache Camel K</span><ul class="versions"><li class="version is-latest"><a href="../../camel-k/latest/index.html">latest</a></li></ul></li><li class="component"><span class="title">Component reference</span><ul class="versions"><li class="version is-latest"><a href="../../components/latest/index.html">latest</a></li></ul></li><li class="component is-current"><span class="title">User manual</span><ul class="versions"><li class="version is-current is-latest"><a href="index.html">latest</a></li></ul></li></ul></div></div></aside></div><main class="main"><div class="toolbar" role="navigation"><button class="navigation-toggle"></button><a href="index.html" class="home-link"></a><nav class="crumbs" aria-label="breadcrumbs"><ul><li class="crumb"><a href="index.html">User manual</a></li><li class="crumb"><a href="architecture.html">Architecture</a></li><li class="crumb"><a href="intercept.html">Intercept</a></li></ul></nav><div class="edit-this-page"><a href="https://github.com/apache/camel/edit/master/docs/user-manual/modules/ROOT/pages/intercept.adoc">Edit this Page</a></div></div><article class="doc"><div class="sect2"><h3 id="Intercept-Intercept"><a class="anchor" href="#Intercept-Intercept"></a>Intercept</h3><div class="paragraph"><p>The intercept feature in Camel supports intercepting Exchanges while they are<em>on route</em>.<br>We have overhauled the Intercept in Camel 2.0 so the following information is based on Camel 2.0.</p></div><div class="paragraph"><p>Camel supports three kinds of interceptors:</p></div><div class="ulist"><ul><li><p><code>intercept</code>that intercepts each and every processing step while routing an Exchange in the route.</p></li><li><p><code>interceptFrom</code>that intercepts incoming Exchange in the route.</p></li><li><p><code>interceptSendToEndpoint</code>that intercepts when an Exchange is about to be sent to the given Endpoint.</p></li></ul></div><div class="paragraph"><p>These interceptors supports the following features:</p></div><div class="ulist"><ul><li><p>Predicate using<code>when</code>to only trigger the interceptor in certain conditions</p></li><li><p><code>stop</code>forces to stop continue routing the Exchange and mark it as completed successful. Camel will by default<strong>not stop</strong>.</p></li><li><p><code>skip</code>when used with<code>interceptSendToEndpoint</code>will<strong>skip</strong>sending the Exchange to the original intended endpoint. Camel will by default<strong>not skip</strong>.</p></li><li><p><code>interceptFrom</code>and<code>interceptSendToEndpoint</code>supports endpoint URI matching by: exact uri, wildcard, regular expression. See advanced section.</p></li><li><p>The intercepted endpoint uri is stored as message header<code>Exchange.INTERCEPTED_ENDPOINT</code>.</p></li></ul></div><div class="paragraph"><p><code>stop</code>can be used in general, it does not have to be used with an Intercept you can use it in regular routing as well.</p></div><div class="paragraph"><p>You can also instruct Camel to<code>stop</code>continue routing your message if you set the<code>Exchange.ROUTE_STOP</code>property to<code>"true"</code>or<code>Boolean.TRUE</code>on the Exchange. You can for instance do this from regular Java code in a POJO or Processor.</p></div><div class="sect3"><h4 id="Intercept-Intercept.1"><a class="anchor" href="#Intercept-Intercept.1"></a>Intercept</h4><div class="paragraph"><p><code>Intercept</code>is like a regular interceptor that is applied on each processing step the Exchange undergo while its being routed. You can think of it as a<em>AOP before</em>that is applied at each DSL keyword you have defined in your route.</p></div><div class="paragraph"><p>The classic Hello World example would be:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">intercept().to("log:hello");

from("jms:queue:order").to("bean:validateOrder").to("bean:processOrder");</code></pre></div></div><div class="paragraph"><p>What happens is that the Exchange is intercepted before each processing step, that means that it will be intercepted before</p></div><div class="ulist"><ul><li><p><code>.to("bean:validateOrder")</code></p></li><li><p><code>.to("bean:processOrder")</code></p></li></ul></div><div class="paragraph"><p>So in this sample we intercept the Exchange twice.</p></div><div class="paragraph"><p>The<code>when</code>predicate is also support on the<code>intercept</code>so we can attach a Predicate to only trigger the interception under certain conditions.<br>For instance in the sample below we only intercept if the message body contains the string word<strong>Hello</strong>:</p></div><div class="paragraph"><p>And in the route below we want to stop in certain conditions, when the message contains the word 'Hello':</p></div><div class="sect4"><h5 id="Intercept-UsingfromSpringDSL"><a class="anchor" href="#Intercept-UsingfromSpringDSL"></a>Using from Spring DSL</h5><div class="paragraph"><p>The same hello world sample in Spring DSL would be:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;camelContext ...&gt;
    &lt;intercept&gt;
        &lt;to uri="log:hello"/&gt;
    &lt;/intercept&gt;

    &lt;route&gt;
        &lt;from uri="jms:queue:order"/&gt;
        &lt;to uri="bean:validateOrder"/&gt;
        &lt;to uri="bean:handleOrder"/&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;</code></pre></div></div><div class="paragraph"><p>And the sample for using the<strong>when</strong>predicate would be:</p></div><div class="paragraph"><p>And the sample for using the<strong>when</strong>and<strong>stop</strong>would be:</p></div></div></div><div class="sect3"><h4 id="Intercept-InterceptFrom"><a class="anchor" href="#Intercept-InterceptFrom"></a>InterceptFrom</h4><div class="paragraph"><p><code>InterceptFrom</code>is for intercepting any incoming Exchange, in any route (it intercepts all the<code>from</code>DSLs). This allows you to do some custom behavior for received Exchanges. You can provide a specific uri for a given Endpoint then it only applies for that particular route.</p></div><div class="paragraph"><p>So lets start with the logging example. We want to log all the<strong>incoming</strong>requests so we use<code>interceptFrom</code>to route to the<a href="#log-component">Log</a>component. As<code>proceed</code>is default then the Exchange will continue its route, and thus it will continue to<code>mock:first</code>.</p></div><div class="paragraph"><p>You can also attach a Predicate to only trigger if certain conditions is meet. For instance in the route below we intercept when a test message is send to us, so we can do some custom processing before we continue routing:</p></div><div class="paragraph"><p>And if we want to filter out certain messages we can use the<code>stop()</code>to instruct Camel to stop continue routing the Exchange:</p></div><div class="paragraph"><p>And if want to only apply a specific endpoint, as the<strong>seda:bar</strong>endpoint in the sample below, we can do it like this:</p></div><div class="sect4"><h5 id="Intercept-UsingfromSpringDSL.1"><a class="anchor" href="#Intercept-UsingfromSpringDSL.1"></a>Using from Spring DSL</h5><div class="paragraph"><p>Intercept is of course also available using Spring DSL as shown in the sample below:</p></div><div class="paragraph"><p><strong>Notice:</strong><code>stop</code>is also supported in<code>interceptFrom</code>so you can intercept from certain endpoints and route then elsewhere and<code>stop</code>to not continue routing in the original intended route path.</p></div></div></div><div class="sect3"><h4 id="Intercept-InterceptSendToEndpoint"><a class="anchor" href="#Intercept-InterceptSendToEndpoint"></a>InterceptSendToEndpoint</h4><div class="paragraph"><p><strong>Available as of Camel 2.0</strong></p></div><div class="paragraph"><p>Intercept send to endpoint is triggered when an Exchange is being sent to the intercepted endpoint. This allows you to route the Exchange to a Detour or do some custom processing before the Exchange is sent to the original intended destination. You can also skip sending to the intended destination. By default Camel will send to the original intended destination after the intercepted route completes. And as the regular intercept you can also define an<code>when</code>Predicate so we only intercept if the Predicate evaluates to<strong>true</strong>. This allows you do do a bit of filtering, to only intercept when certain criteria is meet.</p></div><div class="paragraph"><p>Let start with a simple example, where we want to intercept when an Exchange is being sent to<code>mock:foo</code>:</p></div><div class="paragraph"><p>And this time we add the Predicate so its only when the message body is<code>Hello World</code>we intercept.</p></div><div class="paragraph"><p>And to skip sending to the<code>mock:foo</code>endpoint we use the *<code>skip()</code>DSL in the route at the end to instruct Camel to skip sending to the original intended endpoint.</p></div><div class="paragraph"><p><strong>Conditional skipping</strong></p></div><div class="paragraph"><p>The combination of<code>skipSendToEndpoint</code>with a<code>when</code>predicate behaves differently depending on the Camel version:</p></div><div class="ulist"><ul><li><p><strong>Before Camel 2.10:</strong>the skipping is applied unconditionally whether the<code>when</code>predicate is matched or not, i.e. the<code>when</code>predicate only determines whether the body of the interception will execute, but it does not control skipping behaviour</p></li><li><p><strong>As of Camel 2.10:</strong>the skipping only occurs if the<code>when</code>predicate is matched, leading to more natural logic altogether.</p></li></ul></div><div class="sect4"><h5 id="Intercept-UsingfromSpringDSL.2"><a class="anchor" href="#Intercept-UsingfromSpringDSL.2"></a>Using from Spring DSL</h5><div class="paragraph"><p>Intercept endpoint is of course also available using Spring DSL.</p></div><div class="paragraph"><p>We start with the first example from above in Spring DSL:</p></div><div class="paragraph"><p>And the 2nd. Notice how we can leverage the<a href="#simple-language">Simple</a>language for the Predicate:</p></div><div class="paragraph"><p>And the 3rd with the<code>skip</code>, notice skip is set with the<code>skipSendToOriginalEndpoint</code>attribute on the<strong>interceptSendToEndpoint</strong>tag:</p></div></div></div><div class="sect3"><h4 id="Intercept-AdvancedusageofIntercpt"><a class="anchor" href="#Intercept-AdvancedusageofIntercpt"></a>Advanced usage of Intercpt</h4><div class="paragraph"><p>The<code>interceptFrom</code>and<code>interceptSendToEndpoint</code>supports endpoint URI matching by the following rules in the given order:</p></div><div class="ulist"><ul><li><p>match by exact URI name. This is the sample we have seen above.</p></li><li><p>match by wildcard</p></li><li><p>match by regular expression.</p></li></ul></div><div class="paragraph"><p>The real endpoint that was intercepted is stored as uri in the message IN header with the key<code>Exchange.INTERCEPTED_ENDPOINT</code>.<br>This allows you to get hold of this information, when you for instance match by wildcard. Then you know the real endpoint that was intercepted and can react accordingly.</p></div><div class="sect4"><h5 id="Intercept-Matchbywildcard"><a class="anchor" href="#Intercept-Matchbywildcard"></a>Match by wildcard</h5><div class="paragraph"><p>Match by wildcard allows you to match a range of endpoint or all of a given type. For instance use<code>uri="file:*"</code>will match all File based endpoints.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">intercept("jms:*").to("log:fromjms");</code></pre></div></div><div class="paragraph"><p>Wildcards is match that the text before the * is matched against the given endpoint and if it also starts with the same characters its a match. For instance you can do:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">intercept("file://order/inbox/*").to("log:newfileorders");</code></pre></div></div><div class="paragraph"><p>To intercept any files received from the<code>order/inbox</code>folder.</p></div></div><div class="sect4"><h5 id="Intercept-Matchbyregularexpression"><a class="anchor" href="#Intercept-Matchbyregularexpression"></a>Match by regular expression</h5><div class="paragraph"><p>Match by regular expression is just like match by wildcard but using regex instead. So if we want to intercept incoming messages from gold and silver JMS queues we can do:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">intercept("jms:queue:(gold|silver)").to("seda:handleFast");</code></pre></div></div><div class="paragraph"><p><strong>About dynamic and static behavior of interceptFrom and interceptSendToEndpoint</strong></p></div><div class="paragraph"><p>The<code>interceptSendToEndpoint</code>is dynamic hence it will also trigger if a dynamic URI is constructed that Camel was not aware of at startup time.<br>The<code>interceptFrom</code>is not dynamic as it only intercepts input to routes registered as routes in<code>CamelContext</code>. So if you dynamic construct a<code>Consumer</code>using the Camel API and consumes an Endpoint then the<code>interceptFrom</code>is not triggered.</p></div></div></div><div class="sect3"><h4 id="Intercept-SeeAlso"><a class="anchor" href="#Intercept-SeeAlso"></a>See Also</h4><div class="ulist"><ul><li><p><a href="architecture.adoc">Architecture</a></p></li></ul></div></div></div></article></main></div><footer class="footer"><p>This page was built using the Antora default UI.</p><p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p></footer><script src="../../_/js/site.js"></script><script src="../../_/js/vendor/highlight.js"></script><script>hljs.initHighlighting()</script></body></html>