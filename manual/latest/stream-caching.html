<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Untitled :: Apache Camel</title><link rel="canonical" href="https://camel.apache.org/staging/manual/latest/stream-caching.html"><meta name="generator" content="Antora 2.0.0"><link rel="stylesheet" href="../../_/css/site.css"><link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../apple-touch-icon-57x57.png"><link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../apple-touch-icon-114x114.png"><link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../apple-touch-icon-72x72.png"><link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../apple-touch-icon-144x144.png"><link rel="apple-touch-icon-precomposed" sizes="60x60" href="../../apple-touch-icon-60x60.png"><link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../apple-touch-icon-120x120.png"><link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../apple-touch-icon-76x76.png"><link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../apple-touch-icon-152x152.png"><link rel="icon" type="image/png" href="../../favicon-196x196.png" sizes="196x196"><link rel="icon" type="image/png" href="../../favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/png" href="../../favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="../../favicon-16x16.png" sizes="16x16"><link rel="icon" type="image/png" href="../../favicon-128.png" sizes="128x128"><meta name="application-name" content="Apache Camel"><link rel="manifest" href="../../site.webmanifest"></head><body class="article"><header class="header"><nav class="navbar shadow border-bottom"><div class="navbar-brand"><a class="navbar-item nav-logo" href="../.." title="Apache Camel"></a><button class="navbar-burger" data-target="topbar-nav"><span></span><span></span><span></span></button></div><div id="topbar-nav" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="../../">Home</a><a class="navbar-item" href="../../news/">News</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Projects</a><div class="navbar-dropdown"><a class="navbar-item" href="../../projects/camel-k/">Camel K</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Documentation</a><div class="navbar-dropdown"><a class="navbar-item" href="../../docs/getting-started/">Getting started</a><a class="navbar-item" href="../../manual/latest/">User manual</a><a class="navbar-item" href="../../components/latest/">Component reference</a><a class="navbar-item" href="../../camel-k/latest/">Camel K</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Community</a><div class="navbar-dropdown"><a class="navbar-item" href="../../community/support/">Support</a><a class="navbar-item" href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a><a class="navbar-item" href="../../community/user-stories/">User stories</a><a class="navbar-item" href="../../community/articles/">Articles</a><a class="navbar-item" href="../../community/books/">Books</a><a class="navbar-item" href="../../community/team/">Team</a><a class="navbar-item" href="../../community/camel-extra/">Camel extra</a></div></div><a class="navbar-item" href="../../download/">Download</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">About</a><div class="navbar-dropdown"><a class="navbar-item" href="https://www.apache.org/events/current-event.html">Apache events</a><a class="navbar-item" href="https://www.apache.org/licenses/">License</a><a class="navbar-item" href="../../security/">Security</a><a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a><a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a></div></div></div></div></nav></header><div class="main-wrapper"><div class="navigation-container" data-component="manual" data-version="latest"><aside class="navigation"><div class="panels"><div class="navigation-menu is-active" data-panel="menu"><nav class="nav-menu"><h3 class="title"><a href="index.html">User manual</a></h3><ul class="nav-list"><li class="nav-item" data-depth="0"><ul class="nav-list"><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="getting-started.html">Getting started</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="book-getting-started.html">Getting Started with Apache Camel</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="architecture.html">Architecture</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="async.html">Async</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="backlogdebugger.html">Backlog debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bam.html">Business Activity Monitoring</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="batch-consumer.html">Batch Consumer</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="browsable-endpoint.html">BrowsableEndpoint</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camel-core.html">Core</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camelcontext.html">Context</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="endpoint.html">Endpoints</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="cep.html">Complex Event Processing</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="component.html">Component</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="debugger.html">Debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="delay-interceptor.html">Delay interceptor</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dependency-injection.html">Dependency Injection</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dozer-type-conversion.html">Dozer Type Conversion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bean-integration.html">Bean Integration</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="error-handler.html">Error Handler</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange.html">Message Exchange</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange-pattern.html">Exchange Pattern</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="expression.html">Expressions</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="injector.html">Injector</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="intercept.html">Intercept</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="inversion-of-control-with-smart-defaults.html">Inversion Of Control With Smart Defaults</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="jmx.html">JMX</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="lifecycle.html">Camel Lifecycle</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="oncompletion.html">OnCompletion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="predicate.html">Predicates</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="registry.html">Registry</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="route-builder.html">RouteBuilder</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="routes.html">Routes</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="transformer.html">Transformer</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="validator.html">Validator</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><span class="nav-text">Domain Specific Languages</span><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="dsl.html">Camel Domain Specific Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="java-dsl.html">Java DSL</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="spring.html">Spring support</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="groovy-dsl.html">Groovy DSL</a></li></ul></li><li class="nav-item" data-depth="1"><a class="nav-link" href="using-osgi-blueprint-with-camel.html">Using OSGi blueprint with Camel</a></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><span class="nav-text">Supported expression languages</span><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="constant-language.html">Constant Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchangeProperty-language.html">ExchangeProperty Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="file-language.html">File Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="header-language.html">Header Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="ref-language.html">Ref Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="simple-language.html">Simple Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="tokenize-language.html">Tokenize Language</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="aggregate-eip.html">Aggregate EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="batch-config-eip.html">Batch-config EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bean-eip.html">Bean EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="choice-eip.html">Choice EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="circuitBreaker-eip.html">Circuit Breaker EIP (deprecated)</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="claimCheck-eip.html">Claim Check EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="content-based-router-eip.html">Content Based Router</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="content-filter-eip.html">Content Filter</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="convertBodyTo-eip.html">Convert Body To EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="customLoadBalancer-eip.html">Custom Load Balancer EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="delay-eip.html">Delay EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dynamic-router.html">Dynamic Router</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dynamicRouter-eip.html">Dynamic Router EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="enrich-eip.html">Enrich EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="eventDrivenConsumer-eip.html">Event Driven Consumer</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="failover-eip.html">Failover EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="filter-eip.html">Filter EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="from-eip.html">From EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="hystrix-eip.html">Hystrix EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="hystrixConfiguration-eip.html">Hystrix Configuration EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="idempotentConsumer-eip.html">Idempotent Consumer EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="inOnly-eip.html">In Only EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="inOut-eip.html">In Out EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="loadBalance-eip.html">Load Balance EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="log-eip.html">Log EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="loop-eip.html">Loop EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="marshal-eip.html">Marshal EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="multicast-eip.html">Multicast EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="onFallback-eip.html">On Fallback EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="otherwise-eip.html">Otherwise EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="pipeline-eip.html">Pipeline EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="pollEnrich-eip.html">Poll Enrich EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="process-eip.html">Process EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="random-eip.html">Random EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="recipientList-eip.html">Recipient List EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="removeHeader-eip.html">Remove Header EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="removeHeaders-eip.html">Remove Headers EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="removeProperties-eip.html">Remove Properties EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="removeProperty-eip.html">Remove Property EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="requestReply-eip.html">Request Reply</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="resequence-eip.html">Resequence EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="rollback-eip.html">Rollback EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="roundRobin-eip.html">Round Robin EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="routingSlip-eip.html">Routing Slip EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="saga-eip.html">Saga EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="sample-eip.html">Sample EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="script-eip.html">Script EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="serviceCall-eip.html">Service Call EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="setBody-eip.html">Set Body EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="setFaultBody-eip.html">Set Fault Body EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="setHeader-eip.html">Set Header EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="setOutHeader-eip.html">Set Out Header EIP (deprecated)</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="setProperty-eip.html">Set Property EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="sort-eip.html">Sort EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="split-eip.html">Split EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="step-eip.html">Step EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="sticky-eip.html">Sticky EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="stop-eip.html">Stop EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="stream-config-eip.html">Stream-config EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="threads-eip.html">Threads EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="throttle-eip.html">Throttle EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="to-eip.html">To EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="toD-eip.html">To D EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="topic-eip.html">Topic EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="transform-eip.html">Transform EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="unmarshal-eip.html">Unmarshal EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="validate-eip.html">Validate EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="weighted-eip.html">Weighted EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="when-eip.html">When EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="wireTap-eip.html">Wire Tap EIP</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><span class="nav-text">Frequently asked questions</span><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/can-i-get-commercial-support.html">Can I get commercial support?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/can-i-use-camel-on-java-14.html">Can I use Camel on Java 1.4?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/does-camel-work-on-ibms-jdk.html">Does Camel work on IBM&#8217;s JDK?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="support.html">How can I get help?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-can-i-get-the-source-code.html">How can I get the source code?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-does-camel-compare-to-mule.html">How does Camel compare to Mule?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-does-camel-compare-to-servicemix.html">How does Camel compare to ServiceMix?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-does-camel-compare-to-servicemix-eip.html">How does Camel compare to ServiceMix EIP?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-does-camel-compare-to-synapse.html">How does Camel compare to Synapse?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-does-camel-work.html">How does Camel work?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-does-camel-work-with-activemq.html">How does Camel work with ActiveMQ?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-does-camel-work-with-servicemix.html">How does Camel work with ServiceMix?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-does-the-camel-api-compare-to.html">How does the Camel API compare to?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-does-the-website-work.html">How does the website work?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-become-a-committer.html">How do I become a committer?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-compile-the-code.html">How do I compile the code?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-edit-the-website.html">How do I edit the website?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-run-camel-using-java-webstart.html">How do I run Camel using Java WebStart?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/if-i-use-servicemix-when-should-i-use-camel.html">If I use ServiceMix when should I use Camel?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/is-camel-an-esb.html">Is Camel an ESB?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/is-camel-ioc-friendly.html">Is Camel IoC friendly?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/running-camel-standalone.html">Running Camel standalone</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/what-are-the-dependencies.html">What are the dependencies?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/what-is-a-router.html">What is a router?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/what-is-camel.html">What is Camel?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/what-is-the-license.html">What is the license?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/what-jars-do-i-need.html">What jars do I need?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="languages.html">What languages are supported?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/what-platforms-are-supported.html">What platforms are supported?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-the-name-camel.html">Why the name Camel?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/classloader-issue-of-servicemix-camel-component.html">Classloader issue of servicemix-camel component</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-specify-which-method-to-use-when-using-beans-in-routes.html">How do I specify which method to use when using beans in routes?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-can-i-create-a-custom-component-or-endpoint.html">How can I create a custom component or endpoint?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-can-i-get-the-remote-connection-ip-address-from-the-camel-cxf-consumer-.html">How can I get the remote connection IP address from the camel-cxf consumer ?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-can-i-stop-a-route-from-a-route.html">How can I stop a route from a route?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-can-webservice-clients-see-remote-faults-with-stacktraces-when-using-camel-cxf.html">How can webservice clients see remote faults with stacktraces when using camel-cxf?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-does-camel-look-up-beans-and-endpoints.html">How does Camel look up beans and endpoints?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="configuring-camel.html">How do I add a component?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-change-the-logging.html">How do I change the logging?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-configure-endpoints.html">How do I configure endpoints?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-configure-password-options-on-camel-endpoints-without-the-value-being-encoded.html">How do I configure password options on Camel endpoints without the value being encoded?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-configure-the-default-maximum-cache-size-for-producercache-or-producertemplate.html">How do I configure the default maximum cache size for ProducerCache or ProducerTemplate?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-configure-the-maximum-endpoint-cache-size-for-camelcontext.html">How do I configure the maximum endpoint cache size for CamelContext?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-debug-my-route.html">How do I debug my route?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-disable-jmx.html">How do I disable JMX?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-enable-streams-when-debug-logging-messages-in-camel.html">How do I enable streams when debug logging messages in Camel?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-handle-failures-when-consuming-for-example-from-a-ftp-server.html">How do I handle failures when consuming for example from a FTP server?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-import-rests-from-other-xml-files.html">How do I import rests from other XML files?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-import-routes-from-other-xml-files.html">How do I import routes from other XML files?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-let-jetty-match-wildcards.html">How do I let Jetty match wildcards?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-name-my-routes.html">How do I name my routes?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-restart-camelcontext.html">How do I restart CamelContext?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-retrieve-the-thrown-exception-during-processing-an-exchange.html">How do I retrieve the thrown Exception during processing an Exchange?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-retry-failed-messages-forever.html">How do I retry failed messages forever?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-retry-processing-a-message-from-a-certain-point-back-or-an-entire-route.html">How do I retry processing a message from a certain point back or an entire route?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-reuse-the-contexttestsupport-class-in-my-unit-tests.html">How do I reuse the ContextTestSupport class in my unit tests?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-run-activemq-and-camel-in-jboss.html">How do I run ActiveMQ and Camel in JBoss?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-set-the-max-chars-when-debug-logging-messages-in-camel.html">How do I set the max chars when debug logging messages in Camel?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-specify-time-period-in-a-human-friendly-syntax.html">How do I specify time period in a human friendly syntax?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-use-a-big-uber-jar.html">How do I use a big (uber) JAR?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-use-camel-inside-servicemix.html">How do I use Camel inside ServiceMix?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-use-spring-property-placeholder-with-camel-xml.html">How do I use Spring Property Placeholder with Camel XML?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-use-uris-with-parameters-in-xml.html">How do I use URIs with parameters in XML?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-write-a-custom-processor-which-sends-multiple-messages.html">How do I write a custom Processor which sends multiple messages?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-should-i-invoke-my-pojos-or-spring-services.html">How should I invoke my POJOs or Spring Services?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-should-i-package-applications-using-camel-and-activemq.html">How should I package applications using Camel and ActiveMQ?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-to-avoid-importing-bunch-of-cxf-packages-when-start-up-the-camel-cxf-endpoint-from-osgi-platform-.html">How to avoid importing bunch of cxf packages when start up the camel-cxf endpoint from OSGi platform?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-to-avoid-sending-some-or-all-message-headers.html">How to avoid sending some or all message headers?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-to-define-a-static-camel-converter-method-in-scala.html">How to define a static Camel converter method in Scala?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-to-remove-the-http-protocol-headers-in-the-camel-message.html">How to remove the http protocol headers in the camel message?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-to-send-the-same-message-to-multiple-endpoints.html">How to send the same message to multiple endpoints?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-to-switch-the-cxf-consumer-between-http-and-https-without-touching-the-spring-configuration.html">How to switch the CXF consumer between HTTP and HTTPS without touching the Spring configuration?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-to-use-a-dynamic-uri-in-to.html">How to use a dynamic URI in to()?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="#">faq/how-to-use-extra-camel-componets-in-servicemix-camel.adoc</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-to-validate-the-camel-1x-context-xml-from-apache-camel-web-site.html">How to validate the camel 1.x context xml from Apache Camel web site?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/is-there-an-ide.html">Is there an IDE?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/should-i-deploy-camel-inside-the-activemq-broker-or-in-another-application.html">Should I deploy Camel inside the ActiveMQ broker or in another application?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/using-camel-core-testsjar.html">Using camel-core-tests.jar</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/using-getin-or-getout-methods-on-exchange.html">Using getIn or getOut methods on Exchange</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-cant-i-use-sign-in-my-password.html">Why can&#8217;t I use + sign in my password?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-can-i-not-use-when-or-otherwise-in-a-java-camel-route.html">Why can I not use when or otherwise in a Java Camel route?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-does-ftp-component-not-download-any-files.html">Why does FTP component not download any files?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-does-my-file-consumer-not-pick-up-the-file-and-how-do-i-let-the-file-consumer-use-the-camel-error-handler.html">Why does my file consumer not pick up the file, and how do I let the file consumer use the Camel error handler?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-does-useoriginalmessage-with-error-handler-not-work-as-expected.html">Why does useOriginalMessage with error handler not work as expected?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-do-my-message-lose-its-headers-during-routing.html">Why do my message lose its headers during routing?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-is-my-message-body-empty.html">Why is my message body empty?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-is-my-processor-not-showing-up-in-jconsole.html">Why is my processor not showing up in JConsole?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-is-the-exception-null-when-i-use-onexception.html">Why is the exception null when I use onException?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-use-multiple-camelcontext.html">Why use multiple CamelContext?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-enable-debug-logging.html">How do I enable debug logging?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-use-java-14-logging.html">How do I use Java 1.4 logging?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-use-log4j.html">How do I use log4j?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-invoke-camel-routes-from-jbi.html">How do I invoke Camel routes from JBI?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-make-my-jms-endpoint-transactional.html">How Do I Make My JMS Endpoint Transactional?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-i-set-the-mep-when-interacting-with-jbi.html">How do I set the MEP when interacting with JBI?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-the-direct-event-seda-and-vm-endpoints-compare.html">How do the direct, event, seda and vm endpoints compare?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/how-do-the-timer-and-quartz-endpoints-compare.html">How do the Timer and Quartz endpoints compare?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-does-my-jms-route-only-consume-one-message-at-once.html">Why does my JMS route only consume one message at once?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/exception-beandefinitionstoreexception.html">Exception - BeanDefinitionStoreException</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/exception-javaxnamingnoinitialcontextexception.html">Exception - javax.naming.NoInitialContextException</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/exception-orgapachecamelnosuchendpointexception.html">Exception - org.apache.camel.NoSuchEndpointException</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/exception-orgxmlsaxsaxparseexception.html">Exception - org.xml.sax.SAXParseException</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/memory-leak-when-adding-and-removing-routes-at-runtime.html">Memory leak when adding and removing routes at runtime</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-do-camel-throw-so-many-noclassdeffoundexception-on-startup.html">Why do Camel throw so many NoClassDefFoundException on startup?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-does-camel-use-too-many-threads-with-producertemplate.html">Why does Camel use too many threads with ProducerTemplate?</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="faq/why-does-maven-not-download-dependencies.html">Why does maven not download dependencies?</a></li></ul></li></ul></li></ul></nav></div><div class="navigation-explore" data-panel="explore"><div class="context"><span class="title">User manual</span><span class="version">latest</span></div><ul class="components"><li class="component"><span class="title">Apache Camel K</span><ul class="versions"><li class="version is-latest"><a href="../../camel-k/latest/index.html">latest</a></li></ul></li><li class="component"><span class="title">Component reference</span><ul class="versions"><li class="version is-latest"><a href="../../components/latest/index.html">latest</a></li></ul></li><li class="component is-current"><span class="title">User manual</span><ul class="versions"><li class="version is-current is-latest"><a href="index.html">latest</a></li></ul></li></ul></div></div></aside></div><main class="main"><div class="toolbar" role="navigation"><button class="navigation-toggle"></button><a href="index.html" class="home-link"></a><nav class="crumbs" aria-label="breadcrumbs"></nav><div class="edit-this-page"><a href="https://github.com/apache/camel/edit/master/docs/user-manual/modules/ROOT/pages/stream-caching.adoc">Edit this Page</a></div></div><article class="doc"><div class="sect2"><h3 id="Streamcaching-Streamcaching"><a class="anchor" href="#Streamcaching-Streamcaching"></a>Stream caching</h3><div class="paragraph"><p>While stream types (like<code>StreamSource</code>,<code>InputStream</code>and<code>Reader</code>) are commonly used in messaging for performance reasons, they also have an important drawback: they can only be read once. In order to be able to work with message content multiple times, the stream needs to be cached.</p></div><div class="paragraph"><p>Streams are caching in memory. In Camel 2.0, large stream messages (over 64 KB in Camel 2.11 or older, and 128 KB from Camel 2.12 onwards) will be cached in a temporary file instead&#8201;&#8212;&#8201;Camel itself will handle deleting the temporary file once the cached stream is no longer necessary.</p></div><div class="ulist"><ul><li><p>In Camel 2.0 stream cache is default<strong>disabled</strong>out of the box.</p></li><li><p>In Camel 1.x stream cache is default<strong>enabled</strong>out of the box.</p></li></ul></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content"><div class="paragraph"><p><strong>StreamCache Affects your payload object</strong></p></div><div class="paragraph"><p>The<code>StreamCache</code>will affect your payload object as it will replace the<code>Stream</code>payload with a<code>org.apache.camel.StreamCache</code>object. This<code>StreamCache</code>is capable of being re-readable and thus possible to better be routed within Camel using redelivery or<a href="#">contentBasedRouter-eip.adoc</a>or the likes.</p></div><div class="paragraph"><p>However to not change the payload under the covers without the end user really knowing we changed the default in Camel 2.0 to<strong>disabled</strong>. So in Camel 2.0 you have to explicit enable it if you want to use it.</p></div></td></tr></table></div><div class="admonitionblock tip"><table><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content">If using Camel 2.12 onwards then see<a href="#">Streamcaching-UsingStreamCachingStrategy.adoc</a>further below which is the recommended way to configure stream caching options.</td></tr></table></div><div class="sect3"><h4 id="Streamcaching-Enablingstreamcaching"><a class="anchor" href="#Streamcaching-Enablingstreamcaching"></a>Enabling stream caching</h4><div class="paragraph"><p>In Apache Camel, you can explicitly enable stream caching for a single route with the<code>streamCaching</code>DSL method:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("jbi:service:http://foo.bar.org/MyService")
    .streamCaching()
    .to("jbi:service:http://foo.bar.org/MyOtherService");</code></pre></div></div><div class="paragraph"><p>In Spring XML you enable it by setting the<code>streamCache="true"</code>attribute on the route tag:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;route streamCache="true"&gt;
    &lt;from uri="jbi:service:http://foo.bar.org/MyService"/&gt;
    &lt;to uri="jbi:service:http://foo.bar.org/MyOtherService"/&gt;
&lt;/route&gt;</code></pre></div></div><div class="sect4"><h5 id="Streamcaching-Scopes"><a class="anchor" href="#Streamcaching-Scopes"></a>Scopes</h5><div class="paragraph"><p><code>StreamCache</code>supports the global and per route scope. So by setting the<code>streamCache</code>attribute on<code>camelContext</code>you can enable/disable it globally:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;camelContext streamCache="true"&gt;
    ...
&lt;/camelContext&gt;</code></pre></div></div><div class="paragraph"><p>The route scope is configured by the<code>streamCache</code>attribute on the<code>&lt;route&gt;</code>tag such as:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;route streamCache="true"&gt;
    &lt;from uri="jbi:service:http://foo.bar.org/MyService"/&gt;
    &lt;to uri="jbi:service:http://foo.bar.org/MyOtherService"/&gt;
&lt;/route&gt;</code></pre></div></div><div class="paragraph"><p>You can mix and match for instance you can enable it globally and disable it on a particular route such as:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;camelContext streamCache="true"&gt;
  &lt;route&gt;
    &lt;from uri="jbi:service:http://foo.bar.org/MyService"/&gt;
    &lt;to uri="jbi:service:http://foo.bar.org/MyOtherService"/&gt;
  &lt;/route&gt;

  &lt;route streamCache="false"&gt;
    &lt;from uri="jms:queue:foo"/&gt;
    &lt;to uri="jms:queue:bar"/&gt;
  &lt;/route&gt;
&lt;/camelContext&gt;</code></pre></div></div></div><div class="sect4"><h5 id="Streamcaching-EnablingfromJavaDSL"><a class="anchor" href="#Streamcaching-EnablingfromJavaDSL"></a>Enabling from Java DSL</h5><div class="paragraph"><p>You can enable stream cache by setting the property on<code>CamelContext</code>, for instance in a<code>RouteBuilder</code>class:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">context.setStreamCache(true);

from("jbi:service:http://foo.bar.org/MyService")
    .to("jbi:service:http://foo.bar.org/MyOtherService");</code></pre></div></div></div><div class="sect4"><h5 id="Streamcaching-Disablestreamcachingexplicitly"><a class="anchor" href="#Streamcaching-Disablestreamcachingexplicitly"></a>Disable stream caching explicitly</h5><div class="paragraph"><p>If you have enabled stream caching globally on the<code>CamelContext</code>and you want to disable it for certain routes in a selective manner, you can use the following syntax.</p></div><div class="paragraph"><p>Spring DSL:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;camelContext streamCache="true"&gt;
  &lt;route streamCache="false"&gt;
    &lt;from uri="jetty:http://0.0.0.0:9090"/&gt;
    &lt;to uri="file:target/incoming"/&gt;
  &lt;/route&gt;
&lt;/camelContext&gt;</code></pre></div></div><div class="paragraph"><p>Java DSL:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">context.setStreamCache(true);

from("jetty:http://0.0.0.0:9090").noStreamCaching()
    .to("file:target/incoming");</code></pre></div></div></div></div><div class="sect3"><h4 id="Streamcaching-Streamingcachetofiles"><a class="anchor" href="#Streamcaching-Streamingcachetofiles"></a>Streaming cache to files</h4><div class="paragraph"><p>When stream cache is enabled it will by default spool big streams to files instead of keeping them in memory. The default threshold is 64 KB but you can configure it with the following properties:</p></div><table class="tableblock frame-all grid-all stretch"><colgroup><col style="width: 20%;"><col style="width: 20%;"><col style="width: 60%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Property</th><th class="tableblock halign-left valign-top">Default</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">CamelCachedOutputStreamBufferSize</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">2 KB</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Camel 2.9.4, 2.10.2, 2.11.0:</strong>Size in bytes of the buffer used in the stream.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">CamelCachedOutputStreamThreshold</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">64 KB or 128 KB</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">64 KB for<strong>Camel 2.11</strong>or older. 128 KB for<strong>Camel 2.12</strong>onwards. Size in bytes when the stream should be spooled to disk instead of keeping in memory. Use a value of 0 or negative to disable it all together so streams is always kept in memory regardless of their size.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">CamelCachedOutputStreamOutputDirectory</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">java.io.tmpdir</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Base directory where temporary files for spooled streams should be stored.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">CamelCachedOutputStreamCipherTransformation</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Camel 2.11.0:</strong>If set, the temporary files are encrypted using the specified cipher transformation (i.e., a valid stream or 8-bit cipher name such as "RC4", "AES/CTR/NoPadding". An empty name "" is treated as null).</p></td></tr></tbody></table><div class="paragraph"><p>You set these properties on the<code>CamelContext</code>as shown below, where we use a 1 MB threshold to spool to disk for messages bigger than 1 MB:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">context.getProperties().put(CachedOutputStream.TEMP_DIR, "/tmp/cachedir");
context.getProperties().put(CachedOutputStream.THRESHOLD, "1048576");
context.getProperties().put(CachedOutputStream.BUFFER_SIZE, "131072");
// to enable encryption using RC4
// context.getProperties().put(CachedOutputStream.CIPHER_TRANSFORMATION, "RC4");</code></pre></div></div><div class="paragraph"><p>And in XML you do:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;camelContext xmlns="http://camel.apache.org/schema/blueprint"&gt;

  &lt;!-- disable stream caching spool to disk --&gt;
  &lt;properties&gt;
    &lt;property key="CamelCachedOutputStreamOutputDirectory" value="/tmp/cachedir"/&gt;
    &lt;property key="CamelCachedOutputStreamThreshold" value="1048576"/&gt;
    &lt;property key="CamelCachedOutputStreamBufferSize" value="131072"/&gt;
  &lt;/properties&gt;</code></pre></div></div><div class="sect4"><h5 id="Streamcaching-Disablingspoolingtodisk"><a class="anchor" href="#Streamcaching-Disablingspoolingtodisk"></a>Disabling spooling to disk</h5><div class="paragraph"><p>You can disable spooling to disk by setting a threshold of 0 or a negative value.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// disable spooling to disk
context.getProperties().put(CachedOutputStream.THRESHOLD, "-1");</code></pre></div></div><div class="paragraph"><p>And in XML you do:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;camelContext xmlns="http://camel.apache.org/schema/blueprint"&gt;

  &lt;!-- disable stream caching spool to disk --&gt;
  &lt;properties&gt;
    &lt;property key="CamelCachedOutputStreamThreshold" value="-1"/&gt;
  &lt;/properties&gt;</code></pre></div></div></div></div><div class="sect3"><h4 id="Streamcaching-UsingStreamCachingStrategy"><a class="anchor" href="#Streamcaching-UsingStreamCachingStrategy"></a>Using StreamCachingStrategy</h4><div class="paragraph"><p><strong>Available as of Camel 2.12</strong></p></div><div class="paragraph"><p>Stream caching is from Camel 2.12 onwards intended to be configured using<code>org.apache.camel.spi.StreamCachingStrategy</code>. The old kind of configuration using properties on the<a href="camelcontext.html" class="page">CamelContext</a>has been marked as deprecated.</p></div><div class="paragraph"><p>The strategy has the following options:</p></div><table class="tableblock frame-all grid-all stretch"><colgroup><col style="width: 20%;"><col style="width: 20%;"><col style="width: 60%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Option</th><th class="tableblock halign-left valign-top">Default</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">spoolDirectory</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">${java.io.tmpdir}/camel/camel-tmp-#uuid#</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Base directory where temporary files for spooled streams should be stored. This option supports naming patterns as documented below.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">spoolCipher</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">If set, the temporary files are encrypted using the specified cipher transformation (i.e., a valid stream or 8-bit cipher name such as "RC4", "AES/CTR/NoPadding". An empty name "" is treated as null).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">spoolThreshold</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">128 KB</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Size in bytes when the stream should be spooled to disk instead of keeping in memory. Use a value of 0 or negative to disable it all together so streams is always kept in memory regardless of their size.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">spoolUsedHeapMemoryThreshold</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">A percentage (1 to 99) of current used heap memory to use as threshold for spooling streams to disk. The upper bounds is based on heap committed (guaranteed memory the JVM can claim). This can be used to spool to disk when running low on memory.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">spoolUsedHeapMemoryLimit</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Max</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">If<code>spoolUsedHeapMemoryThreshold</code>is in use, then whether the used heap memory upper limit is either Max or Committed.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">anySpoolRules</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Whether any or all<code>SpoolRule</code>s must return<code>true</code>to determine if the stream should be spooled or not. This can be used as applying AND/OR binary logic to all the rules. By default it&#8217;s AND based.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">bufferSize</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">4096</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Initial size if in-memory created stream buffers.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">removeSpoolDirectoryWhenStopping</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Whether to remove the spool directory when stopping<a href="camelcontext.html" class="page">CamelContext</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">statisticsEnabled</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Whether utilization statistics is enabled. By enabling this you can see these statics for example with JMX.</p></td></tr></tbody></table><div class="sect4"><h5 id="Streamcaching-SpoolDirectorynamingpattern"><a class="anchor" href="#Streamcaching-SpoolDirectorynamingpattern"></a>SpoolDirectory naming pattern</h5><div class="paragraph"><p>The following patterns is supported:</p></div><div class="ulist"><ul><li><p><code>#uuid#</code>= a random UUID</p></li><li><p><code>#camelId#</code>= the CamelContext id (e.g. the name)</p></li><li><p><code>#name#</code>= same as<code>#camelId#</code></p></li><li><p><code>#counter#</code>= an incrementing counter</p></li><li><p><code>#bundleId#</code>= the OSGi bundle id (only for OSGi environments)</p></li><li><p><code>#symbolicName#</code>= the OSGi symbolic name (only for OSGi environments)</p></li><li><p><code>#version#</code>= the OSGi bundle version (only for OSGi environments)</p></li><li><p><code>${env:key}</code>= the environment variable with the key</p></li><li><p><code>${key}</code>= the JVM system property with the key</p></li></ul></div><div class="paragraph"><p>A couple of examples:</p></div><div class="paragraph"><p>To store in the java temp directory with a sub directory using the<code>CamelContext</code>name:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">context.getStreamCachingStrategy().setSpoolDirectory"${java.io.tmpdir}#name#/");</code></pre></div></div><div class="paragraph"><p>To store in<code>KARAF_HOME/tmp/bundleId</code>directory:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">context.getStreamCachingStrategy().setSpoolDirectory"${env:KARAF_HOME}/tmp/bundle#bundleId#");</code></pre></div></div></div><div class="sect4"><h5 id="Streamcaching-UsingStreamCachingStrategyinJava"><a class="anchor" href="#Streamcaching-UsingStreamCachingStrategyinJava"></a>Using StreamCachingStrategy in Java</h5><div class="paragraph"><p>You can configure the StreamCachingStrategy in Java as shown below:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">context.getStreamCachingStrategy().setSpoolDirectory"/tmp/cachedir");
context.getStreamCachingStrategy().setSpoolThreshold(64 * 1024);
context.getStreamCachingStrategy().setBufferSize(16 * 1024);
// to enable encryption using RC4
// context.getStreamCachingStrategy().setSpoolCipher("RC4");</code></pre></div></div><div class="paragraph"><p>And remember to enable Stream caching on the CamelContext or on routes:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">context.setStreamCaching(true);</code></pre></div></div></div><div class="sect4"><h5 id="Streamcaching-UsingStreamCachingStrategyinXML"><a class="anchor" href="#Streamcaching-UsingStreamCachingStrategyinXML"></a>Using StreamCachingStrategy in XML</h5><div class="paragraph"><p>In XML you do:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;camelContext streamCache="true" xmlns="http://camel.apache.org/schema/blueprint"&gt;

  &lt;streamCaching id="myCacheConfig" bufferSize="16384" spoolDirectory="/tmp/cachedir" spoolThreshold="65536"/&gt;

  &lt;route&gt;
    &lt;from uri="direct:c"/&gt;
    &lt;to uri="mock:c"/&gt;
  &lt;/route&gt;

&lt;/camelContext&gt;</code></pre></div></div><div class="paragraph"><p>You can also define a<code>&lt;bean&gt;</code>instead of using the<code>&lt;streamCaching&gt;</code>tag:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- define a bean of type StreamCachingStrategy which CamelContext will automatic use --&gt;
&lt;bean id="streamStrategy" class="org.apache.camel.impl.DefaultStreamCachingStrategy"&gt;
  &lt;property name="spoolDirectory" value="/tmp/cachedir"/&gt;
  &lt;property name="spoolThreshold" value="65536"/&gt;
  &lt;property name="bufferSize" value="16384"/&gt;
&lt;/bean&gt;

&lt;!-- remember to enable stream caching --&gt;
&lt;camelContext streamCaching="true" xmlns="http://camel.apache.org/schema/spring"&gt;</code></pre></div></div></div><div class="sect4"><h5 id="Streamcaching-UsingspoolUsedHeapMemoryThreshold"><a class="anchor" href="#Streamcaching-UsingspoolUsedHeapMemoryThreshold"></a>Using spoolUsedHeapMemoryThreshold</h5><div class="paragraph"><p>By default stream caching will spool only big payloads (128 KB or bigger) to disk. However you can also set the<code>spoolUsedHeapMemoryThreshold</code>option which is a percentage of used heap memory. This can be used to also spool to disk when running low on memory.</p></div><div class="paragraph"><p>For example with:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;streamCaching id="myCacheConfig" spoolDirectory="/tmp/cachedir" spoolUsedHeapMemoryThreshold="70"/&gt;</code></pre></div></div><div class="paragraph"><p>Then notice that as<code>spoolThreshold</code>is default enabled with 128 KB, then we have both thresholds in use (<code>spoolThreshold</code>and<code>spoolUsedHeapMemoryThreshold</code>). And in this example then we only spool to disk if payload is &gt; 128 KB and that used heap memory is &gt; 70%. The reason is that we have the option<code>anySpoolRules</code>as default<code>false</code>. That means both rules must be<code>true</code>(e.g. AND).</p></div><div class="paragraph"><p>If we want to spool to disk if either of the rules (e.g. OR), then we can do:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;streamCaching id="myCacheConfig" spoolDirectory="/tmp/cachedir" spoolUsedHeapMemoryThreshold="70" anySpoolRules="true"/&gt;</code></pre></div></div><div class="paragraph"><p>If we only want to spool to disk if we run low on memory then we can set:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;streamCaching id="myCacheConfig" spoolDirectory="/tmp/cachedir" spoolThreshold="-1" spoolUsedHeapMemoryThreshold="70"/&gt;</code></pre></div></div><div class="paragraph"><p>then we do not use the<code>spoolThreshold</code>rule, and only the heap memory based is in use.</p></div><div class="paragraph"><p>By default the upper limit of the used heap memory is based on the maximum heap size. Though you can also configure to use the committed heap size as the upper limit, this is done using the<code>spoolUsedHeapMemoryThreshold</code>option as shown below:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;streamCaching id="myCacheConfig" spoolDirectory="/tmp/cachedir" spoolUsedHeapMemoryThreshold="70" spoolUsedHeapMemoryLimit="Committed"/&gt;</code></pre></div></div></div><div class="sect4"><h5 id="Streamcaching-UsingcustomSpoolRuleimplementations"><a class="anchor" href="#Streamcaching-UsingcustomSpoolRuleimplementations"></a>Using custom SpoolRule implementations</h5><div class="paragraph"><p>You can implement your custom rules to determine if the stream should be spooled to disk. This can be done by implementing the interface<code>org.apache.camel.spi.StreamCachingStrategy.SpoolRule</code>which has a single method:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">boolean shouldSpoolCache(long length);</code></pre></div></div><div class="paragraph"><p>The<code>length</code>is the length of the stream. To use the rule then add it to the<code>StreamCachingStrategy</code>as shown below:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">SpoolRule mySpoolRule = ...
context.getStreamCachingStrategy().addSpoolRule(mySpoolRule);</code></pre></div></div><div class="paragraph"><p>And from XML you need to define a<code>&lt;bean&gt;</code>with your custom rule:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mySpoolRule" class="com.foo.MySpoolRule"/&gt;

&lt;streamCaching id="myCacheConfig" spoolDirectory="/tmp/cachedir" spoolRules="mySpoolRule"/&gt;</code></pre></div></div><div class="paragraph"><p>Using the spoolRules attribute on<code>&lt;streamCaching&gt;</code>. if you have more rules, then separate them by comma.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;streamCaching id="myCacheConfig" spoolDirectory="/tmp/cachedir" spoolRules="mySpoolRule,myOtherSpoolRule"/&gt;</code></pre></div></div></div></div><div class="sect3"><h4 id="Streamcaching-Howitworks"><a class="anchor" href="#Streamcaching-Howitworks"></a>How it works</h4><div class="paragraph"><p>In order to determine if a type requires caching, we leverage the type converter feature. Any type that requires stream caching can be converted into an<code>org.apache.camel.StreamCache</code>instance.</p></div></div></div></article></main></div><footer class="footer"><p>This page was built using the Antora default UI.</p><p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p></footer><script src="../../_/js/site.js"></script><script src="../../_/js/vendor/highlight.js"></script></body></html>