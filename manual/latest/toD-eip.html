<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Untitled :: Apache Camel</title><link rel="canonical" href="https://camel.apache.org/staging/manual/latest/toD-eip.html"><meta name="generator" content="Antora 2.0.0"><link rel="stylesheet" href="../../_/css/site.css"></head><body class="article"><header class="header"><nav class="navbar shadow border-bottom"><div class="navbar-brand"><a class="navbar-item nav-logo" href="../.." title="Apache Camel"></a><button class="navbar-burger" data-target="topbar-nav"><span></span><span></span><span></span></button></div><div id="topbar-nav" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="../../">Home</a><a class="navbar-item" href="../../news/">News</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="../..#">Projects</a><div class="navbar-dropdown"><a class="navbar-item" href="../../projects/camel-k/">Camel K</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="../..#">Documentation</a><div class="navbar-dropdown"><a class="navbar-item" href="../../docs/getting-started/">Getting started</a><a class="navbar-item" href="../../manual/latest/">User manual</a><a class="navbar-item" href="../../components/latest/">Component reference</a><a class="navbar-item" href="../../camel-k/latest/">Camel K</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="../..#">Community</a><div class="navbar-dropdown"><a class="navbar-item" href="../../community/support/">Support</a><a class="navbar-item" href="../..https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a><a class="navbar-item" href="../../community/user-stories/">User stories</a><a class="navbar-item" href="../../community/articles/">Articles</a><a class="navbar-item" href="../../community/books/">Books</a><a class="navbar-item" href="../../community/team/">Team</a><a class="navbar-item" href="../../community/camel-extra/">Camel extra</a></div></div><a class="navbar-item" href="../../download/">Download</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="../..#">About</a><div class="navbar-dropdown"><a class="navbar-item" href="../..https://www.apache.org/events/current-event.html">Apache events</a><a class="navbar-item" href="../..https://www.apache.org/licenses/">License</a><a class="navbar-item" href="../../security/">Security</a><a class="navbar-item" href="../..https://www.apache.org/foundation/sponsorship.html">Sponsorship</a><a class="navbar-item" href="../..https://www.apache.org/foundation/thanks.html">Thanks</a></div></div></div></div></nav></header><div class="main-wrapper"><div class="navigation-container" data-component="manual" data-version="latest"><aside class="navigation"><div class="panels"><div class="navigation-menu is-active" data-panel="menu"><nav class="nav-menu"><h3 class="title"><a href="index.html">User manual</a></h3><ul class="nav-list"><li class="nav-item" data-depth="0"><ul class="nav-list"><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="getting-started.html">Getting started</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="book-getting-started.html">Getting Started with Apache Camel</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="architecture.html">Architecture</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="async.html">Async</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="backlogdebugger.html">Backlog debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bam.html">Business Activity Monitoring</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="batch-consumer.html">Batch Consumer</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="browsable-endpoint.html">BrowsableEndpoint</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camel-core.html">Core</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camelcontext.html">Context</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="endpoint.html">Endpoints</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="cep.html">Complex Event Processing</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="component.html">Component</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="debugger.html">Debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="delay-interceptor.html">Delay interceptor</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dependency-injection.html">Dependency Injection</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dozer-type-conversion.html">Dozer Type Conversion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bean-integration.html">Bean Integration</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="error-handler.html">Error Handler</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange.html">Message Exchange</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange-pattern.html">Exchange Pattern</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="expression.html">Expressions</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="injector.html">Injector</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="intercept.html">Intercept</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="inversion-of-control-with-smart-defaults.html">Inversion Of Control With Smart Defaults</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="jmx.html">JMX</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="lifecycle.html">Camel Lifecycle</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="oncompletion.html">OnCompletion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="predicate.html">Predicates</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="registry.html">Registry</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="route-builder.html">RouteBuilder</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="routes.html">Routes</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><span class="nav-text">Domain Specific Languages</span><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="dsl.html">Camel Domain Specific Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="java-dsl.html">Java DSL</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="spring.html">Spring support</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="groovy-dsl.html">Groovy DSL</a></li></ul></li><li class="nav-item" data-depth="1"><a class="nav-link" href="using-osgi-blueprint-with-camel.html">Using OSGi blueprint with Camel</a></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><span class="nav-text">Camel Core Features</span><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="bean-language.html">Bean method Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="clustering.html">Clustering</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="constant-language.html">Constant Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dynamic-router.html">Dynamic Router</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchangeProperty-language.html">ExchangeProperty Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="file-language.html">File Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="header-language.html">Header Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="health-check.html">Health Check</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="ref-language.html">Ref Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="rest-dsl.html">REST DSL Component</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="return-address.html">Return Address</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="service-registry.html">Service Registry</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="simple-language.html">Simple Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="tokenize-language.html">Tokenize Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="transformer.html">Transformer</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="validator.html">Validator</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="aggregate-eip.html">Aggregate EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="batch-config-eip.html">Batch-config EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bean-eip.html">Bean EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="choice-eip.html">Choice EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="circuitBreaker-eip.html">Circuit Breaker EIP (deprecated)</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="claimCheck-eip.html">Claim Check EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="content-based-router-eip.html">Content Based Router</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="content-filter-eip.html">Content Filter</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="convertBodyTo-eip.html">Convert Body To EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="correlation-identifier.html">Correlation Identifier</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="customLoadBalancer-eip.html">Custom Load Balancer EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dead-letter-channel.html">Dead Letter Channel</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="delay-eip.html">Delay EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dynamicRouter-eip.html">Dynamic Router EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="enrich-eip.html">Enrich EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="event-message.html">Event Message</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="eventDrivenConsumer-eip.html">Event Driven Consumer</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="failover-eip.html">Failover EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="filter-eip.html">Filter EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="from-eip.html">From EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="guaranteed-delivery.html">Guaranteed Delivery</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="hystrix-eip.html">Hystrix EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="hystrixConfiguration-eip.html">Hystrix Configuration EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="idempotentConsumer-eip.html">Idempotent Consumer EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="inOnly-eip.html">In Only EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="inOut-eip.html">In Out EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="loadBalance-eip.html">Load Balance EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="log-eip.html">Log EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="loop-eip.html">Loop EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="marshal-eip.html">Marshal EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="message-bus.html">Message Bus</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="message-channel.html">Message Channel</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="message-endpoint.html">Message Endpoint</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="message-router.html">Message Router</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="message-translator.html">Message Translator</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="message.html">Message</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="multicast-eip.html">Multicast EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="onFallback-eip.html">On Fallback EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="otherwise-eip.html">Otherwise EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="pipeline-eip.html">Pipeline EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="point-to-point-channel.html">Point to Point Channel</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="pollEnrich-eip.html">Poll Enrich EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="process-eip.html">Process EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="publish-subscribe-channel.html">Publish Subscribe Channel</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="random-eip.html">Random EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="recipientList-eip.html">Recipient List EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="removeHeader-eip.html">Remove Header EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="removeHeaders-eip.html">Remove Headers EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="removeProperties-eip.html">Remove Properties EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="removeProperty-eip.html">Remove Property EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="requestReply-eip.html">Request Reply</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="resequence-eip.html">Resequence EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="rollback-eip.html">Rollback EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="roundRobin-eip.html">Round Robin EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="routingSlip-eip.html">Routing Slip EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="saga-eip.html">Saga EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="sample-eip.html">Sample EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="script-eip.html">Script EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="serviceCall-eip.html">Service Call EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="setBody-eip.html">Set Body EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="setFaultBody-eip.html">Set Fault Body EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="setHeader-eip.html">Set Header EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="setOutHeader-eip.html">Set Out Header EIP (deprecated)</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="setProperty-eip.html">Set Property EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="sort-eip.html">Sort EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="split-eip.html">Split EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="step-eip.html">Step EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="sticky-eip.html">Sticky EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="stop-eip.html">Stop EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="stream-config-eip.html">Stream-config EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="threads-eip.html">Threads EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="throttle-eip.html">Throttle EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="to-eip.html">To EIP</a></li><li class="nav-item is-current-page" data-depth="2"><a class="nav-link" href="toD-eip.html">To D EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="topic-eip.html">Topic EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="transactional-client.html">Transactional Client</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="transform-eip.html">Transform EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="unmarshal-eip.html">Unmarshal EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="validate-eip.html">Validate EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="weighted-eip.html">Weighted EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="when-eip.html">When EIP</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="wireTap-eip.html">Wire Tap EIP</a></li></ul></li></ul></li></ul></nav></div><div class="navigation-explore" data-panel="explore"><div class="context"><span class="title">User manual</span><span class="version">latest</span></div><ul class="components"><li class="component"><span class="title">Apache Camel K</span><ul class="versions"><li class="version is-latest"><a href="../../camel-k/latest/index.html">latest</a></li></ul></li><li class="component"><span class="title">Component reference</span><ul class="versions"><li class="version is-latest"><a href="../../components/latest/index.html">latest</a></li></ul></li><li class="component is-current"><span class="title">User manual</span><ul class="versions"><li class="version is-current is-latest"><a href="index.html">latest</a></li></ul></li></ul></div></div></aside></div><main class="main"><div class="toolbar" role="navigation"><button class="navigation-toggle"></button><a href="index.html" class="home-link"></a><nav class="crumbs" aria-label="breadcrumbs"><ul><li class="crumb"><a href="index.html">User manual</a></li><li class="crumb"><a href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a></li><li class="crumb"><a href="toD-eip.html">To D EIP</a></li></ul></nav><div class="edit-this-page"><a href="https://github.com/apache/camel/edit/master/docs/user-manual/modules/ROOT/pages/toD-eip.adoc">Edit this Page</a></div></div><article class="doc"><div class="sect1"><h2 id="toD-eip"><a class="anchor" href="#toD-eip"></a>To D EIP</h2><div class="sectionbody"><div class="paragraph"><p>There is a new<code>.toD</code>/<code>&lt;toD&gt;</code>that allows to send a message to a dynamic computed <a href="#Endpoint-Endpoints">Endpoint</a>using one or more <a href="expression.html">Expression</a>that are concat together. By default the <a href="#simple-language">Simple</a>language is used to compute the endpoint.</p></div><div class="sect2"><h3 id="_options"><a class="anchor" href="#_options"></a>Options</h3><div class="paragraph"><p>The To D EIP supports 5 options which are listed below:</p></div><table class="tableblock frame-all grid-all stretch"><colgroup><col style="width: 20%;"><col style="width: 50%;"><col style="width: 10%;"><col style="width: 20%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Name</th><th class="tableblock halign-left valign-top">Description</th><th class="tableblock halign-center valign-top">Default</th><th class="tableblock halign-left valign-top">Type</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>uri</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Required</strong>The uri of the endpoint to send to. The uri can be dynamic computed using the org.apache.camel.language.simple.SimpleLanguage expression.</p></td><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>pattern</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Sets the optional ExchangePattern used to invoke this endpoint</p></td><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">ExchangePattern</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>cacheSize</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum size used by the org.apache.camel.spi.ConsumerCache which is used to cache and reuse producers.</p></td><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ignoreInvalidEndpoint</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Ignore the invalidate endpoint exception when try to create a producer with that endpoint</p></td><td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>allowOptimisedComponents</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Whether to allow components to optimise toD if they are org.apache.camel.spi.SendDynamicAware.</p></td><td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td></tr></tbody></table></div><div class="sect2"><h3 id="_samples"><a class="anchor" href="#_samples"></a>Samples</h3><div class="paragraph"><p>For example to send a message to a endpoint defined by a header you can do as shown below:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:start")
  .toD("${header.foo}");</code></pre></div></div><div class="paragraph"><p>And in XML:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;route&gt;
  &lt;from uri="direct:start"/&gt;
  &lt;toD uri="${header.foo}"/&gt;
&lt;/route&gt;</code></pre></div></div><div class="paragraph"><p>You can also prefix the uri with a value because by default the uri is evaluated using the <a href="#simple-language">Simple</a>language</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:start")
  .toD("mock:${header.foo}");</code></pre></div></div><div class="paragraph"><p>And in XML:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;route&gt;
  &lt;from uri="direct:start"/&gt;
  &lt;toD uri="mock:${header.foo"/&gt;
&lt;/route&gt;</code></pre></div></div><div class="paragraph"><p>In the example above we compute an endpoint that has prefix "mock:" and then the header foo is appended. So for example if the header foo has value order, then the endpoint is computed as "mock:order".</p></div><div class="paragraph"><p>You can also use other languages than<a href="#simple-language">Simple</a> such as <a href="#xpath-language">XPath</a> - this requires to prefix with language: as shown below (simple language is the default language). If you do not specify language: then the endpoint is a component name. And in some cases there is both a component and language with the same name such as xquery.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;route&gt;
  &lt;from uri="direct:start"/&gt;
  &lt;toD uri="language:xpath:/order/@uri"/&gt;
&lt;/route&gt;</code></pre></div></div><div class="paragraph"><p>This is done by specifying the name of the language followed by a colon.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:start")
  .toD("language:xpath:/order/@uri");</code></pre></div></div><div class="paragraph"><p>You can also concat multiple <a href="#language-component">Language</a>(s) together using the plus sign <code>+</code>such as shown below:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;route&gt;
  &lt;from uri="direct:start"/&gt;
  &lt;toD uri="jms:${header.base}+language:xpath:/order/@id"/&gt;
&lt;/route&gt;</code></pre></div></div><div class="paragraph"><p>In the example above the uri is a combination of <a href="#simple-language">Simple</a> language and <a href="#simple-language">XPath</a> where the first part is simple (simple is default language). And then the plus sign separate to another language, where we specify the language name followed by a colon</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:start")
  .toD("jms:${header.base}+language:xpath:/order/@id");</code></pre></div></div><div class="paragraph"><p>You can concat as many languages as you want, just separate them with the plus sign</p></div></div><div class="sect2"><h3 id="_avoid_creating_endless_dynamic_endpoints_which_takes_up_resources"><a class="anchor" href="#_avoid_creating_endless_dynamic_endpoints_which_takes_up_resources"></a>Avoid creating endless dynamic endpoints which takes up resources</h3><div class="paragraph"><p>When using dynamic computed endpoints with<code>toD</code>then you may compute a lot of dynamic endpoints, which results in an overhead of resources in use, by each dynamic endpoint uri, and its associated producer.</p></div><div class="paragraph"><p>For example HTTP based endpoints where you may have dynamic values in URI parameters when calling the HTTP service, such as:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:login")
  .toD("http:myloginserver:8080/login?userid=${header.userName}");</code></pre></div></div><div class="paragraph"><p>In the example above then the parameter<code>userid</code>is dynamic computed, and would result in one instance of endpoint and producer for each different userid. To avoid having too many dynamic endpoints you can configure<code>toD</code>to reduce its cache size, for example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:login")
  .toD("http:myloginserver:8080/login?cacheSize=10&amp;userid=${header.userName}");</code></pre></div></div><div class="paragraph"><p>where the cache is 10.<strong>Important</strong>this will only reduce the endpoint cache of the<code>toD</code>that has a chance of being reused in case a message is routed with the same<code>userName</code>header. Therefore reducing the cache size will not solve the<em>endless dynamic endoints</em>problem. Instead you should use static endpoints with<code>to</code>and provide the dynamic parts in Camel message headers (if possible).</p></div><div class="paragraph"><p>The example above can resolve via static endpoints, or from Camel 2.22 onwards via optimised components (see further below)</p></div><div class="sect3"><h4 id="_using_static_endpoints"><a class="anchor" href="#_using_static_endpoints"></a>Using static endpoints</h4><div class="paragraph"><p>In the example above then the parameter<code>userid</code>is dynamic computed, and would result in one instance of endpoint and producer for each different userid. To avoid having too dynamic endpoints you use a single static endpoint and use headers to provide the dynamic parts:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:login")
  .setHeader(Exchange.HTTP_PATH, constant("/login"))
  .setHeader(Exchange.HTTP_QUERY, simple("userid=${header.userName}"))
  .toD("http:myloginserver:8080");</code></pre></div></div><div class="paragraph"><p>If you are using Camel 2.22 onwards then you can use its optimised components for<code>toD</code>that can<em>solve</em>this out of the box, as documented next.</p></div></div></div><div class="sect2"><h3 id="_using_optimised_components"><a class="anchor" href="#_using_optimised_components"></a>Using optimised components</h3><div class="paragraph"><p>But a better solution would be if the HTTP component could be optimised to handle the variations of dynamic computed endpoint uris. This is now possible with<strong>Camel 2.22</strong>onwards, where the following components has been optimised for<code>toD</code>:</p></div><div class="ulist"><ul><li><p>camel-http</p></li><li><p>camel-http4</p></li><li><p>camel-jetty</p></li><li><p>camel-netty4-http</p></li><li><p>camel-undertow</p></li></ul></div><div class="paragraph"><p>For the optimisation to work, then:</p></div><div class="olist arabic"><ol class="arabic"><li><p>The optimisation is detected and activated during startup of the Camel routes with `toD&#8217;s.</p></li><li><p>The dynamic uri in<code>toD</code>must provide the component name as either static or resolved via property placeholders.</p></li><li><p>The supported components must be on the classpath.</p></li></ol></div><div class="paragraph"><p>The HTTP based components will be optimised to use the same hostname:port for each endpoint, and the dynamic values for context-path and query parameters will be provided as headers:</p></div><div class="paragraph"><p>For example this route:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:login")
  .toD("http:myloginserver:8080/login?userid=${header.userName}");</code></pre></div></div><div class="paragraph"><p>will essentially be optimised to (pseudo route):</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:login")
  .setHeader(Exchange.HTTP_PATH, expression("/login"))
  .setHeader(Exchange.HTTP_QUERY, expression("userid=${header.userName}"))
  .toD("http:myloginserver:8080")
  .removeHeader(Exchange.HTTP_PATH)
  .removeHeader(Exchange.HTTP_QUERY);</code></pre></div></div><div class="paragraph"><p>Where<em>expression</em>will be evaluated dynamically. Notice how the uri in<code>toD</code>is now static (<code>http:myloginserver:8080</code>). This optimisation allows Camel to reuse the same endpoint and its associated producer for all dynamic variations. This yields much lower resource overhead as the same http producer will be used for all the different variations of userid&#8217;s.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">When the optimised component is in use, then you cannot use the headers<code>Exchange.HTTP_PATH</code>and<code>Exchange.HTTP_QUERY</code>to provide dynamic values to override the uri in<code>toD</code>. If you want to use these headers, then use the plain<code>to</code>DSL instead. In other words these headers are used internally by<code>toD</code>to carry the dynamic details of the endpoint.</td></tr></table></div><div class="paragraph"><p>In case of problems then you can turn on DEBUG logging level on<code>org.apache.camel.processor.SendDynamicProcessor</code>which will log during startup if<code>toD</code>was optimised, or if there was a failure loading the optimised component, with a stacktrace logged.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Detected SendDynamicAware component: http optimising toD: http:myloginserver:8080/login?userid=${header.userName}</code></pre></div></div></div></div></div></article></main></div><footer class="footer"><p>This page was built using the Antora default UI.</p><p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p></footer><script src="../../_/js/site.js"></script><script src="../../_/js/vendor/highlight.js"></script><script>hljs.initHighlighting()</script></body></html>