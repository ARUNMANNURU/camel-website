<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Untitled :: Apache Camel</title><link rel="canonical" href="https://camel.apache.org/staging/manual/latest/try-catch-finally.html"><meta name="generator" content="Antora 2.0.0"><link rel="stylesheet" href="../../_/css/site.css"></head><body class="article"><header class="header"><nav class="navbar shadow border-bottom"><div class="navbar-brand"><a class="navbar-item nav-logo" href="../.." title="Apache Camel"></a><button class="navbar-burger" data-target="topbar-nav"><span></span><span></span><span></span></button></div><div id="topbar-nav" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="../../">Home</a><a class="navbar-item" href="../../news/">News</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="../..#">Projects</a><div class="navbar-dropdown"><a class="navbar-item" href="../../projects/camel-k/">Camel K</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="../..#">Documentation</a><div class="navbar-dropdown"><a class="navbar-item" href="../../docs/getting-started/">Getting started</a><a class="navbar-item" href="../../manual/latest/">User manual</a><a class="navbar-item" href="../../components/latest/">Component reference</a><a class="navbar-item" href="../../camel-k/latest/">Camel K</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="../..#">Community</a><div class="navbar-dropdown"><a class="navbar-item" href="../../community/support/">Support</a><a class="navbar-item" href="../..https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a><a class="navbar-item" href="../../community/user-stories/">User stories</a><a class="navbar-item" href="../../community/articles/">Articles</a><a class="navbar-item" href="../../community/books/">Books</a><a class="navbar-item" href="../../community/team/">Team</a><a class="navbar-item" href="../../community/camel-extra/">Camel extra</a></div></div><a class="navbar-item" href="../../download/">Download</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="../..#">About</a><div class="navbar-dropdown"><a class="navbar-item" href="../..https://www.apache.org/events/current-event.html">Apache events</a><a class="navbar-item" href="../..https://www.apache.org/licenses/">License</a><a class="navbar-item" href="../../security/">Security</a><a class="navbar-item" href="../..https://www.apache.org/foundation/sponsorship.html">Sponsorship</a><a class="navbar-item" href="../..https://www.apache.org/foundation/thanks.html">Thanks</a></div></div></div></div></nav></header><div class="main-wrapper"><div class="navigation-container" data-component="manual" data-version="latest"><aside class="navigation"><div class="panels"><div class="navigation-menu is-active" data-panel="menu"><nav class="nav-menu"><h3 class="title"><a href="index.html">User manual</a></h3><ul class="nav-list"><li class="nav-item" data-depth="0"><ul class="nav-list"><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="getting-started.html">Getting started</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="book-getting-started.html">Getting Started with Apache Camel</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="architecture.html">Architecture</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="async.html">Async</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="backlogdebugger.html">Backlog debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bam.html">Business Activity Monitoring</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="batch-consumer.html">Batch Consumer</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="browsable-endpoint.html">BrowsableEndpoint</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camel-core.html">Core</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camelcontext.html">Context</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="endpoint.html">Endpoints</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="cep.html">Complex Event Processing</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="component.html">Component</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="debugger.html">Debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="delay-interceptor.html">Delay interceptor</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dependency-injection.html">Dependency Injection</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dozer-type-conversion.html">Dozer Type Conversion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bean-integration.html">Bean Integration</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="error-handler.html">Error Handler</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange.html">Message Exchange</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange-pattern.html">Exchange Pattern</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="expression.html">Expressions</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="injector.html">Injector</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="intercept.html">Intercept</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="inversion-of-control-with-smart-defaults.html">Inversion Of Control With Smart Defaults</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="jmx.html">JMX</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="lifecycle.html">Camel Lifecycle</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="oncompletion.html">OnCompletion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="predicate.html">Predicates</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="registry.html">Registry</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="route-builder.html">RouteBuilder</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="routes.html">Routes</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><span class="nav-text">Domain Specific Languages</span><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="dsl.html">Camel Domain Specific Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="java-dsl.html">Java DSL</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="spring.html">Spring support</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="groovy-dsl.html">Groovy DSL</a></li></ul></li><li class="nav-item" data-depth="1"><a class="nav-link" href="using-osgi-blueprint-with-camel.html">Using OSGi blueprint with Camel</a></li></ul></li></ul></nav></div><div class="navigation-explore" data-panel="explore"><div class="context"><span class="title">User manual</span><span class="version">latest</span></div><ul class="components"><li class="component"><span class="title">Apache Camel K</span><ul class="versions"><li class="version is-latest"><a href="../../camel-k/latest/index.html">latest</a></li></ul></li><li class="component"><span class="title">Component reference</span><ul class="versions"><li class="version is-latest"><a href="../../components/latest/index.html">latest</a></li></ul></li><li class="component is-current"><span class="title">User manual</span><ul class="versions"><li class="version is-current is-latest"><a href="index.html">latest</a></li></ul></li></ul></div></div></aside></div><main class="main"><div class="toolbar" role="navigation"><button class="navigation-toggle"></button><a href="index.html" class="home-link"></a><nav class="crumbs" aria-label="breadcrumbs"></nav><div class="edit-this-page"><a href="https://github.com/apache/camel/edit/master/docs/user-manual/modules/ROOT/pages/try-catch-finally.adoc">Edit this Page</a></div></div><article class="doc"><div class="sect2"><h3 id="TryCatchFinally-TryCatchFinally"><a class="anchor" href="#TryCatchFinally-TryCatchFinally"></a>Try &#8230;&#8203; Catch &#8230;&#8203; Finally</h3><div class="paragraph"><p>Camel supports the Java equivalent of try .. catch and finally directly in the DSL. It aims to work like its Java sisters but with more power. Especially in Camel 2.0 where we gave this feature an overhaul.</p></div><div class="paragraph"><p>In Camel we prefix the keywords with<code>do</code>to avoid having same keyword as Java. So we have:</p></div><div class="ulist"><ul><li><p><code>doTry</code></p></li><li><p><code>doCatch</code></p></li><li><p><code>doFinally</code></p></li><li><p><code>end</code>to end the block in Java DSL</p></li></ul></div><div class="paragraph"><p>Notice this document is based on how it works in Camel 2.0. In Camel 1.x this feature isn&#8217;t as powerful and it uses a slight different keyword names.</p></div><div class="sect4"><h5 id="_camel_error_handling_is_disabled"><a class="anchor" href="#_camel_error_handling_is_disabled"></a>Camel error handling is disabled</h5><div class="paragraph"><p>When using<code>doTry .. doCatch .. doFinally</code>then the regular Camel<a href="error-handler.adoc">Error Handler</a>does not apply. That means any<code>onException</code>or the likes does not trigger. The reason is that<code>doTry .. doCatch .. doFinally</code>is in fact its own error handler and that it aims to mimic and work like how try/catch/finally works in Java.</p></div></div><div class="sect3"><h4 id="TryCatchFinally-AboutdoCatchanditspoweroverJava"><a class="anchor" href="#TryCatchFinally-AboutdoCatchanditspoweroverJava"></a>About<code>doCatch</code>and its power over Java</h4><div class="paragraph"><p>The<code>doCatch</code>in Camel is empowered over its Java sister.</p></div><div class="paragraph"><p>First of all you can define multiple exceptions to catch in a single block.</p></div><div class="paragraph"><p>And second of all an important aspect over the regular Java counter parts is that Camel will check in the exception hierarchy when it matches a thrown exception against the<code>doCatch</code>blocks. The reasons is that many times the original caused exceptions is wrapped by other wrapper exceptions, typically transposing the exception from a checked to a runtime exception. Camel for instance does this by wrapped it in a<code>RuntimeCamelException</code>. So if the original caused exception is an<code>java.io.IOException</code>then Camel will still match a<code>doCatch</code>block defined with an<code>java.io.IOException</code>. And just like Java the order in which you have multiple<code>doCatch</code>blocks matter. Camel will iterate from the top going down and use the first<code>doCatch</code>that matches the exception. The reason is to keep it similar to the regular java and how it selects a catch block. This differers from the<a href="exception-clause.adoc">Exception Clause</a>that has a more intelligent exception selection strategy among multiple<code>onException</code>definitions, where it also consider the delta in the exception hierarchy to select the best definition.</p></div><div class="paragraph"><p>A third feature is that you can attach a<code>onWhen</code>predicate to signal if the catch should trigger or not at runtime.</p></div><div class="paragraph"><p>And to simulate<em>rethrowing</em>an exception from a<code>doCatch</code>you should use the<code>handled</code>predicate. If its evaluated to<code>false</code>Camel will reattach the exception on the<a href="exchange.adoc">Exchange</a>.</p></div></div><div class="sect3"><h4 id="TryCatchFinally-UsingtrycatchfinallyinJavaDSL"><a class="anchor" href="#TryCatchFinally-UsingtrycatchfinallyinJavaDSL"></a>Using try .. catch .. finally in Java DSL</h4><div class="paragraph"><p>In the route below we have all keywords in action. As the code is based on a unit test we route using<a href="#mock-component">Mock</a>.</p></div><div class="paragraph"><p><a href="https://github.com/apache/camel/tree/master/camel-core/src/test/java/org/apache/camel/processor/TryProcessorMultipleExceptionTest.java">TryProcessorMultipleExceptionTest.java</a></p></div><div class="paragraph"><p>And in the route below we want to indicate if an IOException occured we want to route it elsewhere and at the same time keep the exception so the original caller is notified about this exception. To do this we need to not<em>rethrow</em>the exception and this is why we use<strong>handled</strong>and set it to false to indicate, no we did not handle it so please keep the exception. The 2nd exception block can be omitted but as the code is based on an unit test we want to test the behavior non<code>IOException</code>as well.</p></div><div class="paragraph"><p><a href="https://github.com/apache/camel/tree/master/camel-core/src/test/java/org/apache/camel/processor/TryProcessorHandledTest.java">TryProcessorHandledTest.java</a></p></div><div class="paragraph"><p>And finally we have an example of the<code>onWhen</code>predicate in action. We can attach it to a<code>doCatch</code>block and at runtime determine if the block should be triggered or not. In our case we only want to trigger if the caused exception message contains the<strong>damn</strong>word.</p></div><div class="paragraph"><p><a href="https://github.com/apache/camel/tree/master/camel-core/src/test/java/org/apache/camel/processor/TryProcessorOnWhenTest.java">TryProcessorOnWhenTest.java</a></p></div><div class="sect4"><h5 id="_use_end_to_end_the_block"><a class="anchor" href="#_use_end_to_end_the_block"></a>Use end() to end the block</h5><div class="paragraph"><p>Notice when using Java DSL we must use<code>end()</code>to indicate where the try .. catch .. finally block ends. As the example above has a finally, then the<code>end()</code>should be at the end of the finally block. If we are not using a finally, then the<code>end()</code>should be at the end of the<code>doCatch</code>to indicate the end there.</p></div></div></div><div class="sect3"><h4 id="TryCatchFinally-Usingtry..catch..finallyinSpringDSL"><a class="anchor" href="#TryCatchFinally-Usingtry..catch..finallyinSpringDSL"></a>Using try .. catch .. finally in Spring DSL</h4><div class="paragraph"><p>We show the three sample samples using Spring DSL instead.</p></div><div class="paragraph"><p>In the route below we have all keywords in action. As the code is based on a unit test we route using<a href="#mock-component">Mock</a>.</p></div><div class="paragraph"><p><a href="https://github.com/apache/camel/tree/master/components/camel-spring/src/test/resources/org/apache/camel/spring/processor/SpringTryProcessorMultipleExceptionTest.xml">SpringTryProcessorMultipleExceptionTest.xml</a></p></div><div class="paragraph"><p>And in the route below we want to indicate if an IOException occured we want to route it elsewhere and at the same time keep the exception so the original caller is notified about this exception. To do this we need to not<em>rethrow</em>the exception and this is why we use<strong>handled</strong>and set it to false to indicate, no we did not handle it so please keep the exception. The 2nd exception block can be omitted but as the code is based on an unit test we want to test the behavior non<code>IOException</code>as well.</p></div><div class="paragraph"><p><a href="https://github.com/apache/camel/tree/master/components/camel-spring/src/test/resources/org/apache/camel/spring/processor/SpringTryProcessorHandledTest.xml">SpringTryProcessorHandledTest.xml</a></p></div><div class="paragraph"><p>And finally we have an example of the<code>onWhen</code>predicate in action. We can attach it to a<code>doCatch</code>block and at runtime determine if the block should be triggered or not. In our case we only want to trigger if the caused exception message contains the<strong>damn</strong>word.</p></div><div class="paragraph"><p><a href="https://github.com/apache/camel/tree/master/components/camel-spring/src/test/resources/org/apache/camel/spring/processor/SpringTryProcessorOnWhenTest.xml">SpringTryProcessorOnWhenTest.xml</a></p></div></div><div class="sect3"><h4 id="TryCatchFinally-SeeAlso"><a class="anchor" href="#TryCatchFinally-SeeAlso"></a>See Also</h4><div class="ulist"><ul><li><p><a href="error-handling-in-camel.adoc">Error handling in Camel</a></p></li><li><p><a href="error-handler.adoc">Error Handler</a></p></li><li><p><a href="exception-clause.adoc">Exception Clause</a></p></li></ul></div></div></div></article></main></div><footer class="footer"><p>This page was built using the Antora default UI.</p><p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p></footer><script src="../../_/js/site.js"></script><script src="../../_/js/vendor/highlight.js"></script><script>hljs.initHighlighting()</script></body></html>