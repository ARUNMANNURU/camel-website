<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Untitled :: Apache Camel</title><link rel="canonical" href="https://camel.apache.org/manual/latest/type-converter.html"><meta name="generator" content="Antora 2.0.0"><link rel="stylesheet" href="../../_/css/site.css"></head><body class="article"><header class="header"><nav class="navbar shadow border-bottom"><div class="navbar-brand"><a class="navbar-item nav-logo" href="https://camel.apache.org" title="Apache Camel"></a><button class="navbar-burger" data-target="topbar-nav"><span></span><span></span><span></span></button></div><div id="topbar-nav" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/news/">News</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Projects</a><div class="navbar-dropdown"><a class="navbar-item" href="/projects/camel-k/">Camel K</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Documentation</a><div class="navbar-dropdown"><a class="navbar-item" href="/docs/getting-started/">Getting started</a><a class="navbar-item" href="/manual/latest/">User manual</a><a class="navbar-item" href="/components/latest/">Component reference</a><a class="navbar-item" href="/camel-k/latest/">Camel K</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">Community</a><div class="navbar-dropdown"><a class="navbar-item" href="/community/support/">Support</a><a class="navbar-item" href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a><a class="navbar-item" href="/community/user-stories/">User stories</a><a class="navbar-item" href="/community/articles/">Articles</a><a class="navbar-item" href="/community/books/">Books</a><a class="navbar-item" href="/community/team/">Team</a><a class="navbar-item" href="/community/camel-extra/">Camel extra</a></div></div><a class="navbar-item" href="/download/">Download</a><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link" href="#">About</a><div class="navbar-dropdown"><a class="navbar-item" href="https://www.apache.org/events/current-event.html">Apache events</a><a class="navbar-item" href="https://www.apache.org/licenses/">License</a><a class="navbar-item" href="https://www.apache.org/security/">Security</a><a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a><a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a></div></div></div></div></nav></header><div class="main-wrapper"><div class="navigation-container" data-component="manual" data-version="latest"><aside class="navigation"><div class="panels"><div class="navigation-menu is-active" data-panel="menu"><nav class="nav-menu"><h3 class="title"><a href="index.html">User manual</a></h3><ul class="nav-list"><li class="nav-item" data-depth="0"><ul class="nav-list"><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="getting-started.html">Getting started</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="book-getting-started.html">Getting Started with Apache Camel</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><a class="nav-link" href="architecture.html">Architecture</a><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="async.html">Async</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="backlogdebugger.html">Backlog debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bam.html">Business Activity Monitoring</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="batch-consumer.html">Batch Consumer</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="browsable-endpoint.html">BrowsableEndpoint</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camel-core.html">Core</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="camelcontext.html">Context</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="endpoint.html">Endpoints</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="cep.html">Complex Event Processing</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="component.html">Component</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="debugger.html">Debugger</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="delay-interceptor.html">Delay interceptor</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dependency-injection.html">Dependency Injection</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="dozer-type-conversion.html">Dozer Type Conversion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="bean-integration.html">Bean Integration</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="error-handler.html">Error Handler</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange.html">Message Exchange</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="exchange-pattern.html">Exchange Pattern</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="expression.html">Expressions</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="injector.html">Injector</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="intercept.html">Intercept</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="inversion-of-control-with-smart-defaults.html">Inversion Of Control With Smart Defaults</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="lifecycle.html">Camel Lifecycle</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="oncompletion.html">OnCompletion</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="predicate.html">Predicates</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="registry.html">Registry</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="route-builder.html">RouteBuilder</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="routes.html">Routes</a></li></ul></li><li class="nav-item" data-depth="1"><button class="nav-toggle"></button><span class="nav-text">Domain Specific Languages</span><ul class="nav-list"><li class="nav-item" data-depth="2"><a class="nav-link" href="dsl.html">Camel Domain Specific Language</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="java-dsl.html">Java DSL</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="spring.html">Spring support</a></li><li class="nav-item" data-depth="2"><a class="nav-link" href="groovy-dsl.html">Groovy DSL</a></li><li class="nav-item" data-depth="2"><button class="nav-toggle"></button><span class="nav-text">Scala DSL</span><ul class="nav-list"><li class="nav-item" data-depth="3"><a class="nav-link" href="scala-dsl.html">About the Scala DSL</a></li><li class="nav-item" data-depth="3"><a class="nav-link" href="scala-dsl-getting-started.html">Getting Started</a></li><li class="nav-item" data-depth="3"><a class="nav-link" href="scala-dsl-eip.html">EIP</a></li><li class="nav-item" data-depth="3"><a class="nav-link" href="scala-dsl-supported-languages.html">Supported languages</a></li></ul></li></ul></li><li class="nav-item" data-depth="1"><a class="nav-link" href="using-osgi-blueprint-with-camel.html">Using OSGi blueprint with Camel</a></li></ul></li></ul></nav></div><div class="navigation-explore" data-panel="explore"><div class="context"><span class="title">User manual</span><span class="version">latest</span></div><ul class="components"><li class="component"><span class="title">Apache Camel K</span><ul class="versions"><li class="version is-latest"><a href="../../camel-k/latest/index.html">latest</a></li></ul></li><li class="component"><span class="title">Component reference</span><ul class="versions"><li class="version is-latest"><a href="../../components/latest/index.html">latest</a></li></ul></li><li class="component is-current"><span class="title">User manual</span><ul class="versions"><li class="version is-current is-latest"><a href="index.html">latest</a></li></ul></li></ul></div></div></aside></div><main class="main"><div class="toolbar" role="navigation"><button class="navigation-toggle"></button><a href="index.html" class="home-link"></a><nav class="crumbs" aria-label="breadcrumbs"></nav><div class="edit-this-page"><a href="https://github.com/apache/camel/edit/master/docs/user-manual/modules/ROOT/pages/type-converter.adoc">Edit this Page</a></div></div><article class="doc"><div class="sect2"><h3 id="TypeConverter-TypeConverter"><a class="anchor" href="#TypeConverter-TypeConverter"></a>Type Converter</h3><div class="paragraph"><p>It is very common when routing messages from one endpoint to another to need to convert the body payloads from one type to another such as to convert to and from the following common types:</p></div><div class="ulist"><ul><li><p>File</p></li><li><p>String</p></li><li><p>byte[] and ByteBuffer</p></li><li><p>InputStream and OutputStream</p></li><li><p>Reader and Writer</p></li><li><p>Document and Source</p></li><li><p>&#8230;&#8203;</p></li></ul></div><div class="paragraph"><p>The<a href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Message.html">Message interface</a>defines a helper method to allow conversions to be done via the<a href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/Message.html#getBody(java.lang.Class)">getBody(Class)</a>method.</p></div><div class="paragraph"><p>So in an endpoint you can convert a body to another type via:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Message message = exchange.getIn();
Document document = message.getBody(Document.class);</code></pre></div></div><div class="sect3"><h4 id="TypeConverter-HowTypeConversionworks"><a class="anchor" href="#TypeConverter-HowTypeConversionworks"></a>How Type Conversion works</h4><div class="paragraph"><p>The type conversion strategy is defined by the<a href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/TypeConverter.html">TypeConverter</a>interface that can be customized on a<a href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/CamelContext.html">CamelContext</a>.</p></div><div class="paragraph"><p>Camel provides two type converter registy implementations:</p></div><div class="ulist"><ul><li><p>FastTypeConverterRegistry (new default)</p></li><li><p>DefaultTypeConverterRegistry (old)</p></li></ul></div><div class="paragraph"><p>From Camel 3 onwards there is a faster type converter registry implementation that is enabled by default. This implementation uses source code generation via the<code>camel-apt</code>compiler plugin to generate source code, that allows Camel at runtime to load and invoke these type converters via quick java method invocations. The older implementation in Camel 2 uses a annotation based discover to load and register type converters and invokes the type converters via Java method call reflections.</p></div></div><div class="sect3"><h4 id="TypeConverter-TypeConverterRegistry"><a class="anchor" href="#TypeConverter-TypeConverterRegistry"></a>TypeConverterRegistry</h4><div class="paragraph"><p>Exposed the<a href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/spi/TypeConverterRegistry.html">TypeConverterRegistry</a>from<a href="camelcontext.adoc">CamelContext</a>so end users more easily will be able to add type converters at runtime. This is also usable in situations where the default discovering of type converters fails on platforms with classloading issues.</p></div><div class="paragraph"><p>To access the registry, you get it from the<code>CamelContext</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">CamelContext context = ...
context.getTypeConverterRegistry()</code></pre></div></div><div class="sect4"><h5 id="TypeConverter-TypeConverterRegistryutilizationstatistics"><a class="anchor" href="#TypeConverter-TypeConverterRegistryutilizationstatistics"></a>TypeConverterRegistry utilization statistics</h5><div class="paragraph"><p>Camel can gather utilization statistics of the runtime usage of type converters. These stats are available in JMX, and as well as from the<code>getStatistics()</code>method from<code>TypeConverterRegistry</code>.</p></div><div class="paragraph"><p>These statistics are turned off by default as there is some performance overhead under very high concurrent load. To enable the statistics in Java, do the following:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">CamelContext context = ...
context.setTypeConverterStatisticsEnabled(true);</code></pre></div></div><div class="paragraph"><p>Or in the XML DSL with:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;camelContext xmlns="http://camel.apache.org/schema/spring" typeConverterStatisticsEnabled="true"&gt;
    ...
&lt;/camelContext&gt;</code></pre></div></div></div><div class="sect4"><h5 id="TypeConverter-Addtypeconverterclassesatruntime"><a class="anchor" href="#TypeConverter-Addtypeconverterclassesatruntime"></a>Add type converter classes at runtime</h5><div class="paragraph"><p>You can add new type converters at runtime, by having your classes implement <code>org.apache.camel.TypeConverters</code>which is an marker interface. Then for each type converter you want use the <code>@Converter</code> annotation.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private class MyOrderTypeConverters implements TypeConverters {
    @Converter
    public MyOrder toMyOrder(String orderId) {
        MyOrder order = new MyOrder();
        order.setId(Integer.parseInt(orderId));
        return order;
    }
}</code></pre></div></div><div class="paragraph"><p>Then you can add these converters to the registry using:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">MyOrderTypeConverters myClass = ...
context.getTypeConverterRegistry().addTypeConverters(myClass);</code></pre></div></div><div class="paragraph"><p>If you are using Spring or Blueprint, then you can just declare a<code>&lt;bean&gt;</code>then<code>CamelContext</code>will automatic discover and add the converters.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="myOrderTypeConverters" class="..."/&gt;
    &lt;camelContext ...&gt;
        ...
    &lt;/camelContext&gt;</code></pre></div></div><div class="paragraph"><p>You can declare multiple `&lt;bean&gt;`s if you have more classes.</p></div></div></div><div class="sect3"><h4 id="TypeConverter-DiscoveringTypeConverters"><a class="anchor" href="#TypeConverter-DiscoveringTypeConverters"></a>Discovering Type Converters</h4><div class="paragraph"><p>Camel will automatic discover and load type converters from all the JARs in the classpath on startup.</p></div><div class="paragraph"><p>Camel will search the classpath for a file called<code>META-INF/services/org/apache/camel/TypeConverterLoader</code>, which lists all type converter loader classes (they are automatic source code generated by the<code>camel-apt</code>compilter plugin). These<em>loader</em>classes will load the type converters into the Camel type converter registry and invoking these type converters is done in a<em>fast way</em>using standard java method calls.</p></div><div class="paragraph"><p>The discover will fallback and discover Camel 2.x compatible type converters by search the classpath for a file called<code>META-INF/services/org/apache/camel/TypeConverter</code>, which lists all the type converter classes. These classes will then automatic be registered in the type converter registry. However invoking these type converters does<strong>not</strong>happen in a<em>fast way</em>but uses Java method call reflection. It is therefore recommended to migrate your type converters to use the faster way. See further below.</p></div><div class="admonitionblock tip"><table><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content">You can turn off the fallback of discovering Camel 2.x compatible type converters by setting the<code>loadTypeConverters</code>option to<code>false</code>on<code>CamelContext</code>.</td></tr></table></div><div class="paragraph"><p>The converter classes must be annotated on the top class level with the<code>@Converter</code>annotation, and each converter method as well.</p></div><div class="paragraph"><p>E.g. the following shows how to register a converter from<code>File</code>to<code>InputStream</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Converter
public class IOConverter {
    @Converter
    public static InputStream toInputStream(File file) throws FileNotFoundException {
        return new BufferedInputStream(new FileInputStream(file));
    }
}</code></pre></div></div><div class="sect4"><h5 id="_discovering_type_converters_in_the_fast_way"><a class="anchor" href="#_discovering_type_converters_in_the_fast_way"></a>Discovering Type Converters in the fast way</h5><div class="paragraph"><p>To enable the fast type converter way, you should enable<code>loader = true</code>on the class level annotation as shown:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Converter(loader = true)
public class IOConverter {
    @Converter
    public static InputStream toInputStream(File file) throws FileNotFoundException {
        return new BufferedInputStream(new FileInputStream(file));
    }
}</code></pre></div></div><div class="paragraph"><p>And then you should have the<code>camel-apt</code>JAR as dependency when compiling the project. When using Maven you add:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;apt&lt;/artifactId&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre></div></div></div><div class="sect4"><h5 id="TypeConverter-Returningnullvalues"><a class="anchor" href="#TypeConverter-Returningnullvalues"></a>Returning null values</h5><div class="paragraph"><p>By default when using a method in a POJO annotation with @Converter returning null is not a valid response. If null is returned, then Camel will regard that type converter as a<em>miss</em>, and prevent from using it in the future. If null should be allowed as a valid response, then from<strong>Camel 2.11.2/2.12</strong>onwards you can specify this in the annotation as shown:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Converter(allowNull = true)
public static InputStream toInputStream(File file) throws IOException {
    if (file.exist()) {
        return new BufferedInputStream(new FileInputStream(file));
    } else {
        return null;
    }
}</code></pre></div></div></div></div><div class="sect3"><h4 id="TypeConverter-DiscoveringFallbackTypeConverters"><a class="anchor" href="#TypeConverter-DiscoveringFallbackTypeConverters"></a>Discovering Fallback Type Converters</h4><div class="paragraph"><p><strong>Available in Camel 2.0</strong></p></div><div class="paragraph"><p>The<a href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/impl/converter/AnnotationTypeConverterLoader.html">AnnotationTypeConverterLoader</a>has been enhanced to also look for methods defined with a<code>@FallbackConverter</code>annotation, and register it as a fallback type converter.</p></div><div class="paragraph"><p>Fallback type converters are used as a last resort for converting a given value to another type. Its used when the regular type converters give up. The fallback converters is also meant for a broader scope, so its method signature is a bit different:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@FallbackConverter
public static &lt;T&gt; T convertTo(Class&lt;T&gt; type, Exchange exchange, Object value, TypeConverterRegistry registry)</code></pre></div></div><div class="paragraph"><p>Or you can use the non generic signature.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@FallbackConverter
public static Object convertTo(Class type, Exchange exchange, Object value, TypeConverterRegistry registry)</code></pre></div></div><div class="paragraph"><p>And the method name can be anything (<code>convertTo</code>is not required as a name), so it can be named<code>convertMySpecialTypes</code>if you like.<br>The<code>Exchange</code>parameter is optional, just as its with the regular<code>@Converter</code>methods.</p></div><div class="paragraph"><p>The purpose with this broad scope method signature is allowing you to control if you can convert the given type or not. The<code>type</code>parameter holds the type we want the<code>value</code>converted to. Its used internally in Camel for wrapper objects so we can delegate the type convertions to the body that is wrapped.</p></div><div class="paragraph"><p>For instance in the method below we will handle all type conversions that is based on the wrapper class<code>GenericFile</code>and we let Camel do the type conversions on its body instead.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@FallbackConverter
public static &lt;T&gt; T convertTo(Class&lt;T&gt; type, Exchange exchange, Object value, TypeConverterRegistry registry) {
    // use a fallback type converter so we can convert the embedded body
    // if the value is GenericFile
    if (GenericFile.class.isAssignableFrom(value.getClass())) {
        GenericFile file = (GenericFile) value;
        Class from = file.getBody().getClass();
        TypeConverter tc = registry.lookup(type, from);
        if (tc != null) {
            Object body = file.getBody();
            return tc.convertTo(type, exchange, body);
        }
    }
    return null;
}</code></pre></div></div></div><div class="sect3"><h4 id="TypeConverter-WritingyourownTypeConverters"><a class="anchor" href="#TypeConverter-WritingyourownTypeConverters"></a>Writing your own Type Converters</h4><div class="paragraph"><p>You are welcome to write your own converters. Remember to use the<code>@Converter</code>annotations on the classes and methods you wish to use. And on the top-level class add<code>Converter(loader = true)</code>to support the<em>fast way</em>of using type converters.</p></div><div class="ulist"><ul><li><p>static methods are encouraged to reduce caching, but instance methods are fine, particularly if you want to allow optional dependency injection to customize the converter</p></li><li><p>converter methods should be thread safe and reentrant</p></li></ul></div></div><div class="sect3"><h4 id="TypeConverter-Exchangeparameter"><a class="anchor" href="#TypeConverter-Exchangeparameter"></a>Exchange parameter</h4><div class="paragraph"><p>The type converter accepts the<code>Exchange</code>as an optional 2nd parameter. This is usable if the type converter for instance needs information from the current exchange. For instance combined with the encoding support its possible for type converters to convert with the configured encoding. An example from camel-core for the<code>byte[]</code>&#8594;<code>String</code>converter:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Converter
public static String toString(byte[] data, Exchange exchange) {
    String charsetName = exchange.getProperty(Exchange.CHARSET_NAME, String.class);
    if (charsetName != null) {
        try {
            return new String(data, charsetName);
        } catch (UnsupportedEncodingException e) {
            // ignore
        }
        return new String(data);
    }
}</code></pre></div></div></div></div></article></main></div><footer class="footer"><p>This page was built using the Antora default UI.</p><p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p></footer><script src="../../_/js/site.js"></script><script src="../../_/js/vendor/highlight.js"></script><script>hljs.initHighlighting()</script></body></html>